!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("module-places"),require("base"),require("core"),require("ui"),require("jquery")):"function"==typeof define&&define.amd?define(["module-places","base","core","ui","jquery"],t):"object"==typeof exports?exports["widget-places"]=t(require("module-places"),require("base"),require("core"),require("ui"),require("jquery")):e["widget-places"]=t(e["module-places"],e.base,e.core,e.ui,e.jquery)}(this,function(e,t,i,o,n){return function(e){function t(o){if(i[o])return i[o].exports;var n=i[o]={exports:{},id:o,loaded:!1};return e[o].call(n.exports,n,n.exports,t),n.loaded=!0,n.exports}var i={};return t.m=e,t.c=i,t.p="",t(0)}([function(e,t,i){var o;(function(e){o=function(require,e,t){"use strict";function o(e,t){e.publish("cxp.item.loaded",{id:t.model.name})}t.name="widget-places";var n=i(3),r=i(4),a=i(5),l=i(2),s=[r.name,a.name,l.name];o.$inject=["lpCoreBus","lpWidget"],t.exports=n.createModule(t.name,s).controller(i(6)).directive(i(8)).run(o)}.call(t,i,t,e),!(void 0!==o&&(e.exports=o))}).call(t,i(1)(e))},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children=[],e.webpackPolyfill=1),e}},function(t,i){t.exports=e},function(e,i){e.exports=t},function(e,t){e.exports=i},function(e,t){e.exports=o},function(e,t,i){var o;o=function(require,e,t){"use strict";e.PlacesCtrl=function(e,t,o,n,r,a,l,s,c,d,u,p){function f(){e.map.zoom=parseInt(r.getPreference("zoom"),10),n(function(){e.map.center=new l.maps.LatLng(e.latitude,e.longitude)},250)}function m(e){if(s.isString(e.message)&&s.trim(e.message))return e.message;if(e.data){if(s.isArray(e.data.errors)&&e.data.errors.length)return s(e.data.errors).pluck("message").join("<br />");if(s.isString(e.data)&&s.trim(e.data))return e.data}return"Unknown server error ocurred"}function g(t){var i=m(t);e.status.isError=!0,u.captureException(t),e.addAlert(i,"danger",l.alertTimeout)}function h(t){e.filters=s.merge(t.types,t.services).map(function(e){return{id:e.id,label:e.label,selected:!0}})}function v(){var e=c.getInstance({endpoint:s.resolvePortalPlaceholders(r.getPreference("filterDataSrc"))});return e.read().success(h).error(function(){u.throwException(new U("Unable to fetch data."))})}function w(){return s(e.filters).chain().filter({selected:!0}).pluck("id").value()}function y(){e.status.isLoading=!0;var t=s.isUndefined(e.latitude)&&s.isUndefined(e.longitude);u.assert(t===!1,"Missing coordonates."),e.selectedTypes=w();var i=c.getInstance({endpoint:s.resolvePortalPlaceholders(r.getPreference("placesDataSrc"))});return i.read({lat:e.latitude,"long":e.longitude,type:e.selectedTypes.join(","),radius:e.radius}).success(function(t){e.status.isLoading=!1;var i=t.locations||[];i[0]&&s.isString(i[0])&&i[0].indexOf("No")>-1?e.data={locations:[]}:(s.each(i,function(e){var t=s.isPlainObject(e.openingHours)&&s.isUndefined(e.openingHours.periods)===!1;t&&s.map(e.openingHours.periods,function(e){var t=s.date().isoWeekday(parseInt(e.day,10));e.dayShort=t.format("ddd"),e.day=t.format("dddd"),e.time=s.trim(e.time,"-")})}),e.data=i),f()})}function x(e){return M[e]||(M[e]=L.shift()),M[e]}function P(){function i(){e.latitude=r.getPreference("latitude"),e.longitude=r.getPreference("longitude"),n.cancel(o),a.resolve(e)}var o,a=t.defer(),l=a.promise,s=r.getPreference("geolocationTimeout")||5e3,c=200;return"geolocation"in window.navigator&&r.getPreference("currentPosition")?(o=n(function(){i()},s+c),navigator.geolocation.getCurrentPosition(function(t){e.latitude=t.coords.latitude,e.longitude=t.coords.longitude,a.resolve(e)},i,{timeout:s})):r.getPreference("latitude")&&r.getPreference("longitude")?i():u.throwException(new U("Missing Latitude and Longitude.")),l}function b(){r.addEventListener("preferencesSaved",function(){r.refreshHTML()}),e.onZoomChanged=function(t,i){var o=e.options.map.maxZoomOut;t.getZoom()<o&&t.setZoom(o)}}function C(){v().then(P).then(y).then(b)["catch"](g)["finally"](function(){e.status.isLoading=!1})}function S(){var e,o=i(7),n=o(".pac-container .pac-item:first").text()||o("input.filters-name").val(),r=t.defer(),a=r.promise,s=new l.maps.Geocoder;return s.geocode({address:n},function(t,i){return i===l.maps.GeocoderStatus.OK?(e={place:t[0],location:t[0].geometry.location},r.resolve(e),e):void r.reject()}),a}var U=u.createException("PlacesError"),M={},L=s.clone(l.markerColorPool);e.sticky=s.parseBoolean(r.getPreference("sticky")),e.fillViewportHeight=s.parseBoolean(r.getPreference("fillViewportHeight")),e.mapId=r.id,e.title=r.getPreference("title"),e.options={map:{maxZoomOut:r.getPreference("maxZoomOut")||0,mapTypeId:l.maps.MapTypeId.ROADMAP,panControl:s.parseBoolean(r.getPreference("panControl")),styles:[{featureType:"poi",elementType:"labels",stylers:[{visibility:s.parseBoolean(r.getPreference("showPOI"))?"on":"off"}]}]}},e.status={isLoading:!0,isError:!1,isopen:!1},e.map={},e.map.staticMapApiUrl=r.getPreference("staticMapApiUrl"),e.map.staticMapZoom=r.getPreference("staticMapZoom"),e.map.staticMapThumbSize=r.getPreference("staticMapThumbSize"),e.map.directionApiUrl=r.getPreference("directionApiUrl"),e.radius=r.getPreference("placesFilterRadius")||50,e.viewStatus="",e.sizeRules=[{max:200,size:"tile"},{min:201,max:450,size:"small"},{min:451,size:"normal"}],e.alerts=[],e.selectedTypes=w(),e.$watch("data",function(){s.isUndefined(e.data)||(e.places=e.data,e.redraw())},!0),e.$watch("filters",s.debounce(function(){e.status.isLoading||e.status.isError||y()},800),!0),e.getMarkerOptions=function(e){var t=e.abbr||e.type.label,i=e.icon||e.type.mapIcon,o=e[l.titleField];if(t.length>l.maxLengthLabel&&(t=t.charAt(0)),!i){var n=e.color||x(e.type.id);i=l.isCanvasSupported()?a.canvasIcon(t,n):a.googleIcon(t,n),e.icon=i}return{title:o?o+"":"",icon:i}},e.search=function(t){!t||s.isEmpty(t.location)?S().then(function(t){e.latitude=t.location.lat(),e.longitude=t.location.lng(),y().then(function(){e.filters.searchname=t.place.formatted_address})},function(){e.addAlert("The location you provided is not valid!","warning",l.alertTimeout)}):(e.latitude=t.location.lat(),e.longitude=t.location.lng(),y())},e.redraw=function(){e.$broadcast("gmMarkersRedraw","places")},e.addAlert=function(t,i,o){var r={msg:t,type:i||"error"};e.alerts.push(r),o&&n(function(){e.closeAlert(e.alerts.indexOf(r))},o,!1)},e.closeAlert=function(t){t>-1&&e.alerts.splice(t,1)},e.openInfoWindow=function(t,i){e.directionUrl=e.map.directionApiUrl+"?daddr="+t.location.latitude+","+t.location.longitude,e.place=t,e.infoWindow.open(i.getMap(),i)},e.resized=function(t){e.$broadcast("gmMapResize",e.mapId)},e.setView=function(t){var i="col-xs-6",o="col-xs-12",n="hidden";switch(e.viewStatus=t,e.mapClass="",e.listClass="",e.listSize="",e.mapSize="",e.viewStatus){case"map":e.listClass=n,e.mapSize=o;break;case"list":e.mapClass=n,e.listSize=o;break;case"split":e.listSize=i,e.mapSize=i}e.$emit("view-changed")},d.isOldBrowser()&&n(e.redraw,2e3),e.toggleFilter=function(e,t){e.stopPropagation()},C()},e.PlacesCtrl.$inject=["$scope","$q","$filter","$timeout","lpWidget","lpPlaces","lpPlacesUtils","lpCoreUtils","httpService","angulargmUtils","lpCoreError","lpCoreBus"]}.call(t,i,t,e),!(void 0!==o&&(e.exports=o))},function(e,t){e.exports=n},function(e,t,i){var o;o=function(require,e,t){"use strict";e.placesList=function(e,t,i){return{restrict:"A",replace:!0,scope:{places:"=placesObjects",map:"=mapObject",filters:"=filterObject"},controller:["$scope","$element","angulargmUtils",function(e,i,o){e.isOldBrowser=o.isOldBrowser(),e.css={detailSection:"col-md-6 col-xs-6"},e.openDetails=function(t){(t.showDetails===!1||void 0===t.showDetails)&&(t.showDetails=!0,t.mapUrl=e.map.staticMapApiUrl+"?zoom="+e.map.staticMapZoom+"&size="+e.map.staticMapThumbSize+"&markers=color:red%7C"+t.location.latitude+","+t.location.longitude,t.directionUrl=e.map.directionApiUrl+"?daddr="+t.location.latitude+","+t.location.longitude)},e.closeDetails=function(e,t){t.stopPropagation(),e.showDetails=!1},e.loadMorePlaces=function(){t.publish("launchpad-retail.places.loadMore",{},!0)}}],templateUrl:e.getWidgetBaseUrl(i)+"/templates/placesList.html"}},e.placesList.$inject=["lpCoreUtils","lpCoreBus","lpWidget"],e.tabContentsFillHeight=function(e,t,i,o,n){function r(e){var t=document.body,i=document.defaultView,o=document.documentElement,n=document.createElement("div");n.style.paddingLeft=n.style.width="1px",t.appendChild(n);var r=2===n.offsetWidth;t.removeChild(n),n=e.getBoundingClientRect();var a=o.clientTop||t.clientTop||0,l=o.clientLeft||t.clientLeft||0,s=i.pageYOffset||r&&o.scrollTop||t.scrollTop,c=i.pageXOffset||r&&o.scrollLeft||t.scrollLeft;return{top:n.top+s-a,left:n.left+c-l}}return{restrict:"C",replace:!0,priority:500,link:function(t,i){function o(){n(function(){var t=i[0],o=e.document,n=o.querySelector(".tabs-content"),a=r(n),l=e.getComputedStyle(n,null),s=parseInt(l.marginBottom,10),c={width:Math.max(o.documentElement.clientWidth,window.innerWidth||0),height:Math.max(o.documentElement.clientHeight,window.innerHeight||0)};t.style.height=c.height-a.top-s+"px",t.style.overflowY=t.offsetHeight<t.scrollHeight?"scroll":"visible"})}t.fillViewportHeight&&(t.$on("view-changed",o),e.addEventListener("resize",o))}}},e.tabContentsFillHeight.$inject=["$window","lpCoreUtils","lpCoreBus","lpWidget","$timeout"]}.call(t,i,t,e),!(void 0!==o&&(e.exports=o))}])});