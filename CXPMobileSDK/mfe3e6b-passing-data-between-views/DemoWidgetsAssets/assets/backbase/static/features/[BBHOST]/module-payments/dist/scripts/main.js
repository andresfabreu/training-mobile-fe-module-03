!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("base"),require("core"),require("ui")):"function"==typeof define&&define.amd?define(["base","core","ui"],t):"object"==typeof exports?exports["module-payments"]=t(require("base"),require("core"),require("ui")):e["module-payments"]=t(e.base,e.core,e.ui)}(this,function(e,t,n){return function(e){function t(a){if(n[a])return n[a].exports;var r=n[a]={exports:{},id:a,loaded:!1};return e[a].call(r.exports,r,r.exports,t),r.loaded=!0,r.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){var a;(function(e){a=function(require,e,t){"use strict";t.name="module-payments";var a=n(2),r=[n(3).name,n(4).name,n(8).name,n(11).name];t.exports=a.createModule(t.name,r).constant(n(28)).provider(n(29)).provider(n(30)).service(n(31))}.call(t,n,t,e),!(void 0!==a&&(e.exports=a))}).call(t,n(1)(e))},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children=[],e.webpackPolyfill=1),e}},function(t,n){t.exports=e},function(e,n){e.exports=t},function(e,t,n){var a;(function(e){a=function(require,e,t){"use strict";t.name="scheduled-transfer";var a=n(2),r=n(3),i=n(5),s=[r.name,i.name];t.exports=a.createModule(t.name,s).directive(n(6))}.call(t,n,t,e),!(void 0!==a&&(e.exports=a))}).call(t,n(1)(e))},function(e,t){e.exports=n},function(e,t,n){var a;a=function(require,e,t){"use strict";var a=n(7);e.lpScheduledTransfer=function(e){function t(e,t,n,r){var i,s=r[0],o=r[1],c=function(){return e.scheduledTransfer.frequency===e.frequenciesEnum.WEEKLY||e.scheduledTransfer.frequency===e.frequenciesEnum.MONTHLY||e.scheduledTransfer.frequency===e.frequenciesEnum.YEARLY},l=function(){var t=!1;if(e.scheduledTransfer.intervals.length>0&&e.scheduledTransfer.frequency===e.frequenciesEnum.MONTHLY)for(var n=28;31>n;n++)e.dates[n].active&&(t=!0);e.dateWarning=t},u=function(){var t=!0;t=e.scheduledTransfer.intervals.length>0?!0:!1,t=e.customOrder?t:!0,t=e.isScheduledTransfer?t:!0,s.$setValidity("intervalsRequired",t)},d=function(){var t,n;for(e.scheduledTransfer.intervals=[],t=0,n=e.days.length;n>t;t++)e.days[t].active=!1;for(t=0,n=e.dates.length;n>t;t++)e.dates[t].active=!1;for(t=0,n=e.months.length;n>t;t++)e.months[t].active=!1},p=function(){e.todaysDate=new Date,e.minEndDate=new Date,e.frequenciesEnum={START_OF_THE_MONTH:"START_OF_THE_MONTH",END_OF_THE_MONTH:"END_OF_THE_MONTH",LAST_FRIDAY_OF_THE_MONTH:"LAST_FRIDAY_OF_THE_MONTH",WEEKLY:"WEEKLY",MONTHLY:"MONTHLY",YEARLY:"YEARLY"},i=new a({frequencies:e.frequenciesEnum}),e.frequencies||(e.frequencies=[{id:e.frequenciesEnum.START_OF_THE_MONTH,value:"First of the month",group:"apreset"},{id:e.frequenciesEnum.END_OF_THE_MONTH,value:"End of the month",group:"apreset"},{id:e.frequenciesEnum.LAST_FRIDAY_OF_THE_MONTH,value:"Last Friday of the month",group:"apreset"},{id:e.frequenciesEnum.WEEKLY,value:"Weekly",group:"bcustom"},{id:e.frequenciesEnum.MONTHLY,value:"Monthly",group:"bcustom"},{id:e.frequenciesEnum.YEARLY,value:"Yearly",group:"bcustom"}]),e.days=[{id:1,value:"M",label:"Monday",active:!1},{id:2,value:"T",label:"Tuesday",active:!1},{id:3,value:"W",label:"Wednesday",active:!1},{id:4,value:"T",label:"Thursday",active:!1},{id:5,value:"F",label:"Friday",active:!1},{id:6,value:"S",label:"Saturday",active:!1},{id:7,value:"S",label:"Sunday",active:!1}],e.months=[{id:1,value:"Jan",label:"January",active:!1},{id:2,value:"Feb",label:"February",active:!1},{id:3,value:"Mar",label:"March",active:!1},{id:4,value:"Apr",label:"April",active:!1},{id:5,value:"May",label:"May",active:!1},{id:6,value:"Jun",label:"June",active:!1},{id:7,value:"Jul",label:"July",active:!1},{id:8,value:"Aug",label:"August",active:!1},{id:9,value:"Sep",label:"September",active:!1},{id:10,value:"Oct",label:"October",active:!1},{id:11,value:"Nov",label:"November",active:!1},{id:12,value:"Dec",label:"December",active:!1}],e.dates=[];for(var t=1;32>t;t++)e.dates.push({id:t,value:t,label:t,active:!1});e.endOptions||(e.endOptions=[{id:"after",value:"After"},{id:"onDate",value:"On date"}]),e.scheduledTransfer.endOn=e.endOptions[0].id,e.customOrder=!1,e.dateWarning=!1,e.calendar={startCalendarOpen:!1,endCalendarOpen:!1},e.endDateOptions={datepickerMode:"year","show-weeks":!1},e.startDateOptions={"show-weeks":!1},e.timesEndDate=e.scheduledTransfer.endDate,e.setEndDate()};s.$name="scheduledTransfer",o.$addControl(s),s.$formatters.push(function(t){if(t.intervals.length>0){var n,a;if(t.frequency===e.frequenciesEnum.WEEKLY){for(n=0;n<t.intervals.length;n++)for(a=0;a<e.days.length;a++)if(t.intervals[n]===e.days[a].id){e.days[a].active=!0;break}}else if(t.frequency===e.frequenciesEnum.MONTHLY){for(n=0;n<t.intervals.length;n++)for(a=0;a<e.dates.length;a++)if(t.intervals[n]===e.dates[a].id){e.dates[a].active=!0;break}}else if(t.frequency===e.frequenciesEnum.YEARLY)for(n=0;n<t.intervals.length;n++)for(a=0;a<e.months.length;a++)if(t.intervals[n]===e.months[a].id){e.months[a].active=!0;break}}e.scheduledTransfer.frequency=""===t.frequency?e.frequencies[0].id:t.frequency,c()?e.customOrder=!0:e.customOrder=!1,l(),e.setTransferPeriodDates()}),e.frequencyChanged=function(){d(),e.setTransferPeriodDates(),c()?(e.customOrder=!0,u(),e.scheduledTransfer.customOrder=!0):(e.customOrder=!1,s.$setValidity("intervalsRequired",!0),e.scheduledTransfer.customOrder=!1),l()},e.toggleInterval=function(t){var n,a;if(e.scheduledTransfer.frequency===e.frequenciesEnum.WEEKLY?n=e.days:e.scheduledTransfer.frequency===e.frequenciesEnum.MONTHLY?n=e.dates:e.scheduledTransfer.frequency===e.frequenciesEnum.YEARLY&&(n=e.months),a=n[t],a.active){var r=e.scheduledTransfer.intervals.indexOf(a.id);e.scheduledTransfer.intervals.splice(r,1)}else e.scheduledTransfer.intervals.push(a.id);a.active=!a.active,u(),l(),e.setEndDate()},e.openStartCalendar=function(t){("click"===t.type||32===t.which||13===t.which)&&(t.preventDefault(),t.stopPropagation(),e.calendar.endCalendarOpen=!1,e.calendar.startCalendarOpen=!e.calendar.startCalendarOpen)},e.openEndCalendar=function(t){("click"===t.type||32===t.which||13===t.which)&&(t.preventDefault(),t.stopPropagation(),e.calendar.startCalendarOpen=!1,e.calendar.endCalendarOpen=!e.calendar.endCalendarOpen)},e.setTransferPeriodDates=function(){"object"!=typeof e.scheduledTransfer.startDate&&(c()?e.scheduledTransfer.startDate=new Date(e.todaysDate.getTime()):e.scheduledTransfer.frequency===e.frequenciesEnum.END_OF_THE_MONTH?e.scheduledTransfer.startDate=i.getLastDayOfMonth():e.scheduledTransfer.frequency===e.frequenciesEnum.START_OF_THE_MONTH?e.scheduledTransfer.startDate=i.getFirstDayOfMonth():e.scheduledTransfer.frequency===e.frequenciesEnum.LAST_FRIDAY_OF_THE_MONTH&&(e.scheduledTransfer.startDate=i.getLastFridayOfMonth())),e.setEndDate()},e.setEndDate=function(){var t;if(e.scheduledTransfer.startDate){var n=new Date(e.scheduledTransfer.startDate.getTime());c()?(t=e.scheduledTransfer.timesToRepeat*e.scheduledTransfer.every,e.scheduledTransfer.frequency===e.frequenciesEnum.WEEKLY?n=i.addWeeksToDate(n,t):e.scheduledTransfer.frequency===e.frequenciesEnum.MONTHLY?n=i.addMonthsToDate(n,t):e.scheduledTransfer.frequency===e.frequenciesEnum.YEARLY&&(n=i.addYearsToDate(n,t))):(t=e.scheduledTransfer.timesToRepeat,t=e.scheduledTransfer.timesToRepeat,e.scheduledTransfer.frequency===e.frequenciesEnum.END_OF_THE_MONTH?n=i.getLastDayOfMonthPlusTime(n,t):e.scheduledTransfer.frequency===e.frequenciesEnum.START_OF_THE_MONTH?n=i.getFirstDayOfMonthPlusTime(n,t):e.scheduledTransfer.frequency===e.frequenciesEnum.LAST_FRIDAY_OF_THE_MONTH&&(n=i.getLastFridayOfMonthPlusTime(n,t))),e.scheduledTransfer.endDate=n,e.minEndDate=i.calculateMinimumEndDate(e.scheduledTransfer.frequency,e.scheduledTransfer.every,new Date(e.scheduledTransfer.startDate.getTime())),e.timesEndDate=new Date(e.scheduledTransfer.endDate.getTime()).toString("d-MMM-yyyy")}},e.$watch("isScheduledTransfer",function(e){u()}),e.$on("reset",function(){e.scheduledTransfer.frequency=e.frequencies[0].id,e.customOrder=!1,e.scheduledTransfer.customOrder=!1}),p()}return e.put("scheduled-transfer.html",'<div class="lp-scheduled-transfer">    <div class="lp-st-frequency lp-st-section clearfix">        <div class="pull-left lp-st-caption">Frequency</div>        <div class="pull-left lp-st-control">            <div class="lp-st-frequency-dropdown" aria-label="frequency" dropdown-select="dropdown-select" ng-change="frequencyChanged()" ng-model="scheduledTransfer.frequency" ng-options="val.id as val.value group by val.group for val in frequencies"></div>        </div>    </div>    <div class="lp-st-every lp-st-section clearfix">        <div class="pull-left lp-st-caption" ng-if="customOrder">Every</div>        <div class="pull-left lp-st-control clearfix" ng-if="scheduledTransfer.frequency === frequenciesEnum.WEEKLY">            <input type="number" lp-number-input="lp-number-input" lp-max-length="1" min="1" step="0" non-zero="non-zero" class="lp-st-every-input pull-left" name="repeatEvery" required="required" tabindex="0" aria-required="true" aria-label="Repeat weekly transfer every" maxlength="2" ng-model="scheduledTransfer.every" ng-change="setEndDate()" /><span>week(s) on:</span>        </div>        <div class="pull-left lp-st-control clearfix" ng-if="scheduledTransfer.frequency === frequenciesEnum.MONTHLY">            <input type="number" lp-number-input="lp-number-input" lp-max-length="1" min="1" step="0" non-zero="non-zero" class="lp-st-every-input pull-left" name="repeatEvery" required="required" tabindex="0" aria-required="true" aria-label="Repeat monthly transfer every" maxlength="2" ng-model="scheduledTransfer.every" ng-change="setEndDate()" /><span>month(s) on:</span>        </div>        <div class="pull-left lp-st-control clearfix" ng-if="scheduledTransfer.frequency === frequenciesEnum.YEARLY">            <input type="number" lp-number-input="lp-number-input" lp-max-length="1" min="1" step="0" non-zero="non-zero" class="lp-st-every-input pull-left" name="repeatEvery" required="required" tabindex="0" aria-required="true"  aria-label="Repeat yearly transfer every" maxlength="2" ng-model="scheduledTransfer.every" ng-change="setEndDate()" /><span>year(s):</span>        </div>    </div>    <div class="lp-st-interval lp-st-section clearfix" ng-if="customOrder">        <div class="lp-st-interval-menu weekly btn-group" ng-if="scheduledTransfer.frequency === frequenciesEnum.WEEKLY">            <button type="button" interval-button="interval-button" aria-label="{{day.label}}" ng-class="{\'active\': day.active}" class="btn btn-default" tabindex="0"  ng-click="toggleInterval($index)" ng-repeat="day in days" ng-model="day">{{day.value}}</button>        </div>        <div class="lp-st-interval-menu monthly btn-group" ng-if="scheduledTransfer.frequency === frequenciesEnum.MONTHLY">            <button type="button" interval-button="interval-button" aria-label="{{date.label}}" ng-class="{\'active\': date.active}" class="btn btn-default" tabindex="0"  ng-click="toggleInterval($index)" ng-repeat="date in dates" ng-model="date">{{date.value}}</button>        </div>        <div class="lp-st-interval-menu yearly btn-group" ng-if="scheduledTransfer.frequency === frequenciesEnum.YEARLY">            <button type="button" interval-button="interval-button" aria-label="{{month.label}}" ng-class="{\'active\': month.active}" class="btn btn-default" tabindex="0" ng-click="toggleInterval($index)" ng-repeat="month in months" ng-model="month">{{month.value}}</button>        </div>    </div>    <div class="lp-st-start-date lp-st-section clearfix">        <div class="pull-left lp-st-caption">Start</div>        <div class="pull-left lp-st-control calendar">            <input ng-click="openStartCalendar($event)" aria-label="start date" type="text" ng-required="isScheduledTransfer === true" name="startDate" ng-model="scheduledTransfer.startDate" datepicker-popup="d-MMM-yyyy" readonly="readonly" is-open="calendar.startCalendarOpen" datepicker-options="startDateOptions" min-date="todaysDate" class="form-control" lp-future-time="" show-button-bar="false" tabindex="0" ng-change="setEndDate()" ng-keypress="openStartCalendar($event)" />            <span ng-click="openStartCalendar($event)" class="lp-icon lp-icon-calendar calendar-icon"></span>        </div>    </div>    <div class="lp-st-end-on lp-st-section clearfix">        <div class="pull-left lp-st-caption">End</div>        <div class="pull-left lp-st-control">            <div class="lp-st-end-on-dropdown" aria-label="end on" dropdown-select="dropdown-select" ng-change="endOnChanged()" ng-model="scheduledTransfer.endOn" ng-options="val.id as val.value for val in endOptions"></div>        </div>    </div>    <div class="lp-st-end-after lp-st-section clearfix" ng-if="scheduledTransfer.endOn === \'after\'">        <div class="pull-left lp-st-caption">Repeat</div>        <div class="pull-left lp-st-control">            <input type="number" lp-number-input="lp-number-input" lp-max-length="2" min="1" step="0" non-zero="non-zero" class="form-control" aria-label="times to repeat" name="timesToRepeat" aria-required="true" required="required" tabindex="0" ng-model="scheduledTransfer.timesToRepeat" ng-change="setEndDate()"  />        </div>    </div>    <p class="text-muted" ng-if="scheduledTransfer.endOn === \'after\' && timesEndDate.length > 0" style="margin-left: 5px + ">Completion date: {{timesEndDate}}</p>    <div class="lp-st-end-date lp-st-section clearfix" ng-if="scheduledTransfer.endOn === \'onDate\'">        <div class="pull-left lp-st-caption">End date</div>        <div class="pull-left lp-st-control calendar">            <input ng-click="openEndCalendar($event)" aria-label="end date" type="text" ng-required="isScheduledTransfer === true" name="endDate" ng-model="scheduledTransfer.endDate" readonly="readonly" datepicker-popup="d-MMM-yyyy" is-open="calendar.endCalendarOpen" datepicker-options="endDateOptions" min-date="minEndDate" class="form-control" lp-future-time="" show-button-bar="false" tabindex="0" ng-keypress="openEndCalendar($event)" />            <span ng-click="openEndCalendar($event)" class="lp-icon lp-icon-calendar calendar-icon"></span>        </div>    </div>    <p ng-if="dateWarning">Transfer will be put through on the last day of the month if the month is not long enough</p></div>'),{restrict:"AE",replace:!0,require:["ngModel","^form"],template:e.get("scheduled-transfer.html"),scope:{scheduledTransfer:"=ngModel",isScheduledTransfer:"=lpIsScheduledTransfer"},link:t}},e.lpScheduledTransfer.$inject=["$templateCache"]}.call(t,n,t,e),!(void 0!==a&&(e.exports=a))},function(e,t,n){var a;a=function(require,e,t){"use strict";var a=n(2),r=a.inject("lpCoreUtils",n(3).name),i=t.exports=function(e){var t=this;t.frequencies=e.frequencies};i.prototype.addWeeksToDate=function(e,t){return r.date(e).add(t,"weeks").toDate()},i.prototype.addMonthsToDate=function(e,t){return r.date(e).add(t,"months").toDate()},i.prototype.addYearsToDate=function(e,t){return r.date(e).add(t,"years").toDate()},i.prototype.getLastDayOfMonth=function(){return r.date().endOf("month").toDate()},i.prototype.getFirstDayOfMonth=function(){var e=r.date();return 1!==e.date()&&e.add(1,"month").startOf("month"),e.toDate()},i.prototype.getLastFridayOfMonth=function(){var e=r.date().endOf("month");return e.day()>=5?e.subtract(e.day()-5,"days"):e.subtract(e.day()+2,"days"),e.toDate()},i.prototype.getLastDayOfMonthPlusTime=function(e,t){return r.date(e).add(t-1,"month").endOf("month").toDate()},i.prototype.getFirstDayOfMonthPlusTime=function(e,t){var n=r.date(e).clone();return 0===n.day()?(n.add(t-1,"months").startOf("month"),e=n.isBefore(e)?n.add(1,"months"):n):e=r.date(e).add(t,"months").startOf("month"),e.toDate()},i.prototype.getLastFridayOfMonthPlusTime=function(e,t){var n=r.date(e).clone(),a=function(e){return e.subtract(1,"week").endOf("week").subtract(1,"days")};return 5!==n.endOf("month").day()?(a(n),n.isBefore(e)?n.add(t,"months"):n.add(t-1,"months"),5!==n.endOf("month").day()&&a(n)):(n.add(t-1,"months").endOf("month"),5!==n.day()&&a(n)),n.toDate()},i.prototype.calculateMinimumEndDate=function(e,t,n){switch(e){case this.frequencies.WEEKLY:n=r.date(n).add(1*t,"weeks").toDate();break;case this.frequencies.MONTHLY:n=r.date(n).add(1*t,"months").toDate();break;case this.frequencies.YEARLY:n=r.date(n).add(1*t,"years").toDate();break;case this.frequencies.LAST_FRIDAY_OF_THE_MONTH:n=this.getLastFridayOfMonthPlusTime(n,1);break;case this.frequencies.START_OF_THE_MONTH:n=this.getFirstDayOfMonthPlusTime(n,1);break;case this.frequencies.END_OF_THE_MONTH:n=this.getLastDayOfMonthPlusTime(n,1)}return n}}.call(t,n,t,e),!(void 0!==a&&(e.exports=a))},function(e,t,n){var a;(function(e){a=function(require,e,t){"use strict";t.name="module-payments-deprecated";var a=n(2),r=[];t.exports=a.createModule(t.name,r).factory(n(9)).directive(n(10))}.call(t,n,t,e),!(void 0!==a&&(e.exports=a))}).call(t,n(1)(e))},function(e,t,n){var a;a=function(require,e,t){"use strict";e.ScheduledDateCalculator=function(e){var t=function(e){var t=this;t.frequencies=e.frequencies};return t.prototype.addWeeksToDate=function(t,n){return e.date(t).add(n,"weeks").toDate()},t.prototype.addMonthsToDate=function(t,n){return e.date(t).add(n,"months").toDate()},t.prototype.addYearsToDate=function(t,n){return e.date(t).add(n,"years").toDate()},t.prototype.getLastDayOfMonth=function(){return e.date().endOf("month").toDate()},t.prototype.getFirstDayOfMonth=function(){var t=e.date();return 1!==t.date()&&t.add(1,"month").startOf("month"),t.toDate()},t.prototype.getLastFridayOfMonth=function(){var t=e.date().endOf("month");return t.day()>=5?t.subtract(t.day()-5,"days"):t.subtract(t.day()+2,"days"),t.toDate()},t.prototype.getLastDayOfMonthPlusTime=function(t,n){return e.date(t).add(n-1,"month").endOf("month").toDate()},t.prototype.getFirstDayOfMonthPlusTime=function(t,n){var a=e.date(t).clone();return 0===a.day()?(a.add(n-1,"months").startOf("month"),t=a.isBefore(t)?a.add(1,"months"):a):t=e.date(t).add(n,"months").startOf("month"),t.toDate()},t.prototype.getLastFridayOfMonthPlusTime=function(t,n){var a=e.date(t).clone(),r=function(e){return e.subtract(1,"week").endOf("week").subtract(1,"days")};return 5!==a.endOf("month").day()?(r(a),a.isBefore(t)?a.add(n,"months"):a.add(n-1,"months"),5!==a.endOf("month").day()&&r(a)):(a.add(n-1,"months").endOf("month"),5!==a.day()&&r(a)),t=a.toDate(),t=a.toDate()},t.prototype.calculateMinimumEndDate=function(t,n,a){switch(t){case this.frequencies.WEEKLY:a=e.date(a).add(1*n,"weeks").toDate();break;case this.frequencies.MONTHLY:a=e.date(a).add(1*n,"months").toDate();break;case this.frequencies.YEARLY:a=e.date(a).add(1*n,"years").toDate();break;case this.frequencies.LAST_FRIDAY_OF_THE_MONTH:a=this.getLastFridayOfMonthPlusTime(a,1);break;case this.frequencies.START_OF_THE_MONTH:a=this.getFirstDayOfMonthPlusTime(a,1);break;case this.frequencies.END_OF_THE_MONTH:a=this.getLastDayOfMonthPlusTime(a,1)}return a},{getInstance:function(e){return new t(e)}}},e.ScheduledDateCalculator.$inject=["lpCoreUtils"]}.call(t,n,t,e),!(void 0!==a&&(e.exports=a))},function(e,t,n){var a;a=function(require,e,t){"use strict";e.scheduledTransfer=function(e){var t="";return t+='<div class="lp-scheduled-transfer">',t+='    <div class="lp-st-frequency lp-st-section clearfix">',t+='        <div class="pull-left lp-st-caption">Frequency</div>',t+='        <div class="pull-left lp-st-control">',t+='            <div class="lp-st-frequency-dropdown" aria-label="frequency" dropdown-select="dropdown-select" ng-change="frequencyChanged()" ng-model="paymentOrder.scheduledTransfer.frequency" ng-options="val.id as val.value group by val.group for val in frequencies"></div>',t+="        </div>",t+="    </div>",t+='    <div class="lp-st-every lp-st-section clearfix">',t+='        <div class="pull-left lp-st-caption" ng-if="customOrder">Every</div>',t+='        <div class="pull-left lp-st-control clearfix" ng-if="paymentOrder.scheduledTransfer.frequency === frequenciesEnum.WEEKLY">',t+='            <input type="number" lp-number-input="lp-number-input" lp-max-length="1" min="1" step="0" non-zero="non-zero" class="lp-st-every-input pull-left" name="repeatEvery" required="required" tabindex="0" aria-required="true" aria-label="Repeat weekly transfer every" maxlength="2" ng-model="paymentOrder.scheduledTransfer.every" ng-change="setEndDate()" /><span>week(s) on:</span>',t+="        </div>",t+='        <div class="pull-left lp-st-control clearfix" ng-if="paymentOrder.scheduledTransfer.frequency === frequenciesEnum.MONTHLY">',t+='            <input type="number" lp-number-input="lp-number-input" lp-max-length="1" min="1" step="0" non-zero="non-zero" class="lp-st-every-input pull-left" name="repeatEvery" required="required" tabindex="0" aria-required="true" aria-label="Repeat monthly transfer every" maxlength="2" ng-model="paymentOrder.scheduledTransfer.every" ng-change="setEndDate()" /><span>month(s) on:</span>',t+="        </div>",t+='        <div class="pull-left lp-st-control clearfix" ng-if="paymentOrder.scheduledTransfer.frequency === frequenciesEnum.YEARLY">',t+='            <input type="number" lp-number-input="lp-number-input" lp-max-length="1" min="1" step="0" non-zero="non-zero" class="lp-st-every-input pull-left" name="repeatEvery" required="required" tabindex="0" aria-required="true"  aria-label="Repeat yearly transfer every" maxlength="2" ng-model="paymentOrder.scheduledTransfer.every" ng-change="setEndDate()" /><span>year(s):</span>',t+="        </div>",t+="    </div>",t+='    <div class="lp-st-interval lp-st-section clearfix" ng-if="customOrder">',t+='        <div class="lp-st-interval-menu weekly btn-group" ng-if="paymentOrder.scheduledTransfer.frequency === frequenciesEnum.WEEKLY">',t+='            <button type="button" interval-button="interval-button" aria-label="{{day.label}}" ng-class="{\'active\': day.active}" class="btn btn-default" tabindex="0"  ng-click="toggleInterval($index)" ng-repeat="day in days" ng-model="day">{{day.value}}</button>',t+="        </div>",t+='        <div class="lp-st-interval-menu monthly btn-group" ng-if="paymentOrder.scheduledTransfer.frequency === frequenciesEnum.MONTHLY">',t+='            <button type="button" interval-button="interval-button" aria-label="{{date.label}}" ng-class="{\'active\': date.active}" class="btn btn-default" tabindex="0"  ng-click="toggleInterval($index)" ng-repeat="date in dates" ng-model="date">{{date.value}}</button>',t+="        </div>",t+='        <div class="lp-st-interval-menu yearly btn-group" ng-if="paymentOrder.scheduledTransfer.frequency === frequenciesEnum.YEARLY">',t+='            <button type="button" interval-button="interval-button" aria-label="{{month.label}}" ng-class="{\'active\': month.active}" class="btn btn-default" tabindex="0" ng-click="toggleInterval($index)" ng-repeat="month in months" ng-model="month">{{month.value}}</button>',t+="        </div>",t+="    </div>",t+='    <div class="lp-st-start-date lp-st-section clearfix">',t+='        <div class="pull-left lp-st-caption">Start</div>',t+='        <div class="pull-left lp-st-control calendar">',t+='            <input ng-click="openStartCalendar($event)" aria-label="start date" type="text" ng-required="paymentOrder.isScheduledTransfer === true" name="startDate" ng-model="paymentOrder.scheduledTransfer.startDate" datepicker-popup="d-MMM-yyyy" readonly="readonly" is-open="calendar.startCalendarOpen" datepicker-options="startDateOptions" min-date="todaysDate" class="form-control" lp-future-time="" show-button-bar="false" tabindex="0" ng-change="setEndDate()" ng-keypress="openStartCalendar($event)" />',t+='            <span ng-click="openStartCalendar($event)" class="lp-icon lp-icon-calendar calendar-icon"></span>',t+="        </div>",t+="    </div>",t+='    <div class="lp-st-end-on lp-st-section clearfix">',t+='        <div class="pull-left lp-st-caption">End</div>',t+='        <div class="pull-left lp-st-control">',t+='            <div class="lp-st-end-on-dropdown" aria-label="end on" dropdown-select="dropdown-select" ng-change="endOnChanged()" ng-model="paymentOrder.scheduledTransfer.endOn" ng-options="val.id as val.value for val in endOptions"></div>',t+="        </div>",t+="    </div>",t+='    <div class="lp-st-end-after lp-st-section clearfix" ng-if="paymentOrder.scheduledTransfer.endOn === \'after\'">',t+='        <div class="pull-left lp-st-caption">Repeat</div>',t+='        <div class="pull-left lp-st-control">',t+='            <input type="number" lp-number-input="lp-number-input" lp-max-length="2" min="1" step="0" non-zero="non-zero" class="form-control" aria-label="times to repeat" name="timesToRepeat" aria-required="true" required="required" tabindex="0" ng-model="paymentOrder.scheduledTransfer.timesToRepeat" ng-change="setEndDate()"  />',t+="        </div>",t+="",t+="    </div>",t+='    <p class="text-muted" ng-if="paymentOrder.scheduledTransfer.endOn === \'after\' && timesEndDate.length > 0" style="margin-left: 5px;">Completion date: {{timesEndDate}}</p>',t+='    <div class="lp-st-end-date lp-st-section clearfix" ng-if="paymentOrder.scheduledTransfer.endOn === \'onDate\'">',t+='        <div class="pull-left lp-st-caption">End date</div>',t+='        <div class="pull-left lp-st-control calendar">',t+='            <input ng-click="openEndCalendar($event)" aria-label="end date" type="text" ng-required="paymentOrder.isScheduledTransfer === true" name="endDate" ng-model="paymentOrder.scheduledTransfer.endDate" readonly="readonly" datepicker-popup="d-MMM-yyyy" is-open="calendar.endCalendarOpen" datepicker-options="endDateOptions" min-date="minEndDate" class="form-control" lp-future-time="" show-button-bar="false" tabindex="0" ng-keypress="openEndCalendar($event)" />',t+='            <span ng-click="openEndCalendar($event)" class="lp-icon lp-icon-calendar calendar-icon"></span>',t+="        </div>",t+="    </div>",t+='    <p ng-if="dateWarning">Transfer will be put through on the last day of the month if the month is not long enough</p>',t+="</div>",t+="",{restrict:"AE",replace:!0,require:["ngModel","^form"],template:t,link:function(t,n,a,r){var i,s=function(){t.todaysDate=new Date,t.minEndDate=new Date,t.frequenciesEnum={START_OF_THE_MONTH:"START_OF_THE_MONTH",END_OF_THE_MONTH:"END_OF_THE_MONTH",LAST_FRIDAY_OF_THE_MONTH:"LAST_FRIDAY_OF_THE_MONTH",WEEKLY:"WEEKLY",MONTHLY:"MONTHLY",YEARLY:"YEARLY"},i=e.getInstance({frequencies:t.frequenciesEnum}),t.frequencies||(t.frequencies=[{id:t.frequenciesEnum.START_OF_THE_MONTH,value:"First of the month",group:"apreset"},{id:t.frequenciesEnum.END_OF_THE_MONTH,value:"End of the month",group:"apreset"},{id:t.frequenciesEnum.LAST_FRIDAY_OF_THE_MONTH,value:"Last Friday of the month",group:"apreset"},{id:t.frequenciesEnum.WEEKLY,value:"Weekly",group:"bcustom"},{id:t.frequenciesEnum.MONTHLY,value:"Monthly",group:"bcustom"},{id:t.frequenciesEnum.YEARLY,value:"Yearly",group:"bcustom"}]),t.days=[{id:1,value:"M",label:"Monday",active:!1},{id:2,value:"T",label:"Tuesday",active:!1},{id:3,value:"W",label:"Wednesday",active:!1},{id:4,value:"T",label:"Thursday",active:!1},{id:5,value:"F",label:"Friday",active:!1},{id:6,value:"S",label:"Saturday",active:!1},{id:7,value:"S",label:"Sunday",active:!1}],t.months=[{id:1,value:"Jan",label:"January",active:!1},{id:2,value:"Feb",label:"February",active:!1},{id:3,value:"Mar",label:"March",active:!1},{id:4,value:"Apr",label:"April",active:!1},{id:5,value:"May",label:"May",active:!1},{id:6,value:"Jun",label:"June",active:!1},{id:7,value:"Jul",label:"July",active:!1},{id:8,value:"Aug",label:"August",active:!1},{id:9,value:"Sep",label:"September",active:!1},{id:10,value:"Oct",label:"October",active:!1},{id:11,value:"Nov",label:"November",active:!1},{id:12,value:"Dec",label:"December",active:!1}],t.dates=[];for(var n=1;32>n;n++)t.dates.push({id:n,value:n,label:n,active:!1});t.endOptions||(t.endOptions=[{id:"after",value:"After"},{id:"onDate",value:"On date"}]),t.paymentOrder.scheduledTransfer.endOn=t.endOptions[0].id,t.customOrder=!1,t.dateWarning=!1,t.calendar={startCalendarOpen:!1,endCalendarOpen:!1},t.endDateOptions={datepickerMode:"year","show-weeks":!1},t.startDateOptions={"show-weeks":!1},t.timesEndDate=t.paymentOrder.scheduledTransfer.endDate,t.setEndDate()},o=r[0],c=r[1];o.$name="scheduledTransfer",c.$addControl(o),o.$formatters.push(function(e){if(e.intervals.length>0){var n,a;if(e.frequency===t.frequenciesEnum.WEEKLY){for(n=0;n<e.intervals.length;n++)for(a=0;a<t.days.length;a++)if(e.intervals[n]===t.days[a].id){t.days[a].active=!0;break}}else if(e.frequency===t.frequenciesEnum.MONTHLY){for(n=0;n<e.intervals.length;n++)for(a=0;a<t.dates.length;a++)if(e.intervals[n]===t.dates[a].id){t.dates[a].active=!0;break}}else if(e.frequency===t.frequenciesEnum.YEARLY)for(n=0;n<e.intervals.length;n++)for(a=0;a<t.months.length;a++)if(e.intervals[n]===t.months[a].id){t.months[a].active=!0;break}}t.paymentOrder.scheduledTransfer.frequency=""===e.frequency?t.frequencies[0].id:e.frequency,p()?t.customOrder=!0:t.customOrder=!1,d(),t.setTransferPeriodDates()}),t.frequencyChanged=function(){u(),t.setTransferPeriodDates(),p()?(t.customOrder=!0,l(),t.paymentOrder.scheduledTransfer.customOrder=!0):(t.customOrder=!1,o.$setValidity("intervalsRequired",!0),t.paymentOrder.scheduledTransfer.customOrder=!1),d()},t.toggleInterval=function(e){var n,a;if(t.paymentOrder.scheduledTransfer.frequency===t.frequenciesEnum.WEEKLY?n=t.days:t.paymentOrder.scheduledTransfer.frequency===t.frequenciesEnum.MONTHLY?n=t.dates:t.paymentOrder.scheduledTransfer.frequency===t.frequenciesEnum.YEARLY&&(n=t.months),a=n[e],a.active){var r=t.paymentOrder.scheduledTransfer.intervals.indexOf(a.id);t.paymentOrder.scheduledTransfer.intervals.splice(r,1)}else t.paymentOrder.scheduledTransfer.intervals.push(a.id);a.active=!a.active,l(),d(),t.setEndDate()};var l=function(){var e=!0;e=t.paymentOrder.scheduledTransfer.intervals.length>0?!0:!1,e=t.customOrder?e:!0,e=t.paymentOrder.isScheduledTransfer?e:!0,o.$setValidity("intervalsRequired",e)},u=function(){t.paymentOrder.scheduledTransfer.intervals=[];var e;for(e=0;e<t.days.length;e++)t.days[e].active=!1;for(e=0;e<t.dates.length;e++)t.dates[e].active=!1;for(e=0;e<t.months.length;e++)t.months[e].active=!1};t.openStartCalendar=function(e){("click"===e.type||32===e.which||13===e.which)&&(e.preventDefault(),e.stopPropagation(),t.calendar.endCalendarOpen=!1,t.calendar.startCalendarOpen=!t.calendar.startCalendarOpen)},t.openEndCalendar=function(e){("click"===e.type||32===e.which||13===e.which)&&(e.preventDefault(),e.stopPropagation(),t.calendar.startCalendarOpen=!1,t.calendar.endCalendarOpen=!t.calendar.endCalendarOpen)},t.setTransferPeriodDates=function(){"object"!=typeof t.paymentOrder.scheduledTransfer.startDate&&(p()?t.paymentOrder.scheduledTransfer.startDate=new Date(t.todaysDate.getTime()):t.paymentOrder.scheduledTransfer.frequency===t.frequenciesEnum.END_OF_THE_MONTH?t.paymentOrder.scheduledTransfer.startDate=i.getLastDayOfMonth():t.paymentOrder.scheduledTransfer.frequency===t.frequenciesEnum.START_OF_THE_MONTH?t.paymentOrder.scheduledTransfer.startDate=i.getFirstDayOfMonth():t.paymentOrder.scheduledTransfer.frequency===t.frequenciesEnum.LAST_FRIDAY_OF_THE_MONTH&&(t.paymentOrder.scheduledTransfer.startDate=i.getLastFridayOfMonth())),t.setEndDate()},t.setEndDate=function(){var e;if(t.paymentOrder.scheduledTransfer.startDate){var n=new Date(t.paymentOrder.scheduledTransfer.startDate.getTime());p()?(e=t.paymentOrder.scheduledTransfer.timesToRepeat*t.paymentOrder.scheduledTransfer.every,t.paymentOrder.scheduledTransfer.frequency===t.frequenciesEnum.WEEKLY?n=i.addWeeksToDate(n,e):t.paymentOrder.scheduledTransfer.frequency===t.frequenciesEnum.MONTHLY?n=i.addMonthsToDate(n,e):t.paymentOrder.scheduledTransfer.frequency===t.frequenciesEnum.YEARLY&&(n=i.addYearsToDate(n,e))):(e=t.paymentOrder.scheduledTransfer.timesToRepeat,e=t.paymentOrder.scheduledTransfer.timesToRepeat,t.paymentOrder.scheduledTransfer.frequency===t.frequenciesEnum.END_OF_THE_MONTH?n=i.getLastDayOfMonthPlusTime(n,e):t.paymentOrder.scheduledTransfer.frequency===t.frequenciesEnum.START_OF_THE_MONTH?n=i.getFirstDayOfMonthPlusTime(n,e):t.paymentOrder.scheduledTransfer.frequency===t.frequenciesEnum.LAST_FRIDAY_OF_THE_MONTH&&(n=i.getLastFridayOfMonthPlusTime(n,e))),
t.paymentOrder.scheduledTransfer.endDate=n,t.minEndDate=i.calculateMinimumEndDate(t.paymentOrder.scheduledTransfer.frequency,t.paymentOrder.scheduledTransfer.every,new Date(t.paymentOrder.scheduledTransfer.startDate.getTime())),t.timesEndDate=new Date(t.paymentOrder.scheduledTransfer.endDate.getTime()).toString("d-MMM-yyyy")}};var d=function(){var e=!1;if(t.paymentOrder.scheduledTransfer.intervals.length>0&&t.paymentOrder.scheduledTransfer.frequency===t.frequenciesEnum.MONTHLY)for(var n=28;31>n;n++)t.dates[n].active&&(e=!0);t.dateWarning=e};t.$watch("paymentOrder.isScheduledTransfer",function(e){l()}),t.$on("reset",function(){t.paymentOrder.scheduledTransfer.frequency=t.frequencies[0].id,t.customOrder=!1,t.paymentOrder.scheduledTransfer.customOrder=!1});var p=function(){return t.paymentOrder.scheduledTransfer.frequency===t.frequenciesEnum.WEEKLY||t.paymentOrder.scheduledTransfer.frequency===t.frequenciesEnum.MONTHLY||t.paymentOrder.scheduledTransfer.frequency===t.frequenciesEnum.YEARLY};s()}}},e.scheduledTransfer.$inject=["ScheduledDateCalculator"]}.call(t,n,t,e),!(void 0!==a&&(e.exports=a))},function(e,t,n){var a;(function(e){a=function(require,e,t){"use strict";t.name="module-payments-migration";var a=n(2),r=[];t.exports=a.createModule(t.name,r).directive(n(12)).directive(n(13)).directive(n(14)).directive(n(15)).directive(n(16)).filter(n(17)).factory(n(18)).directive(n(19)).directive(n(20)).directive(n(21)).directive(n(22)).directive(n(23)).directive(n(24)).directive(n(25)).directive(n(26)).directive(n(27))}.call(t,n,t,e),!(void 0!==a&&(e.exports=a))}).call(t,n(1)(e))},function(e,t,n){var a;a=function(require,e,t){"use strict";e.addressTransfer=function(e,t){return e.put("$addressTransferTemplate.html",'<div class="lp-address-transfer"><div class="col-xs-12"><input type="input" class="form-control" ng-model="address.addressOne" placeholder="Address Line 1" aria-label="Address Line One" /><input type="input" class="form-control" ng-model="address.addressTwo" placeholder="Address Line 2" aria-label="Address Line Two"  /></div><div class="col-xs-12"><input type="input" class="form-control" ng-model="address.city" placeholder="City" aria-label="City" /></div><div class="col-xs-12"><div class="col-xs-5"><input type="input" class="form-control" ng-model="address.state" placeholder="State" aria-label="State" /></div><div ng-class="{\'col-xs-offset-1\': true, \'col-xs-6\': true, \'has-feedback\': address.zip.length > 0, \'has-error\': address.zip.length > 0 && !validZip, \'has-success\': address.zip.length > 0 && validZip}"><input type="input" class="form-control" ng-model="address.zip" placeholder="Zip" aria-label="Zip" /><span ng-if="validZip && address.zip.length > 0" class="glyphicon glyphicon-ok form-control-feedback"></span><span ng-if="!validZip && address.zip.length > 0" ng-click="clear()" class="glyphicon glyphicon-remove form-control-feedback"></span></div></div><div class="warning"><span>Selecting this means a cheque will be printed and posted on your behalf. Can take 7-14 days.</span></div></div>'),{restrict:"EA",replace:!0,require:["ngModel","^form"],scope:{counterpartyAddress:"=ngModel",transferType:"=lpTransferType"},template:e.get("$addressTransferTemplate.html"),link:function(e,n,a,r){var i=function(){e.address={addressOne:"",addressTwo:"",city:"",state:"",zip:""},d(e.transferType)},s=r[0],o=r[1],c=t.p2pAddress;s.$name=a.name,o.$addControl(s),s.$formatters.push(function(e){return l(e),e});var l=function(t){var n=!0,a=!0,r=!0,i=!0,o=!0;if(t){var c=t.split(", ");e.address.addressOne=c[0],e.address.addressTwo=c[1],e.address.city=c[2],e.address.state=c[3],e.address.zip=c[4],0===c[0].length&&(n=!1),0===c[2].length&&(a=!1),0===c[3].length&&(r=!1),0===c[4].length?i=!1:o=u(c[4])}s.$setValidity("addressLineOne",n),s.$setValidity("addressCity",a),s.$setValidity("addressState",r),s.$setValidity("addressZip",i),s.$setValidity("addressValidZip",o)},u=function(t){var n=/^\d{5}(-\d{4})?$/,a=n.test(t);return e.validZip=a,a};e.$watch("address",function(t,n){t!==n&&(e.counterpartyAddress=t.addressOne+", "+t.addressTwo+", "+t.city+", "+t.state+", "+t.zip)},!0),e.$watch("transferType",function(e,t){e!==t&&d(e)});var d=function(t){t===c?l(e.counterpartyAddress||""):(s.$setValidity("addressLineOne",!0),s.$setValidity("addressCity",!0),s.$setValidity("addressState",!0),s.$setValidity("addressZip",!0),s.$setValidity("addressValidZip",!0))};i()}}},e.addressTransfer.$inject=["$templateCache","transferTypes"]}.call(t,n,t,e),!(void 0!==a&&(e.exports=a))},function(e,t,n){var a;a=function(require,e,t){"use strict";var a=window.jQuery,r=n(2),i=r.ng,s=r.inject("lpUIUtils",n(5).name);e.counterPartyFilter=function(e,t,n,r,o,c){return e.put("$counterPartyFilter.html",'<div class="lp-counter-party-filter"><div class="input-group has-clear"><input class="name-field form-control" type="text" ng-model="counterpartyName" ng-click="showContactList()" ng-keydown="showContactList($event)" aria-label="Counterparty Name" /><span class="counterparty-to text-muted">To:</span><span class="input-clear" ng-click="clearCounterParty()" ng-show="counterpartyName.length"><i class="glyphicon glyphicon-remove cursor-pointer"></i></span><span class="input-group-btn"><button type="button" role="button" aria-label="Auto Suggest" tabindex="0" class="btn btn-default dropdown-toggle" ng-click="toggleShowContacts()"><i class="lp-icon lp-icon-addressbook"></i></button></span></div><div class="dropdown"><ul ng-show="showContacts && (counterpartyList | filter:counterpartyName).length > 0" class="col-xs-12 dropdown-menu filter-list" style="display: block;"><li class="contact" ng-repeat="contact in counterpartyList | filter: counterpartyName | limitTo: 25 track by $index" ><div class="border" ng-class="{\'border-my-accounts\': contact.ownAccounts, \'border-other\': !contact.ownAccounts}"></div><div class="filter-contact clearfix" ng-class="{\'single-account-selection\': contact.accounts.length === 1}" ng-click="prepareSelection(contact)" ng-keydown="handleContactAccountToggleKeyDown(contact, $event)" dynamic-focus="contact"><div class="pull-left photo-container"><img class="contact-photo media-object" ng-src="{{getProfileImageByName(contact.photoUrl,contact.name)}}" /></div><div class="contact-info pull-left contact-details"><span class="contact-name">{{contact.name}}</span><p class="account-info" ng-if="contact.accounts.length > 1">{{contact.accounts.length}} account(s)</p><p class="account-info" ng-if="contact.accounts.length === 1">{{contact.accounts[0].account}}</p></div><div ng-if="contact.accounts.length > 1" class="pull-left contact-account-list"><p tabindex="0" class="toggle-accounts" ng-show="!contact.open" ng-click="toggleContactAccounts(contact)" ng-keydown="handleContactAccountToggleKeyDown(contact, $event)"  aria-label="View accounts for {{contact.name}}">View all accounts <span class="caret"></span></p><p tabindex="0" class="toggle-accounts" ng-show="contact.open" ng-click="toggleContactAccounts(contact)" ng-keydown="handleContactAccountToggleKeyDown(contact, $event)" aria-label="Close accounts for {{contact.name}}">Close all accounts <span class="caret"></span></p><div class="contact-accounts" ng-class="{\'contact-accounts-open\': contact.open}"><div tabindex="0" ng-show="contact.open" ng-repeat="account in contact.accounts track by $index" class="contact-single-account" ng-click="prepareSelection(contact, account)" ng-keydown="handleSingleAccountKeyDown(contact, account, $event)" dynamic-aria-label="dynamic-aria-label" aria-contact="contact" aria-account="account"><div class="col-xs-10 col-xs-offset-2"><p ng-if="account.name">{{account.name}}</p><p>{{account.account}}</p></div></div></div></div></div></li></ul></div></div>'),{restrict:"A",scope:{counterpartyName:"=ngModel",contacts:"=lpContacts",accounts:"=lpAccounts",onSelect:"="},require:["ngModel","^form"],template:e.get("$counterPartyFilter.html"),link:function(e,l,u,d){var p=d[0],f=d[1];p.$name=u.name,f.$addControl(p);var m=i.element(l.find("input")),y=l.get(0),h={up:38,down:40,enter:13},v={email:t.p2pEmail,account:t.bank},g=function(){e.counterpartyList=[],e.showContacts=!1;var t=c.resolvePortalPlaceholders("$(servicesPath)/services/rest/v1/party-data-management/party");r.get(t).then(function(t){t.fullname=[t.firstName,t.lastName].join(" "),t.activities.lastLoggedIn={key:"Last Logged In",value:t.activities.lastLoggedIn},c.map(t.details,function(e){e.key=c.startCase(e.key)}),e.profile=t,e.deregisterContactsWatch=e.$watch("contacts",function(t){t.length>0&&(b(e.contacts),e.deregisterContactsWatch())}),e.deregisterAccountsWatch=e.$watch("contacts",function(t){t.length>0&&(T(e.accounts),e.deregisterAccountsWatch())})}),e.accountsConfigured=!1,e.contactsConfigured=!1};p.$formatters.push(function(e){return e.length>0?p.$setValidity("required",!0):p.$setValidity("required",!1),e}),p.$parsers.push(function(e){return e.length>0?p.$setValidity("required",!0):p.$setValidity("required",!1),e});var b=function(t){for(var n,a=0;a<t.length;a++){n=t[a],n.open=!1,n.accounts=[];for(var r in n)n.hasOwnProperty(r)&&v[r]&&n[r]&&n.accounts.push({type:v[r],account:n[r]});e.counterpartyList.push(n)}},T=function(n){var a={};a.name=e.profile.fullname,a.open=!1,a.ownAccounts=!0,a.accounts=[];for(var r=0;r<n.length;r++)a.accounts.push({type:t.bank,account:n[r].identifier,name:n[r].alias});e.counterpartyList.unshift(a)},O=function(){n.bind("click",function(t){y.contains(t.target)||(e.$apply(function(){e.showContacts=!1}),E())})},E=function(){n.unbind("click")},D=function(){return a(l.find(".contact")[0])},C=function(e){var t;e=i.element(event.target),e.next().hasClass("toggle-accounts")?t=e.next():e.prev().hasClass("toggle-accounts")&&(t=e.prev()),t&&setTimeout(function(){t.focus()},0)},q=function(e){return e.find(".toggle-accounts")},w=function(e){var t;t="block"===a(e[0]).css("display")?e[0]:e[1],t&&setTimeout(function(){t.focus()},0)},$=function(e){return e.parents(".contact")};e.toggleShowContacts=function(){e.showContacts=!e.showContacts,e.showContacts?O():E()},e.clearCounterParty=function(){e.counterpartyName="",e.showContacts=!0,O(),e.onSelect(),l.find(m)[0].focus()},e.$on("reset",function(){e.showContacts=!1}),e.showContactList=function(t){if(E(),!t||t.which===h.enter||t.which===h.down||t.which===h.up)if(t&&(t.preventDefault(),t.stopPropagation()),O(),e.showContacts)if(t&&t.which===h.down){var n=D(),a=q(n);a.length>0?w(a):n.find(".filter-contact").focus()}else!t||t.which!==h.up&&t.which!==h.enter||(e.showContacts=!1,E());else e.showContacts=!0},e.toggleContactAccounts=function(t){for(var n=0;n<e.counterpartyList.length;n++)e.counterpartyList[n]===t?e.counterpartyList[n].open=!e.counterpartyList[n].open:e.counterpartyList[n].open=!1},e.handleContactAccountToggleKeyDown=function(t,n){n.preventDefault(),n.stopPropagation(),n.which===h.enter?1===t.accounts.length?e.prepareSelection(t):(e.toggleContactAccounts(t),C(n.target)):(n.which===h.down||n.which===h.up)&&e.keyToNextAccountToggle(n)},e.handleSingleAccountKeyDown=function(t,n,a){a.preventDefault(),a.stopPropagation(),a.which===h.enter?e.prepareSelection(t,n):(a.which===h.down||a.which===h.up)&&e.keyToNextAccount(a)},e.keyToNextAccountToggle=function(e){var t,n=a(e.target),r=$(n);if(e.which===h.down)if(n.next("div").length>0)r.find(".contact-single-account")[0].focus();else{var i=r.next(".contact");t=q(i),t.length>0?w(t):i.find(".filter-contact").focus()}else if(e.which===h.up){var s=r.prev(".contact");t=q(s),t.length>0?w(t):s.find(".filter-contact").length>0?s.find(".filter-contact").focus():m.focus()}},e.keyToNextAccount=function(e){var t,n,r,i=a(e.target);e.which===h.down?1===i.next(".contact-single-account").length&&(t=i.next(".contact-single-account")):e.which===h.up&&(1===i.prev(".contact-single-account").length?t=i.prev(".contact-single-account"):(n=$(i),r=q(n),r.length>0&&w(r))),t&&setTimeout(function(){t.trigger("focus")},0)},e.prepareSelection=function(t,n){if(!n){if(t.accounts.length>1)return;n=t.accounts[0]}e.showContacts=!1,E(),p.$setViewValue(t.name),e.onSelect(n),setTimeout(function(){m.focus()},0)},e.getProfileImageByName=function(e,t){return e?s.decodePhotoUrl(e):t?s.getDefaultProfileImage(t,100,100):(o.throwException("Expected a name but got "+t),"")},g()}}},e.counterPartyFilter.$inject=["$templateCache","transferTypes","$document","lpUserDetails","lpCoreError","lpCoreUtils"]}.call(t,n,t,e),!(void 0!==a&&(e.exports=a))},function(e,t,n){var a;a=function(require,e,t){"use strict";e.dynamicAriaLabel=function(){return{restrict:"A",scope:{contact:"=ariaContact",account:"=ariaAccount"},link:function(e,t){var n="";if(n+=e.contact.name+" ",e.account.name)n+=e.account.name+" ";else{var a=e.account.type.toLowerCase();a=a.replace("_"," "),n+=a+" "}n+=e.account.account,t.attr("aria-label",n)}}}}.call(t,n,t,e),!(void 0!==a&&(e.exports=a))},function(e,t,n){var a;a=function(require,e,t){"use strict";e.dynamicFocus=function(){return{restrict:"A",scope:{contact:"=dynamicFocus"},link:function(e,t){1===e.contact.accounts.length&&(t.attr("tabindex","0"),t.attr("aria-label",e.contact.name+" "+e.contact.accounts[0].type.toLowerCase()+" "+e.contact.accounts[0].account))}}}}.call(t,n,t,e),!(void 0!==a&&(e.exports=a))},function(e,t,n){var a;a=function(require,e,t){"use strict";var a=n(2),r=a.ng,i=a.inject("lpCoreUtils",n(3).name);e.emailTransfer=function(e,t){return e.put("$emailTransferTemplate.html","<div class=\"lp-email-transfer\"><div ng-class=\"{'email-input': true, 'has-feedback': email.length > 0, 'has-success': email.length > 0 && validEmail, 'has-error': email.length > 0 && !validEmail}\">"+'<input type="input" ng-model="email" ng-keyup="handleAutoSuggest($event)" placeholder="Email address" class="form-control" aria-label="Email Address" /><span ng-if="validEmail && email.length > 0" class="glyphicon glyphicon-ok form-control-feedback"></span><span ng-if="!validEmail && email.length > 0" ng-click="clear()" style="cursor: pointer;" class="glyphicon glyphicon-remove form-control-feedback"></span></div><span ng-if="autoSuggestActive">Did you mean <span ng-click="doAutoSuggest()" class="auto-correct-suggestion">{{autoSuggestion}}</span>?<br /></span><span class="text-muted" style="font-size: 13px;">Transfers up to $10.00 will be free of charge. For transfers above $10.00 a fee of $0.25 per transaction will be charged and debited from your account</span></div>'),{restrict:"EA",replace:!0,require:["ngModel","^form"],scope:{email:"=ngModel",transferType:"=lpTransferType"},template:e.get("$emailTransferTemplate.html"),link:function(e,n,a,s){var o,c=function(){e.validEmail=!1,e.autoSuggestActive=!1,e.autoSuggestion="",o=r.element(n.find("input")[0]);var t={gmail:"gmail",yahoo:"yahoo",backbase:"backbase"};e.suggestionsMap={gmaik:t.gmail,gmain:t.gmail,gmal:t.gmail,gmakl:t.gmail,mgail:t.gmail,yaho:t.yahoo,yahooo:t.yahoo,yagoo:t.yahoo,bakbase:t.backbase,backbas:t.backbase,baclbase:t.backbase}},l=s[0],u=s[1],d=t.p2pEmail;l.$name=a.name,u.$addControl(l),l.$formatters.push(function(t){return(void 0!==t||null!==t)&&(e.validEmail=p(t?t.toLowerCase():"")),t&&-1===t.indexOf("@")&&(e.autoSuggestActive=!1),t}),e.clear=function(){e.email=""},e.handleAutoSuggest=function(t){var n,a;190===t.which?e.email.indexOf("@")>-1&&(n=e.email.split("@"),n[1]&&""!==n[1]&&(a=f(n[1]),void 0!==e.suggestionsMap[a]&&(e.autoSuggestion=e.suggestionsMap[a],e.autoSuggestActive=!0))):"[object KeyboardEvent]"===t.originalEvent.toString()&&8===t.which&&e.email.indexOf("@")>-1&&(n=e.email.split("@"),n[1]&&""!==n[1]&&(a=f(n[1]),void 0===e.suggestionsMap[a]&&(e.autoSuggestion="",e.autoSuggestActive=!1)))},e.doAutoSuggest=function(){var t=e.email.split("@");if(t[1]){var n=f(t[1]);t[1]=t[1].replace(n,e.autoSuggestion),e.email=t.join("@"),e.autoSuggestActive=!1,e.autoSuggestion=""}};var p=function(t){if(0===t.length&&e.transferType===d)return l.$setValidity("emailRequired",!1),!1;if(e.transferType===d){l.$setValidity("emailRequired",!0);var n=i.isValidEmail(t);return l.$setValidity("validEmailRequired",n),n}},f=function(e){var t,n=e.indexOf(".");return t=n>-1?e.substring(0,n):e};e.$watch("transferType",function(t,n){t!==d?(l.$setValidity("emailRequired",!0),l.$setValidity("validEmailRequired",!0)):e.validEmail=p(e.email)}),c()}}},e.emailTransfer.$inject=["$templateCache","transferTypes"]}.call(t,n,t,e),!(void 0!==a&&(e.exports=a))},function(e,t,n){var a;a=function(require,e,t){"use strict";e.addSeperator=function(){var e=" ",t=function(t){return 4===t.length&&(t+=e),t};return function(n){if(n){n=n.split(e).join(""),n=n.toUpperCase();for(var a=n.match(/.{1,4}/g),r="",i=0;i<a.length;i++)i!==a.length-1&&(a[i]=t(a[i])),r+=a[i];return r}}},e.addSeperator=function(){var e=" ",t=function(t){return 4===t.length&&(t+=e),t};return function(n){if(n){n=n.split(e).join(""),n=n.toUpperCase();for(var a=n.match(/.{1,4}/g),r="",i=0;i<a.length;i++)i!==a.length-1&&(a[i]=t(a[i])),r+=a[i];return r}}}}.call(t,n,t,e),!(void 0!==a&&(e.exports=a))},function(e,t,n){var a;a=function(require,e,t){"use strict";var a=n(2),r=a.ng,i=a.inject("lpCoreUtils",n(3).name);e.IbanModel=function(e){var t=function(t){this.enableCountrySearch=t.enableCountrySearch,this.countryListService=e.getInstance({endpoint:t.countryListEndpoint}),this.value="",this.valid=!1,this.countryList=[],this.selectedCountry={}};return t.prototype.loadCountryList=function(){var e=this,t=e.countryListService.read();return t.then(function(t){e.countryList=t.data},function(){e.error="countryListServiceError"}),t},t.prototype.getCountryCode=function(e){var t=this,n=null,a=e||t.value;if(a.match(/^[A-Za-z]{2}/g)){var i=a.substr(0,2);r.forEach(t.countryList,function(e){return e.country_code===i.toUpperCase()?(n=i,void(t.selectedCountry=e)):void 0})}return n},t.prototype.normalizeIban=function(e){return e&&(e=e.toUpperCase(),e=e.replace(/[\-\. ]/g,"")),e||""},t.prototype.validate=function(){if(this.value.length!==parseInt(this.selectedCountry.iban_length,10))return this.valid=!1,!1;var e=new RegExp(this.selectedCountry.iban_regex);return e.test(this.value)&&i.isValidISO7064Checksum(this.value)?(this.valid=!0,!0):(this.valid=!1,!1)},{getInstance:function(e){return new t(e)}}},e.IbanModel.$inject=["httpService"]}.call(t,n,t,e),!(void 0!==a&&(e.exports=a))},function(e,t,n){var a;a=function(require,e,t){"use strict";var n=function(e){var t=function(){e.wholeAmount="",e.decimalAmount="",e.amountInDomesticCurrency="0.00",e.fieldLength=6};t()};n.$inject=["$scope"],e.lpCurrencyAmountInput=function(e){return e.put("$currencyAmountTemplate.html",'<div class="lp-currency-amount-input"><div class="clearfix"><div class="select-area pull-left"><div class="currency-select" ng-hide="lpDisableCurrencySelection" dropdown-select="dropdown-select" empty-placeholder-text="EUR" ng-model="lpCurrencyList.selected" ng-options="val as val.currency_code group by val.group for val in lpCurrencyList.orderedCurrencies" ng-hide="lpCurrencyList.error" aria-required="true" aria-label="currency"></div></div><div class="amount-area pull-left" ng-class="{\'input-group\': lpAmountLabel}"><span class="input-group-addon lp-amount-label" ng-if="lpAmountLabel">{{lpAmountLabel}}</span><input name="wholeAmountInput" type="number" lp-number-input="lp-number-input" lp-max-length="fieldLength" min="0" step="1" class="form-control whole-amount-input pull-left" ng-model="wholeAmount" placeholder="{{lpAmountPlaceholder || \'Amount\'}}" aria-required="true" aria-label="amount" /><div  class="pull-left decimal"><span class="decimal-point">.</span></div><input type="text" pattern="[0-9]" lp-number-input="lp-number-input" lp-max-length="2" min="0" step="1" class="form-control pull-left decimal-amount-input" ng-model="decimalAmount" placeholder="00"  aria-required="true" aria-label="decimal amount" /></div></div><div class="info"><div ng-hide="lpDisableCurrencySelection || lpCurrencyList.error || lpCurrencyList.selected === lpCurrencyList.defaultCurrency" class="info-message"><span class="text-muted">This transfer is {{amountInDomesticCurrency}} in {{lpCurrencyList.defaultCurrency.currency_code}}<i class="lp-icon lp-icon-xxl lp-icon-info-sign open-popup" ng-click="toggleExchangeRateModal()"></i></span></div></div></div>'),{restrict:"EA",scope:{amount:"=ngModel",lpCurrencyList:"=",lpPaymentOrder:"=",lpDisableCurrencySelection:"=",lpAmountLabel:"@",lpAmountPlaceholder:"@",toggleExchangeRateModal:"=modal"},require:"ngModel",replace:!0,controller:n,template:e.get("$currencyAmountTemplate.html"),link:function(e,t,n,a){var r=t.find(".decimal-amount-input");a.$formatters.push(function(t){if(!t)return t;var n=o();if("0.00"!==t&&""!==t&&t!==n){var a=t.split(".");e.wholeAmount=parseInt(a[0],10),"00"!==a[1]&&(e.decimalAmount=a[1])}return t});var i=function(){var t=e.amount;t/=e.lpCurrencyList.selected.exchange_rate,t=c(t),e.amountInDomesticCurrency=t},s=function(){var t=o(),n=parseInt(e.wholeAmount,10);e.fieldLength&&n.toString().length>e.fieldLength?a.$setValidity("lpCurrencyMaxLength",!1):a.$setValidity("lpCurrencyMaxLength",!0),"0.00"===t?a.$setValidity("lpAmountRequired",!1):t.length>0&&a.$setValidity("lpAmountRequired",!0),e.amount=t,e.lpCurrencyList&&e.lpCurrencyList.orderedCurrencies.length>0&&i()},o=function(){var t=e.decimalAmount,n=parseInt(e.wholeAmount,10),a=/^0[0-9].*$/;n=isNaN(n)?0:n,10>t&&!a.test(t)&&(t="0"+t),t=parseFloat("0."+t);var r=0===t?n:n+t;return r=c(r)},c=function(e){return e.toFixed(2)},l=function(){e.lpPaymentOrder.instructedCurrency=e.lpCurrencyList.selected.currency_code,u()},u=function(){var t=e.fieldLength;e.fieldLength=e.lpCurrencyList.selected.exchange_rate>2?8:6,t>e.fieldLength&&e.wholeAmount.toString().length>6?(e.wholeAmount=parseInt(e.wholeAmount.toString().substring(0,6),10),s()):(""!==e.wholeAmount||""!==e.decimalAmount)&&i()};e.$watchCollection("[wholeAmount, decimalAmount]",function(t){t[0]&&t[0].toString().indexOf(".")>-1&&(e.wholeAmount=parseInt(e.wholeAmount.toString().replace(".",""),10),r.focus()),s()}),e.$watch("lpCurrencyList.selected",function(){e.lpCurrencyList&&e.lpCurrencyList.selected&&e.lpCurrencyList.orderedCurrencies.length>1&&l()}),e.$on("reset",function(){e.wholeAmount="",e.decimalAmount="",e.amountInDomesticCurrency="0.00",e.fieldLength=6})}}},e.lpCurrencyAmountInput.$inject=["$templateCache"]}.call(t,n,t,e),!(void 0!==a&&(e.exports=a))},function(e,t,n){var a;a=function(require,e,t){"use strict";e.lpFormatPaymentReference=function(e){return{restrict:"A",require:"ngModel",link:function(t,n,a,r){var i=function(t){if(t&&t.length>2){var n=t.substring(0,2);"RF"!==n&&(t="RF"+t)}var a=e("addSeperator")(t);return a!==t&&(r.$setViewValue(a),r.$render()),a};r.$parsers.push(i)}}},e.lpFormatPaymentReference.$inject=["$filter"];var n=function(e){var t=function(){e.paymentReference="",e.paymentDescription="",e.showInfoMessage=!1,e.paymentRefDisabled=!1,e.paymentDescDisabled=!1};t()};n.$inject=["$scope"]}.call(t,n,t,e),!(void 0!==a&&(e.exports=a))},function(e,t,n){var a;a=function(require,e,t){"use strict";e.lpFormatUsAccount=function(e){return{restrict:"A",require:"ngModel",link:function(t,n,a,r){var i=function(t){var n=e("addSeperator")(t);return n!==t&&(r.$setViewValue(n),r.$render()),n};r.$parsers.push(i)}}},e.lpFormatUsAccount.$inject=["$filter"]}.call(t,n,t,e),!(void 0!==a&&(e.exports=a))},function(e,t,n){var a;a=function(require,e,t){"use strict";var a=window.jQuery,r=n(2),i=(r.ng,r.inject("lpUIUtils",n(5).name));e.lpIbanInput=function(e,t,n,r){return e.put("$ibanCountryOptionTemplate.html",'<span aria-label="{{option.country_name}}">{{option.country_code}}<span class="country-name"> - {{option.country_name}}</span></span>'),{restrict:"EA",replace:!0,require:["ngModel","^form"],scope:{ibanModel:"=lpCountryList",transferType:"=lpTransferType"},template:'<div><div class="lp-iban"><div class="lp-iban-country-dropdown"><div dropdown-select="dropdown-select" empty-placeholder-text="NL" name="ibaneDropdownField" ng-model="iban.selectedCountry" ng-options="country.country_code as country for country in ibanModel.countryList" filter="ibanModel.enableCountrySearch" filter-placeholder-text="Search country" ng-change="change()" option-template-url="$ibanCountryOptionTemplate.html" aria-label="iban country code"></div></div><div class="lp-iban-input" ng-class="{\'has-success\': ibanModel.valid && iban.value.length, \'has-error\': !ibanModel.valid && iban.value.length,  \'has-feedback\': iban.value.length}"><input name="ibanInputField" ng-required="transferType === \'BANK\'" type="input" class="form-control" lp-input-overflow="lp-input-overflow" ng-model="iban.value"  aria-required="true" ng-keydown="getSelection($event)" ng-keypress="getSelection($event)" ng-mousedown="getSelection($event)" ng-mouseup="getSelection($event)" ng-change="change()" tabindex="0" placeholder="Enter IBAN or Account Number" aria-label="Enter IBAN or Account Number"><span ng-if="ibanModel.valid && iban.value.length" class="glyphicon glyphicon-ok form-control-feedback"></span><span ng-if="!ibanModel.valid && iban.value.length" ng-click="clear()" class="glyphicon glyphicon-remove form-control-feedback"></span></div></div><span class="text-muted">{{testiban}}</span></div>',link:function(e,n,r,s){var o=s[0],c=s[1],l=n.find("input")[0],u=[],d=!1,p=0,f=a(n[0]),m="BANK";f.find('div[name="ibaneDropdownField"]').on("keypress",function(e){13===e.which&&t(function(){f.find('input[type="search"]').focus()})}),e.iban={},o.$name=r.name,c.$addControl(o),e.$watch("ibanModel.countryList",function(t){e.change(!0),e.ibanModel.countryList.length&&!e.iban.selectedCountry&&(e.iban.selectedCountry=e.ibanModel.countryList[0].country_code)}),o.$formatters.push(function(t){e.ibanModel.value=t,e.iban.value=v(t);var n=e.ibanModel.getCountryCode();e.ibanModel.validate(),n&&e.change(!0);var a=n?e.ibanModel.valid:!1;return o.$setValidity("validIban",a),t}),o.$parsers.push(function(t){var n=e.ibanModel.getCountryCode()?e.ibanModel.validate():!1;return h(t),n?t:void 0});var y=a(document.createElement("span"));y.addClass("lp-input-cursor-position-offset"),y.css("font-size",n.css("font-size")),a(l).after(y);var h=function(t){if(t!==m)o.$setValidity("validIban",!0),o.$setValidity("required",!0);else{var n=e.ibanModel.getCountryCode()?e.ibanModel.validate():!1;o.$setValidity("validIban",n)}},v=function(e){var t=[];for(t.push(e.substr(0,2)),e=e.substr(2);e.length>0;)t.push(e.substr(0,4)),e=e.substr(4);return t.join("-")};e.setCursorPosition=function(){var n=i.getNewCaretPosition(l,u,p,d);if(d=!1,n>2&&(n++,n>6)){var a=(n-3)/4;parseInt(a,10)===a&&n--,n+=parseInt(a,10)}t(function(){i.setCaretPositionOfInput(l,n,e.paymentReference,y)},20,!1)},e.getSelection=function(e){var t=function(e){var t=0,n=e;return n>2&&(n-=3,t++),t+=parseInt(n/5,10),e-t};u=i.getSelectionPositionOfInput(l,t),"[object KeyboardEvent]"===e.originalEvent.toString()&&8===e.originalEvent.which&&l.value.length&&(d=!0)},e.clear=function(){e.iban.value="",l.focus()},e.change=function(r){if(e.ibanModel.value!==e.ibanModel.normalizeIban(e.iban.selectedCountry+e.iban.value)){var i=e.ibanModel.normalizeIban(e.iban.value);e.ibanModel.getCountryCode(i)||(i=e.iban.selectedCountry+i),p=i.length-e.ibanModel.value.length,e.ibanModel.value=i,o.$setViewValue(i)}var s=e.ibanModel.getCountryCode();s&&(s!==e.iban.selectedCountry&&(e.iban.selectedCountry=s,a(n.find("button")[0]).addClass("lp-country-dropdown-update"),t(function(){a(n.find("button")[0]).removeClass("lp-country-dropdown-update")},200,!1)),e.iban.value=e.ibanModel.value.substr(2)),e.iban.value=v(e.ibanModel.normalizeIban(e.iban.value)),r||e.setCursorPosition()},e.$watch("transferType",function(e,t){h(e)}),h(e.transferType)}}},e.lpIbanInput.$inject=["$templateCache","$timeout","IbanModel","widget"]}.call(t,n,t,e),!(void 0!==a&&(e.exports=a))},function(e,t,n){var a;a=function(require,e,t){"use strict";e.lpInputCurrency=function(e){return{restrict:"A",require:"ngModel",link:function(t,n,a,r){var i=/^\d+((\.|\,)\d+)?$/,s=function(e,t,n){r.$setValidity("lpCurrencyFormat",e),e||(t=!0,n=!0),r.$setValidity("lpCurrencyNonZero",t),r.$setValidity("lpCurrencyMaxLength",n)};r.$parsers.unshift(function(t){return t?(t=t.replace(",","."),s(i.test(t),0!==parseFloat(t),t.length<e)):s(!0,!0,!0),t})}}},e.lpInputCurrency.$inject=["currencyMaxLength"]}.call(t,n,t,e),!(void 0!==a&&(e.exports=a))},function(e,t,n){var a;a=function(require,e,t){"use strict";var a=n(2),r=a.inject("lpUIUtils",n(5).name),i=a.inject("lpCoreUtils",n(3).name);e.lpPaymentRefDescription=function(e,t,n){return e.put("$paymentRefDescription.html",'<div class="lp-payment-ref-description"><div ng-hide="hidePaymentReference" class="lp-payment-reference" ng-class="{\'has-success\': isValid && paymentReference.length > 0, \'has-error\': !isValid && paymentReference.length > 0,  \'has-feedback\': paymentReference.length}"><input  class="form-control" aria-label="payment reference" lp-payment-reference-field" type="text" placeholder="Payment reference (optional)" maxlength="31" ng-model="paymentReference" ng-disabled="paymentRefDisabled" lp-input-overflow="lp-input-overflow" ng-keydown="getSelection($event)" ng-keypress="getSelection($event)" ng-mousedown="getSelection($event)" ng-mouseup="getSelection($event)" lp-format-payment-reference="lp-format-payment-reference" /><span ng-if="isValid && paymentReference.length" class="glyphicon glyphicon-ok form-control-feedback"></span><span ng-click="clearRef()" ng-if="!isValid && paymentReference.length" class="glyphicon glyphicon-remove form-control-feedback"></span><div class="lp-input-dividers clearfix"><div class="separator"></div><div class="separator"></div><div class="separator"></div><div class="separator"></div><div class="separator"></div><div class="separator"></div></div></div><div class="lp-payment-description"><textarea aria-label="payment description" class="form-control lp-payment-description-area" placeholder="Description (optional) Maximum number of characters is 140" maxlength="140" ng-model="paymentDescription" ng-disabled="paymentDescDisabled"></textarea></div><div ng-if="!hidePaymentReference" class="hover-catcher" ng-class="{refDisabled: paymentRefDisabled, descDisabled: paymentDescDisabled}" tooltip-placement="top" tooltip="You can only provide a Payment Reference or a Payment Description, not both."></div></div>'),{restrict:"AE",replace:!0,require:["ngModel","^form"],scope:{paymentOrder:"=ngModel",hidePaymentReference:"="},template:e.get("$paymentRefDescription.html"),link:function(e,a,s,o){var c=o[0],l=o[1],u=a.find("input"),d=(a.find(".hover-catcher"),a.find("textarea"),u[0]),p=[],f=!1,m=0;c.$name=s.name;var y=$(document.createElement("span"));y.addClass("lp-input-cursor-position-offset"),y.css("font-size",a.css("font-size")),$(d).after(y),""!==e.paymentOrder.paymentReference?(e.paymentReference=n("addSeperator")(e.paymentOrder.paymentReference),e.paymentDescDisabled=!0):""!==e.paymentOrder.paymentDescription&&(e.paymentDescription=e.paymentOrder.paymentDescription,e.paymentRefDisabled=!0),e.hidePaymentReference&&(e.paymentDescDisabled=!1);var h=function(e){return e.split(" ").join("")},v=function(e){var t=!0;return e.length>25&&(t=!1),e.match(/^RF\d{2}/)||(t=!1),i.isValidISO7064Checksum(e)||(t=!1),t};e.toggleInfoMessage=function(){e.showInfoMessage=!e.showInfoMessage},e.setCursorPosition=function(){var n=r.getNewCaretPosition(d,p,m,f);if(f=!1,n>4){var a=n/4;parseInt(a,10)===a&&n--,n+=parseInt(a,10)}t(function(){r.setCaretPositionOfInput(d,n,e.paymentReference,y)},20,!1)},e.getSelection=function(e){var t=function(e){var t=0;return t+=parseInt(e/5,10),e-t};p=r.getSelectionPositionOfInput(d,t),"[object KeyboardEvent]"===e.originalEvent.toString()&&8===e.originalEvent.which&&d.value.length&&(f=!0)},e.clearRef=function(){e.paymentReference="",d.focus()},e.$watch("paymentReference",function(t,n){if(n!==t){if(n||(n=""),t){if(t.length>0){l[c.$name]||l.$addControl(c);var a=h(t);e.isValid=v(a),c.$setValidity("validRef",e.isValid),m=n?a.length-h(n).length:a.length,e.paymentDescDisabled=!0,c.$modelValue.paymentReference=a}}else c.$modelValue.paymentReference="",
e.paymentDescDisabled=!1,l.$removeControl(c);e.setCursorPosition()}},!0),e.$watch("paymentDescription",function(t,n){n!==t&&(t?t.length>0&&(e.paymentRefDisabled=!0,c.$modelValue.paymentDescription=t):(e.paymentRefDisabled=!1,c.$modelValue.paymentDescription=""))},!0),e.$on("reset",function(){e.paymentReference="",e.paymentDescription="",e.showInfoMessage=!1,e.paymentRefDisabled=!1,e.paymentDescDisabled=!1})}}},e.lpPaymentRefDescription.$inject=["$templateCache","$timeout","$filter"]}.call(t,n,t,e),!(void 0!==a&&(e.exports=a))},function(e,t,n){var a;a=function(require,e,t){"use strict";e.nonZero=function(){return{restrict:"A",require:"ngModel",link:function(e,t,n,a){a.$parsers.unshift(function(e){return a.$setValidity("nonZero",0!==parseInt(e,10)),e})}}}}.call(t,n,t,e),!(void 0!==a&&(e.exports=a))},function(e,t,n){var a;a=function(require,e,t){"use strict";var a=n(2),r=a.inject("lpCoreUtils",n(3).name);e.p2pEnrollment=function(e,t){return e.put("$emailTemplate.html",'<div class="lp-p2p-enrollment"><p class="warning">We also need a few details from you to make the transfer</p><div lp-accounts-select="lp-accounts-select" designated-class="lp-normal-account-select-size" ng-model="p2pRegistration.p2pAccount" lp-accounts="accounts" name="p2pAccountSelect" ng-change="onP2PAccountChange()"></div><ul tabset="tabset" class="nav-tabs"><li tab="tab"><span tab-heading="tab-heading" class="tab-heading">Email</span><div ng-class="{\'email-input-form\': true, \'has-feedback\': enrollment.email.length > 0, \'has-success\': enrollment.email.length > 0 && validEmail, \'has-error\': enrollment.email.length > 0 && !validEmail}"><input type="input" class="form-control" ng-model="enrollment.email" placeholder="Confirm your email" ng-change="onEmailChange()" aria-label="Email Address"/><span ng-if="validEmail && enrollment.email.length > 0" class="glyphicon glyphicon-ok form-control-feedback"></span><span ng-if="!validEmail && enrollment.email.length > 0" ng-click="clearEmail()" style="cursor: pointer;" class="glyphicon glyphicon-remove form-control-feedback"></span></div></li></ul><div class="ts-and-cs" class="clearfix"><div class="pull-left ts-cs-check"><input type="checkbox" ng-model="p2pRegistration.userAgrees" ng-change="onAgreementChange()" aria-label="Do you agree with terms and conditions?" /></div><div class="pull-left ts-cs-details"><p>By registering this mobile number or email address, I agree that I am the email or mobile account holder, and I consent to receive email and automated text message about transfers at this time. Fees from carrier may apply</p></div></div></div>'),{restrict:"EA",replace:!0,require:["ngModel","^form"],scope:{accounts:"=lpAccounts",enrollment:"=ngModel",transferType:"=lpTransferType"},template:e.get("$emailTemplate.html"),link:function(e,n,a,i){var s=i[0],o=i[1];s.$name=a.name,o.$addControl(s);var c=[t.p2pEmail,t.p2pMobile,t.p2pAddress],l=function(){e.p2pRegistration={p2pAccount:{},userAgrees:!1},d(e.transferType)};e.clearEmail=function(){e.enrollment.email=""},e.onP2PAccountChange=function(){e.enrollment.receivingAccountNumber=e.p2pRegistration.p2pAccount.identifier,s.$setValidity("p2pAccountRequired",!0)},e.onEmailChange=function(){u()},e.onAgreementChange=function(){s.$setValidity("termsAndConditions",e.p2pRegistration.userAgrees)},e.$watch("transferType",function(e,t){e!==t&&d(e)});var u=function(){var t;t=e.enrollment?r.isValidEmail(e.enrollment.email):r.isValidEmail(""),s.$setValidity("validEmailRequired",t),e.validEmail=t},d=function(t){for(var n=!1,a=0;a<c.length;a++)t===c[a]&&(n=!0);n?(s.$setValidity("termsAndConditions",e.p2pRegistration.userAgrees),u(),s.$setValidity("p2pAccountRequired",!1)):(s.$setValidity("termsAndConditions",!0),s.$setValidity("validEmailRequired",!0),s.$setValidity("p2pAccountRequired",!0))};l()}}},e.p2pEnrollment.$inject=["$templateCache","transferTypes"]}.call(t,n,t,e),!(void 0!==a&&(e.exports=a))},function(e,t,n){var a;a=function(require,e,t){"use strict";var a=window.jQuery,r=n(2),i=r.inject("lpUIUtils",n(5).name);e.usAccountInput=function(e,t,n,r){return e.put("$usTransferCountryDropdownOption.html",'<span aria-label="{{option.country_name}}">{{option.country_code}}<span class="country-name"> - {{option.country_name}}</span></span>'),e.put("$usAccountInputTemplate.html",'<div class="lp-us-account-input"><div ng-class="{\'has-success\': isRoutingNoValid && routingNumber.length > 0, \'has-error\': !isRoutingNoValid && routingNumber.length, \'has-feedback\': routingNumber.length}"><input type="input" class="form-control routing-number" ng-model="routingNumber" lp-number-input="lp-number-input" min="0" maxlength="9" placeholder="{{\'Routing Number\'|translate}}" aria-required="true" aria-label="{{\'Routing Number\'|translate}}" /><span ng-if="isRoutingNoValid && routingNumber.length" class="glyphicon glyphicon-ok form-control-feedback"></span><span ng-click="resetRoutingNumber()" ng-if="!isRoutingNoValid && routingNumber.length" class="glyphicon glyphicon-remove form-control-feedback clickable-icon"></span></div><div class="lp-acc-plus-country"><div class="country-select" ng-if="showCountryDropdown"><div dropdown-select="dropdown-select" class="country-select" empty-placeholder-text="US" ng-model="selectedCountry" ng-options="country.country_code as country for country in lpCountryList.countries" option-template-url="$usTransferCountryDropdownOption.html"></div></div><div ng-class="{\'has-success\': isAccNoConfirmed && accountNumber.length > 0, \'has-warning\': !isAccNoConfirmed && accountNumber.length, \'has-feedback\': accountNumber.length, \'account-number\': true}"><input type="input" class="form-control" ng-model="accountNumber" lp-number-input="lp-number-input" maxlength="19" min="0" placeholder="{{\'Account Number\'|translate}}" aria-required="true" aria-label="{{\'Account Number\'|translate}}"ng-keydown="getSelection($event)" ng-keypress="getSelection($event)" ng-mousedown="getSelection($event)" ng-mouseup="getSelection($event)"lp-input-overflow="lp-input-overflow" lp-format-us-account="lp-format-us-account"/><span ng-if="isAccNoConfirmed && accountNumber.length" class="glyphicon glyphicon-ok form-control-feedback"></span><span ng-click="confirmAccountNumber()" ng-keydown="confirmKeydown($event)" tabindex="{{!isAccNoConfirmed && accountNumber.length ? 0 : -1}}" ng-if="!isAccNoConfirmed && accountNumber.length" class="glyphicon glyphicon-warning-sign form-control-feedback clickable-icon" aria-label="Confirm Account Number" role="button"></span><div class="lp-input-dividers clearfix" style="top: 28px;"><div class="separator"></div><div class="separator"></div><div class="separator"></div><div class="separator"></div><div class="separator"></div><div class="separator"></div></div></div></div><span class="lp-routing-info text-muted"><span lp-i18n="Where to find your account number & routing number"></span><i class="lp-icon lp-icon-xxl lp-icon-info-sign open-popup" ng-click="modal()"></i></span></div>'),{restrict:"EA",replace:!0,require:["ngModel","^form"],scope:{account:"=ngModel",lpCountryList:"=",modal:"=",transferType:"=lpTransferType"},template:e.get("$usAccountInputTemplate.html"),link:function(e,s,o,c){var l=function(){e.isAccNoConfirmed=!1,e.isRoutingNoValid=!1,e.showCountryDropdown=e.lpCountryList?!0:!1,e.showCountryDropdown&&e.lpCountryList.default_country&&(e.selectedCountry=e.lpCountryList.default_country.country_code),D(e.transferType||"")},u=c[0],d=c[1];u.$name=o.name,d.$addControl(u),u.$setValidity("accountNumberRequired",!1),u.$setValidity("routingNumberRequired",!1);var p=s.find("input")[1],f=[],m=!1,y=0,h=r.bank,v=a(document.createElement("span"));v.addClass("lp-input-cursor-position-offset"),v.css("font-size",s.css("font-size")),a(p).after(v),u.$formatters.push(function(t){if(t)if(isNaN(parseInt(t.substring(0,2),10)))e.accountNumber="",e.routingNumber="";else{var a=t.split(" ");e.routingNumber=a[0],e.accountNumber=n("addSeperator")(a[1]),g(e.routingNumber),T(e.accountNumber)}else e.accountNumber="",e.routingNumber="";return t}),u.$parsers.push(function(e){var t=e.split(" ");return g(t[0]),T(t[1]),e}),e.confirmAccountNumber=function(){e.isAccNoConfirmed=!0,u.$setValidity("accountNumberConfirmed",!0)},e.confirmKeydown=function(t){13===t.which&&(t.stopPropagation(),t.preventDefault(),e.confirmAccountNumber(),s.find(".routing-number").focus())},e.resetRoutingNumber=function(){e.routingNumber=""},e.getSelection=function(e){var t=function(e){var t=0;return t+=parseInt(e/5,10),e-t};f=i.getSelectionPositionOfInput(p,t),"[object KeyboardEvent]"===e.originalEvent.toString()&&8===e.originalEvent.which&&p.value.length&&(m=!0)},e.setCursorPosition=function(){var n=i.getNewCaretPosition(p,f,y,m);if(m=!1,n>4){var a=n/4;parseInt(a,10)===a&&n--,n+=parseInt(a,10)}t(function(){i.setCaretPositionOfInput(p,n,e.paymentReference,v)},20,!1)},e.$watch("accountNumber",function(t,n){t!==n&&(e.isAccNoConfirmed=!1,E(),e.setCursorPosition())}),e.$watch("routingNumber",function(e,t){e!==t&&E()}),e.$watch("transferType",function(e,t){e!==t&&D(e)}),e.$on("reset",function(){e.routingNumber="",e.accountNumber=""});var g=function(t){if(t.length<9)return e.isRoutingNoValid=!1,void b(t);var n;if("000000000"===t)n=!1;else{var a=parseInt(t[0],10)+parseInt(t[3],10)+parseInt(t[6],10),r=parseInt(t[1],10)+parseInt(t[4],10)+parseInt(t[7],10),i=parseInt(t[2],10)+parseInt(t[5],10)+parseInt(t[8],10),s=3*a+7*r+i;n=s%10,n=0===n?!0:!1}e.isRoutingNoValid=n,b(t)},b=function(t){var n=t.length>0?!0:!1,a=n&&!e.isRoutingNoValid?!1:!0;u.$setValidity("routingNumberRequired",n),u.$setValidity("invalidRoutingNumber",a)},T=function(t){var n=t&&t.length>0?!0:!1,a=t&&t.length>0&&!e.isAccNoConfirmed?!1:!0;u.$setValidity("accountNumberRequired",n),u.$setValidity("accountNumberConfirmed",a)},O=function(e){return e&&(e=e.replace(/ /g,"")),e||""},E=function(){var t=O(e.routingNumber)+" "+O(e.accountNumber);u.$setViewValue(t)},D=function(t){t!==h?(u.$setValidity("accountNumberRequired",!0),u.$setValidity("accountNumberConfirmed",!0),u.$setValidity("routingNumberRequired",!0),u.$setValidity("invalidRoutingNumber",!0)):(g(e.routingNumber||""),T(e.accountNumber||""))};l()}}},e.usAccountInput.$inject=["$templateCache","$timeout","$filter","transferTypes"]}.call(t,n,t,e),!(void 0!==a&&(e.exports=a))},function(e,t,n){var a;a=function(require,e,t){"use strict";e.transferTypes={bank:"INTERNAL",p2pEmail:"P2P_EMAIL",p2pAddress:"P2P_ADDRESS",p2pMobile:"P2P_MOBILE"},e.pendingPaymentOrdersTimeout=1e4,e.customerId="3",e.currencyMaxLength=15}.call(t,n,t,e),!(void 0!==a&&(e.exports=a))},function(e,t,n){var a;a=function(require,e,t){"use strict";e.lpPayments=function(){this.$get=function(e,t,n){function a(){var a=t(r.paymentsEndpoint,{},{getUnsubmitted:{method:"GET",url:r.paymentsEndpoint+"/:ids/unsubmitted",isArray:!0},create:{method:"PUT"},del:{method:"DELETE",url:r.paymentsEndpoint+"/:paymentId"},submit:{method:"POST",url:r.paymentsEndpoint+"/:paymentId/submit"}});return a.prototype.createOrder=function(t){var n=e.defer();return a.create({paymentId:t.id},t,function(e){n.resolve(e)},function(e){n.reject(e)}),n.promise},a.prototype.send=function(t,n){var r=e.defer();return a.submit(t,n||{},function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},a.prototype.remove=function(t){var n=e.defer();return a.del({paymentId:t},{},function(e){n.resolve(e)},function(e){n.reject(e)}),n.promise},a.prototype.createModel=function(){return new a({id:n.generateUUID()})},a.prototype.load=function(e){var t={f:0,l:100,ids:e.join()};return a.getUnsubmitted(t).$promise.then(function(e){return this.pendingOrdersGroups=this.preprocessPendingOrdersGroups(e),this.pendingOrdersGroups}.bind(this))},a.prototype.preprocessPendingOrdersGroups=function(e){for(var t,n=[],a=function(e){for(var t=!1,a=0;a<n.length;a++)n[a]["@id"]===e&&(t=!0);return t},r=function(e){n.push({"@id":e,paymentOrders:[]})},i=function(e){a(e.accountId)||r(e.accountId);for(var t=0;t<n.length;t++)n[t]["@id"]===e.accountId&&n[t].paymentOrders.push(e)},s=0;s<e.length;s++)t=e[s],t.counterpartyIban&&t.counterpartyIban.length>0?t.accountDetails=t.counterpartyIban:t.counterpartyAccount&&t.counterpartyAccount.length>0?t.accountDetails=t.counterpartyAccount:t.counterpartyEmail&&t.counterpartyEmail.length>0&&(t.accountDetails=t.counterpartyEmail),i(t);return n},a.prototype.makeFormObject=function(e){var t={update:!0,uuid:e.id,accountId:e.accountId,isScheduledTransfer:e.scheduledTransfer.every?!0:!1,scheduleDate:e.onDate?new Date(e.onDate):new Date,scheduledTransfer:{frequency:e.scheduledTransfer.frequency,every:e.scheduledTransfer.every,intervals:e.scheduledTransfer.intervals?[e.schedule.intervals]:[],timesToRepeat:e.scheduledTransfer.timesToRepeat||1,customOrder:e.scheduledTransfer.customOrder||!0,startDate:e.scheduledTransfer.startDate?new Date(e.scheduledTransfer.startDate):new Date},selectedCounter:{name:e.counterpartyName,account:e.counterpartyIban||e.counterpartyEmail},instructedCurrency:e.instructedCurrency,counterpartyName:e.counterpartyName,counterpartyAccount:e.counterpartyAccount,counterpartyIban:e.counterpartyIban||"",counterpartyEmail:e.counterpartyEmail,instructedAmount:e.instructedAmount.toFixed(2),paymentReference:e.paymentReference||"",paymentDescription:e.paymentDescription||"",counterpartyAddress:e.counterpartyAddress||"",isOpenDate:e.isOpenDate||!1,urgentTransfer:e.urgentTransfer||!1,type:e.type};return t},new a}var r={paymentsEndpoint:"/mock/v1/payments"};return{setConfig:function(e){return r=n(e).chain().mapValues(n.resolvePortalPlaceholders).defaults(r).value(),this},getConfig:function(e){return e&&n.isString(e)?r[e]:r},api:a}},this.$get.$inject=["$q","$resource","lpCoreUtils"]},e.PaymentOrderModel=e.lpPayments}.call(t,n,t,e),!(void 0!==a&&(e.exports=a))},function(e,t,n){var a;a=function(require,e,t){"use strict";function n(e){var t={"payment-orders":e};return{api:function(e){if("undefined"==typeof t[e])throw new Error("Unknown service "+e+" !!!");return t[e]}}}n.$inject=["PaymentOrders"],e.lpAccountTransfers=function(){this.$get=n}}.call(t,n,t,e),!(void 0!==a&&(e.exports=a))},function(e,t,n){var a;a=function(require,e,t){"use strict";function a(e,t){this.xhr=e,this.config={}}var r=n(2).utils,i={},s={url:"/mock/v2/payment-orders"};a.$inject=["$http","lpCoreError"],i.createModel=function(){return{}},i.createOrder=function(e){return this.xhr({method:"POST",url:this.config.url,data:e})},i.send=function(e,t){var n=this.config.url+"/"+e+"/submit";return this.xhr({method:"POST",url:n,data:t||{}})},i.remove=function(e){var t=this.config.url+"/"+e;return this.xhr({method:"DELETE",url:t})},i.makeFormObject=function(e){var t={update:!0,uuid:e.id,accountId:e.accountId,isScheduledTransfer:e.scheduledTransfer.every?!0:!1,scheduleDate:e.onDate?new Date(e.onDate):new Date,scheduledTransfer:{frequency:e.scheduledTransfer.frequency,every:e.scheduledTransfer.every,intervals:e.scheduledTransfer.intervals?[e.schedule.intervals]:[],timesToRepeat:e.scheduledTransfer.timesToRepeat||1,customOrder:e.scheduledTransfer.customOrder||!0,startDate:e.scheduledTransfer.startDate?new Date(e.scheduledTransfer.startDate):new Date},selectedCounter:{name:e.counterpartyName,account:e.counterpartyIban||e.counterpartyEmail},instructedCurrency:e.instructedCurrency,counterpartyName:e.counterpartyName,counterpartyAccount:e.counterpartyAccount,counterpartyIban:e.counterpartyIban||"",counterpartyEmail:e.counterpartyEmail,instructedAmount:e.instructedAmount.toFixed(2),paymentReference:e.paymentReference||"",paymentDescription:e.paymentDescription||"",counterpartyAddress:e.counterpartyAddress||"",isOpenDate:e.isOpenDate||!1,urgentTransfer:e.urgentTransfer||!1,type:e.type};return t},i.setConfig=function(e){return this.config=r.chain(e).mapValues(r.resolvePortalPlaceholders).defaults(s).value(),this},i.getConfig=function(e,t){return e&&r.isString(e)?this.config[e]||t:this.config},r.assign(a.prototype,i),e.PaymentOrders=a}.call(t,n,t,e),!(void 0!==a&&(e.exports=a))}])});