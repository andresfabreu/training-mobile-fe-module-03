!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("base"),require("core"),require("ui")):"function"==typeof define&&define.amd?define(["base","core","ui"],t):"object"==typeof exports?exports["module-accounts"]=t(require("base"),require("core"),require("ui")):e["module-accounts"]=t(e.base,e.core,e.ui)}(this,function(e,t,n){return function(e){function t(a){if(n[a])return n[a].exports;var r=n[a]={exports:{},id:a,loaded:!1};return e[a].call(r.exports,r,r.exports,t),r.loaded=!0,r.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){var a;(function(e){a=function(require,e,t){"use strict";t.name="module-accounts";var a=n(1),r=n(2),i=n(3),o=n(11),c=[r.name,i.name,o.name];t.exports=a.createModule(t.name,c).value("groupsTimeout",6e5).value("accountsTimeout",1e4).provider(n(4)).value("customerId","3").factory(n(5)).factory(n(6)).factory(n(7)).factory(n(8)).directive(n(9)).directive(n(10))}.call(t,n,t,e),!(void 0!==a&&(e.exports=a))}).call(t,n(12)(e))},function(t,n,a){t.exports=e},function(e,n,a){e.exports=t},function(e,t,a){e.exports=n},function(e,t,n){var a;a=function(require,e,t){"use strict";var n="accountsEndpoint",a="defaultAccount";e.lpAccounts=function(e){var t;this.setConfig=function(e){t=e};var r=function(t,n,a){var r,i;return a=a||"*",n=parseInt(n,10)||0,t?n?(i=e.range(n).map(function(){return a}).join(""),r=new RegExp("^.{0,"+n+"}","i"),t.replace(r,i)):t:""};this.$get=function(i,o){var c=function(e){this.accounts=[],this.error=!1,this.setConfig(e)};return c.prototype.setConfig=function(t){t&&t[n]&&(t[n]=e.resolvePortalPlaceholders(t[n])),this.config=t},c.prototype.getAttribute=function(e){return this.config&&this.config[e]},c.prototype.load=function(e){var t=o.defer(),a=this;return i.get(a.getAttribute(n)).then(function(n){a.refreshAccounts(n.data,e),t.resolve(a.accounts)}),t.promise.success=t.promise.then,t.promise.error=t.promise["catch"],t.promise},c.prototype.getAll=function(e){return this.load(e)},c.prototype.pluckDefaultAccount=function(t){var n=e(t);return n.first()},c.prototype.getDefaultAccountBban=function(){return this.getAttribute(a)},c.prototype.configureAccountIdentifiers=function(t){var n=this,a={EU:"IBAN",US:"BBAN","en-US":"BBAN"},i=function(t){return n.config[t]||e.getPagePreference(t)||e.getPortalProperty(t)},o=i("locale")||"EU";t.accountIdentification&&e.forEach(t.accountIdentification,function(e){e.scheme===a[o]&&(!i("hideAccount")&&i("maskAccount")?t.identifier=r(e.id,i("maskAccount")):i("hideAccount")||i("maskAccount")||(t.identifier=e.id))})},c.prototype.findById=function(e){return this.accounts.filter(function(t){return t.id===e})[0]},c.prototype.findByAccountNumber=function(e){return this.accounts.filter(function(t){return t.bban===e})[0]},c.prototype.getPending=function(e){return e.bookedBalance-e.availableBalance},c.prototype.getGroupSize=function(e){for(var t=0,n=0;n<this.accounts.length;n++)this.accounts[n].groupCode===e.code&&t++;return t},c.prototype.configurePreviousBalanceDeltas=function(e){var t=this;t.previousBalances?(e.delta=t.previousBalances[e.id]>e.availableBalance?-1:t.previousBalances[e.id]<e.availableBalance?1:0,t.previousBalances[e.id]=e.availableBalance):(t.previousBalances=[],e.delta=0,t.previousBalances[e.id]=e.availableBalance)},c.prototype.refreshAccounts=function(e,t){t===!0&&(this.accounts=[]);for(var n=0;n<e.length;n++)this.configureAccountIdentifiers(e[n]),this.configurePreviousBalanceDeltas(e[n]),this.formatAccountBalance(e[n]),this.accounts.push(e[n])},c.prototype.getGroupTotal=function(e){for(var t,n,a=0,r=0;r<this.accounts.length;r++)t=this.accounts[r],t.groupCode===e.code&&(a+=t.balance,n=t.currency);return{totalBalance:a,currency:n}},c.prototype.formatAccountBalance=function(e){e.availableBalance=parseFloat(e.availableBalance),e.bookedBalance=parseFloat(e.bookedBalance)},new c(t)},this.$get.$inject=["$http","$q"]},e.lpAccounts.$inject=["lpCoreUtils"],e.AccountsModel=e.lpAccounts}.call(t,n,t,e),!(void 0!==a&&(e.exports=a))},function(e,t,n){var a;a=function(require,e,t){"use strict";e.AccountsChartModel=function(e,t){var n=function(e){this.accountsChartModel=t.getInstance({endpoint:e.accountsChartEndpoint,urlVars:{accountId:e.accountId}}),this.chartData=null,this.error=!1};return n.prototype.load=function(e){var t,n=this;return t=n.accountsChartModel.read(e).success(function(e){n.chartData=e}),t.error(function(e){e.errors&&(n.error=e.errors[0].code)}),t},{getInstance:function(e){return new n(e)}}},e.AccountsChartModel.$inject=["$rootScope","httpService"]}.call(t,n,t,e),!(void 0!==a&&(e.exports=a))},function(e,t,n){var a;a=function(require,e,t){"use strict";e.AssetsModel=function(e,t,n,a,r,i){var o=function(e){var t=this;e.assetsEndpoint=r.resolvePortalPlaceholders(e.assetsEndpoint),t.assetsResource=a(e.assetsEndpoint),t.groupsEnabled=!!e.groupsEndpoint,t.groupsEnabled&&(e.groupsEndpoint=r.resolvePortalPlaceholders(e.groupsEndpoint),t.groupsResource=a(e.groupsEndpoint)),t.filterByGroupCode=e.groupCodeFilter,t.accounts=null,t.groups=null,t.assetCollection=[],t.error=!1,gadgets.pubsub.subscribe("launchpad-retail:ACCOUNT_BALANCE_CHANGED",function(e){null!==t.accounts&&t.load()})};return o.prototype.load=function(){var e=i.defer(),t=this;return t.assetsResource.get().$promise.then(function(n){t.accounts=n,gadgets.pubsub.publish("launchpad-retail.accountsLoaded",n["current-account"]),t.groupsResource?t.groupsResource.query().$promise.then(function(n){t.groups=n,t.configureAssetCollection(),e.resolve()}):e.resolve()}),e.promise},o.prototype.configureAssetCollection=function(){var e=this;if(e.groupsEnabled)for(var t,n=0;n<e.groups.length;n++){t={title:e.groups[n].defaultTitle,code:e.groups[n].code,accounts:[],isCollapsed:!1};for(var a in e.accounts)e.accounts.hasOwnProperty(a)&&a===e.groups[n].code&&(t.accounts=e.accounts[a]);if(t.accounts.length>0){for(var r=0;r<t.accounts.length;r++)e.formatAccountBalance(t.accounts[r]),e.configurePreviousBalanceDelta(t.accounts[r]);e.assetCollection.push(t)}}else for(var i in e.accounts)if(e.accounts.hasOwnProperty(i))for(var o=0;o<e.accounts[i].length;o++)e.formatAccountBalance(e.accounts[i][o]),e.configurePreviousBalanceDelta(e.accounts[i][o]),e.assetCollection.push(e.accounts[i][o])},o.prototype.getPending=function(e){return e.bookedBalance-e.availableBalance},o.prototype.configurePreviousBalanceDelta=function(e){var t=this;t.previousBalances?(e.delta=t.previousBalances[e.id]>e.availableBalance?-1:t.previousBalances[e.id]<e.availableBalance?1:0,t.previousBalances[e.id]=e.availableBalance):(t.previousBalances=[],e.delta=0,t.previousBalances[e.id]=e.availableBalance)},o.prototype.findById=function(e){var t,n=this;if(n.groupsEnabled){for(var a=0;a<n.assetCollection.length;a++)for(var r=0;r<n.assetCollection[a].accounts.length;r++)if(n.assetCollection[a].accounts[r].id===e){t=n.assetCollection[a].accounts[r];break}}else for(var i=0;i<n.assetCollection.length;i++)if(n.assetCollection[i].id===e){t=n.assetCollection[i];break}return t},o.prototype.getGroupTotal=function(e){for(var t,n,a=0,r=0;r<e.accounts.length;r++)t=e.accounts[r],a+=t.availableBalance,n=t.currency;return{totalBalance:a,currency:n}},o.prototype.formatAccountBalance=function(e){e.availableBalance=parseFloat(e.availableBalance),e.bookedBalance=parseFloat(e.bookedBalance)},{getInstance:function(e){return new o(e)}}},e.AssetsModel.$inject=["$rootScope","accountsTimeout","groupsTimeout","$resource","lpCoreUtils","$q"]}.call(t,n,t,e),!(void 0!==a&&(e.exports=a))},function(e,t,n){var a;a=function(require,e,t){"use strict";e.CardsModel=function(e,t){var n=function(n){var a=this;n.cardsEndpoint=e.resolvePortalPlaceholders(n.cardsEndpoint),a.cards=[],a.selected={},a.cardsService=t(n.cardsEndpoint,{},{update:{method:"PUT"}})};return n.prototype.load=function(){var e=this;return e.cardsService.query({},function(t){e.cards=t}).$promise},n.prototype.loadCardDetails=function(e){var t=this;return t.cardsService.get({id:e},function(e){t.selected=e}).$promise},n.prototype.loadCardLoyaltyDetails=function(e){var t=this;return e||(e=t.selected.id),t.cardsService.get({id:e,noun:"loyalty"},function(e){t.selected.loyalty=e.loyalty}).$promise},n.prototype.findById=function(e){for(var t,n=this,a=0;a<n.cards.length;a++)if(n.cards[a].id===e){t=n.cards[a];break}return t},{getInstance:function(e){return new n(e)}}},e.CardsModel.$inject=["lpCoreUtils","$resource"]}.call(t,n,t,e),!(void 0!==a&&(e.exports=a))},function(e,t,n){var a;a=function(require,e,t){"use strict";e.FinancialInstituteModel=function(e,t,n){var a=function(e){var a=this;a.enableGrouping=e.enableGrouping,e.financialInstitutesEndpoint=n.resolvePortalPlaceholders(e.financialInstitutesEndpoint),a.financialInstitutesService=t(e.financialInstitutesEndpoint),e.membershipRequestsEndpoint=n.resolvePortalPlaceholders(e.membershipRequestsEndpoint),a.membershipRequestsService=t(e.membershipRequestsEndpoint),a.selected={},a.selectedMembership={},a.financialInstitutes=[],a.membershipRequests=[],a.errors=[],a.warnings=[]};return a.prototype.searchFinancialInstitutes=function(e,t){var n=this;e.search="search";var a=n.financialInstitutesService.query(e).$promise;return a.then(function(e){if(t)for(var a=0;a<e.length;a++)n.financialInstitutes.push(e[a]);else n.financialInstitutes=e},function(e){n.addError({captionCode:"badConnection"})}),a},a.prototype.setSelected=function(e){var t=this;t.selected=e},a.prototype.loadMembershipRequests=function(){var e=this,t=e.membershipRequestsService.query().$promise;return t.then(function(t){e.membershipRequests=t},function(){e.addError({captionCode:"badConnection"})}),t},a.prototype.loadMembershipRequestByID=function(e){var t=this,n=t.membershipRequestsService.get({id:e}).$promise;return n.then(function(e){t.selectedMembership=e},function(){t.addError({captionCode:"badConnection"})}),n},a.prototype.getRequiredCredentials=function(){var e=this,t={id:e.selected.id,credentials:"credentials"},n=e.financialInstitutesService.query(t).$promise;return n.then(function(t){e.selected.requiredUserCredentials=t},function(t){e.addError({captionCode:"badConnection"})}),n},a.prototype.createMembershipRequest=function(e){var t=this,n=new t.membershipRequestsService;n.institutionId=e.id,n.credentials=[];for(var a=0;a<e.requiredUserCredentials.length;a++){var r={};r.credentialId=e.requiredUserCredentials[a].id,r.value=e.requiredUserCredentials[a].fieldValue,n.credentials.push(r)}var i=n.$save();return i.then(function(e){t.selectedMembership=e},function(){t.addError({captionCode:"invalidCredentials"})}),i},a.prototype.updateMembershipRequest=function(e){var t=this,n=new t.membershipRequestsService;n.institutionId=e.institutionId,n.credentials=[];for(var a=0;a<t.selected.requiredUserCredentials.length;a++){var r={};r.credentialId=t.selected.requiredUserCredentials[a].id,r.value=t.selected.requiredUserCredentials[a].fieldValue,n.credentials.push(r)}var i=n.$save({id:e.id,credentials:"credentials"});return i.then(function(e){t.selectedMembership=e},function(e){t.addError(401===e.status?{captionCode:"invalidCredentials"}:{captionCode:"badConnection"})}),i},a.prototype.addError=function(e){for(var t=this,n=!1,a=0;a<t.errors.length;a++)t.errors[a].captionCode===e.captionCode&&(n=!0);n||t.errors.push(e)},a.prototype.addWarning=function(e){for(var t=this,n=!1,a=0;a<t.warnings.length;a++)t.warnings[a].captionCode===e.captionCode&&(n=!0);n||t.warnings.push(e)},a.prototype.clearErrors=function(){var e=this;e.errors=[]},a.prototype.clearWarnings=function(){var e=this;e.warnings=[]},{getInstance:function(e){return new a(e)}}},e.FinancialInstituteModel.$inject=["httpService","$resource","lpCoreUtils"]}.call(t,n,t,e),!(void 0!==a&&(e.exports=a))},function(e,t,n){var a;a=function(require,e,t){"use strict";e.dynamicCredentialInput=function(e){return e.put("credentialInput.html",'<div ng-switch on="credential.inputFieldType"><div ng-switch-when="text"><input type="text" class="form-control" ng-model="credential.fieldValue" aria-label="{{credential.inputFieldLabel}}" /></div><div ng-switch-when="password"><input type="password" class="form-control" ng-model="credential.fieldValue" aria-label="{{credential.inputFieldLabel}}" /></div><div ng-switch-when="hidden"><input type="hidden" class="form-control" ng-model="credential.fieldValue" aria-label="{{credential.inputFieldLabel}}" /></div><div ng-switch-when="select"><div dropdown-select="dropdown-select" ng-model="credential.fieldValue" ng-options="option as option for option in credential.options"></div></div><div ng-switch-when="checkbox" class="checkbox"><div ng-repeat="option in credential.options"><label><input type="checkbox" ng-click="handleMultiCheckbox(option)" aria-label="{{option}}" />{{option}}</label></div></div><div ng-switch-when="radio" class="radio"><div ng-repeat="option in credential.options"><label><input type="radio" ng-model="credential.fieldValue" name="radio-{{credential.id}}" value="{{option}}" aria-label="{{option}}" />{{option}}</label></div></div><div ng-switch-when="img"><img ng-src="{{credential.metaData}}" alt="{{credential.inputFieldlabel}}" /><br /><br /><label class="radio-inline"><input type="radio" ng-model="credential.fieldValue" name="radio-{{credential.id}} value="true" aria-label="Yes" />Yes</label><label class="radio-inline"><input type="radio" ng-model="credential.fieldValue" name="radio-{{credential.id}} value="false" aria-label="False" />No</label></div><div ng-switch-when="imgd"><img ng-src="data:{{credential.metaData}}" alt="{{credential.inputFieldlabel}}" /><br /><br /><label class="radio-inline"><input type="radio" ng-model="credential.fieldValue" name="radio-{{credential.id}} value="true" aria-label="Yes" />Yes</label><label class="radio-inline"><input type="radio" ng-model="credential.fieldValue" name="radio-{{credential.id}} value="false" aria-label="False" />No</label></div></div>'),{restrict:"A",replace:!0,require:"ngModel",scope:{credential:"="},template:e.get("credentialInput.html"),link:function(e,t,n,a){var r={TEXT:"text",PASSWORD:"password",OPTIONS:"select",LOGIN:"text",CHECKBOX:"checkbox",RADIO:"radio",URL:"text",HIDDEN:"hidden",IMAGE_URL:"img",CONTENT_URL:"text",CUSTOM:"text",CLUDGE:"text",TOKEN:"text",IMAGE_DATA:"imgd"},i=function(){o(e.credential)};e.handleMultiCheckbox=function(t){for(var n=!1,a=0;a<e.credential.fieldValue.length;a++)if(e.credential.fieldValue[a]===t){n=!0,e.credential.fieldValue.splice(a,1);break}n||e.credential.fieldValue.push(t)};var o=function(e){e.inputFieldType=r[e.inputFieldType],e.inputFieldType===r.CHECKBOX&&(e.fieldValue=[])};i()}}},e.dynamicCredentialInput.$inject=["$templateCache"]}.call(t,n,t,e),!(void 0!==a&&(e.exports=a))},function(e,t,n){var a;a=function(require,e,t){"use strict";n(1).ng;e.lpFormatAmount=function(e,t,n){return{restrict:"A",scope:{account:"=lpFormatAmount"},link:function(e,a,r){e.$watch("account",function(e){var r=[];r.available=e.availableBalance,r.current=e.bookedBalance;var i=n.getPreferenceFromParents("preferredBalanceView")||"current",o=t.formatCurrency(r[i],e.currency);a.html(o)})}}},e.lpFormatAmount.$inject=["$parse","lpCoreI18n","widget"]}.call(t,n,t,e),!(void 0!==a&&(e.exports=a))},function(e,t,n){var a;(function(e){a=function(require,e,t){"use strict";t.name="account-select";var a=n(1),r=n(2),i=n(3),o=[r.name,i.name];t.exports=a.createModule(t.name,o).directive(n(13))}.call(t,n,t,e),!(void 0!==a&&(e.exports=a))}).call(t,n(12)(e))},function(e,t,n){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children=[],e.webpackPolyfill=1),e}},function(e,t,n){var a;a=function(require,e,t){"use strict";var a=n(1).ng;e.lpAccountsSelect=function(e,t,n){e.put("$accountSelectTemplate.html",'<div class="clearfix"><div class="pull-left lp-acct-detail"><div class="clearfix"><div class="pull-left"><div class="lp-acct-name"><span>{{option.alias}}</span></div><div class="lp-acct-num"><span lp-aria-number="option.identifier"></span></div></div></div></div><div class="pull-right text-right"><div class="h4 lp-account-amount"><span class="sr-only" lp-i18n="Account balance"></span><span lp-format-amount="option" lp-balance-update="lp-balance-update" ng-model="option"></span></div><div class="h6 lp-account-bal" ng-if="$parent.$parent.$parent.preferredBalance !== \'current\'"><small lp-i18n="Current:"></small> <span lp-amount="option.bookedBalance" lp-amount-currency="option.currency"/></div><div class="h6 lp-account-bal" ng-if="$parent.$parent.$parent.preferredBalance === \'current\'"><small lp-i18n="Available:"></small> <span lp-amount="option.availableBalance" lp-amount-currency="option.currency"/></div></div>'),e.put("$cardsSelectTemplate.html",'<div class="clearfix"><div class="card-name-info hidden-sm"><div class="clearfix"><div class="pull-left"><div class="lp-acct-name"><span>{{option.alias}}</span></div><div class="lp-acct-num"><small lp-i18n="card ending"></small> <span lp-aria-number="option.cardNumber"></span></div></div></div></div><div class="card-balance-info text-right text-uppercase h6"><div><small ng-if="$parent.$parent.$parent.preferredBalance === \'current\'" lp-i18n="Current balance"></small><br/><small ng-if="$parent.$parent.$parent.preferredBalance !== \'current\'" lp-i18n="Available credit"></small><br/><span class="h4" lp-format-amount="option" lp-balance-update="lp-balance-update" ng-model="option"></span></div><div ng-if="$parent.$parent.$parent.preferredBalance === \'current\'"><small lp-i18n="Available credit"></small> <span lp-amount="option.availableBalance" lp-amount-currency="option.currency"/></div><div ng-if="$parent.$parent.$parent.preferredBalance !== \'current\'"><small lp-i18n="Current balance"></small><br/><span lp-amount="option.bookedBalance" lp-amount-currency="option.currency"/></div></div></div>');var r=function(e){var t="cards"===e?"$cardsSelectTemplate.html":"$accountSelectTemplate.html";return['<div class="lp-account-select">','<div dropdown-select ng-model="model" ng-options="account as account for account in accounts"','option-template-url="'+t+'" ng-change="changed()" lp-responsive="lp-responsive" ','size-rules="responsiveRules" empty-placeholder-text="Select an account...">',"</div>","</div>"].join("")},i=function(e,i,o,c){e.preferredBalance=o.prefferedBalanceView||"current",i.html(r(o.type));var l=n.getPreference("accountSelectCustomFields");if(l&&(l=l.split(",")),t(i.contents())(e),o.designatedClass){var s=a.element(i.children()[0]);s.addClass(o.designatedClass)}c.$render=function(){var t=c.$modelValue,n=e.accounts;t&&n&&n.length>0?a.forEach(n,function(n){l&&!n.customFields&&(n.customFields=l),t.id===n.id&&(e.model=n)}):e.model=null},e.changed=function(){c.$setViewValue(e.model)},e.formatDefaultText=function(e){return'<div class="something">'+e+"</div>"},e.$watch("lpAccounts",function(t){e.accounts=t||[],c.$render()}),e.responsiveRules=[{max:300,size:"small-account-select"},{min:301,max:400,size:"normal-account-select"},{min:401,size:"large-account-select"}]};return{restrict:"EA",replace:!0,require:"ngModel",scope:{lpAccounts:"="},link:i}},e.lpAccountsSelect.$inject=["$templateCache","$compile","widget"]}.call(t,n,t,e),!(void 0!==a&&(e.exports=a))}])});