!function(e,n){"object"==typeof exports&&"object"==typeof module?module.exports=n(require("base"),require("core"),require("ui"),require("module-payments"),require("module-accounts"),require("module-ebilling")):"function"==typeof define&&define.amd?define(["base","core","ui","module-payments","module-accounts","module-ebilling"],n):"object"==typeof exports?exports["widget-ebill-add"]=n(require("base"),require("core"),require("ui"),require("module-payments"),require("module-accounts"),require("module-ebilling")):e["widget-ebill-add"]=n(e.base,e.core,e.ui,e["module-payments"],e["module-accounts"],e["module-ebilling"])}(this,function(e,n,t,r,i,o){return function(e){function n(r){if(t[r])return t[r].exports;var i=t[r]={exports:{},id:r,loaded:!1};return e[r].call(i.exports,i,i.exports,n),i.loaded=!0,i.exports}var t={};return n.m=e,n.c=t,n.p="",n(0)}([function(e,n,t){var r;(function(e){r=function(require,e,n){"use strict";function r(){}n.name="widget-ebill-add";var i=t(1),o=t(2),s=t(3),c=t(4),l=t(5),a=t(6),u=[o.name,s.name,c.name,l.name,a.name];n.exports=i.createModule(n.name,u).controller(t(7)).service(t(8)).directive(t(9)).run(r)}.call(n,t,n,e),!(void 0!==r&&(e.exports=r))}).call(n,t(10)(e))},function(n,t,r){n.exports=e},function(e,t,r){e.exports=n},function(e,n,r){e.exports=t},function(e,n,t){e.exports=r},function(e,n,t){e.exports=i},function(e,n,t){e.exports=o},function(e,n,t){var r;r=function(require,e){"use strict";var n=t(1).utils,r={};e.MainCtrl=function(e,n,t){this.wizard=r,this.bpService=e,this.eBillsService=n,this.bpModel=t},e.MainCtrl.$inject=["bpService","eBillsService","bpModel"],e.FindPayeeCtrl=function(e,t,i){function o(){t.searchVendors({name:s.searchValue}).then(function(e){s.listGroup=""!==s.searchValue?e:s.topVendors})}var s=this;s.searchValue="",s.pay=function(){r.goToStep(4)},t.getTopVendors().then(function(e){s.topVendors=e,s.listGroup=e}),s.selectBiller=function(e){i.currentBiller=n.clone(e),i.currentBiller.paymentMethod=i.paymentMethods.ELECTRONIC,i.currentBiller.address={},i.currentBiller.addresses=[],r.nextStep()},s.createBiller=function(e){i.currentBiller={paymentMethod:i.paymentMethods.CHECK,name:e,address:{}},r.nextStep()};var c=e.debounce(o,500);s.search=function(){s.searching=Boolean(s.searchValue),c()},s.clearSearch=function(){t.cancelSearch(),s.searchValue="",s.listGroup=s.topVendors,s.searching=!1}},e.FindPayeeCtrl.$inject=["lpCoreUtils","bpService","bpModel"],e.ConnectPayeeCtrl=function(e,n,t,i){var o=this;o.back=function(e){e.ConnectForm.$setPristine(),e.ConnectForm.submitted=!1,i.currentBiller=null,n.errors=null,r.goToStep(1)},o.connect=function(){n.addPayee(i.currentBiller).then(function(e){null===n.errors&&(i.currentBiller=e,i.currentBiller.connected=!0,i.currentBiller.ebillEligible&&o.proceedToEBills(),r.nextStep()),e&&(i.currentBiller.addresses=e.addresses)})},o.proceedToEBills=function(){t.fetchInfo(i.currentBiller).then(function(e){t.hasNoErrors()&&(i.currentBiller.ebills=e)})},o.setAccountConfirmationStatus=function(e){o.isAccountConfirmed=e}},e.ConnectPayeeCtrl.$inject=["lpCoreUtils","bpService","eBillsService","bpModel"],e.SetupEBillsCtrl=function(e,n,t,r){var i=this;i.confirm=function(){n.nextAction(r.currentBiller.ebills).then(function(e){n.hasNoErrors()&&(e.checkStatus?i.pollStatus(r.currentBiller.ebills):r.currentBiller.ebills=e)})},i.cancel=function(){r.currentBiller.ebillsEnabled=!1,r.currentBiller.ebills.step=r.eBillSetupSteps.COMPLETE},i.pollStatus=function(e){var o=e?e:0;t(function(){n.checkStatus(r.currentBiller.ebills).then(function(e){n.hasNoErrors()&&(e.checkStatus?i.pollStatus():(r.currentBiller.ebills=e,r.currentBiller.ebills.step===r.eBillSetupSteps.COMPLETE&&(r.currentBiller.ebillsEnabled=!0)))},function(){})},o)}},e.SetupEBillsCtrl.$inject=["bpService","eBillsService","$timeout","bpModel"],e.PayeeAddedCtrl=function(e,n,t,i){this.addNewPayee=function(){t.currentBiller=null,t.payment=null,e.errors=null,r.goToStep(1)},this.openDashboard=function(){i.publish("launchpad-retail.openEBillDashboard")},this.createPayment=function(){t.payment={amount:0,currencySym:"$",scheduleDate:new Date,scheduledTransfer:{startDate:new Date,intervals:[],timesToRepeat:1}},r.goToStep(4)}},e.PayeeAddedCtrl.$inject=["bpService","eBillsService","bpModel","lpCoreBus"],e.PayCtrl=function(e,t,i,o,s,c){var l=this,a=function(e){return o("date")(e,"yyyy-MM-dd")},u=function(e){return o("translate")(e)};l.frequencies=[],l.endOptionsEnum={AFTER:"after",CANCEL:"onCancel"},l.endOptions=[{id:l.endOptionsEnum.AFTER,value:u("After")},{id:l.endOptionsEnum.CANCEL,value:u("On cancellation")}],l.isConnecting=!0,s.payment=t.payment;var d=function(e){if(e){var n=s.payment.urgentTransfer?1:t.currentBiller.businessDaysToDeliver,r=a(e);i.getBusinessDay(r,n).then(function(e){s.payment.estDeliveryDate=e})}};s.$watch("payment.urgentTransfer",function(){d(s.payment.scheduleDate)}),s.$watch("payment.scheduleDate",function(e){d(e)}),this.showUrgentTransfer=function(){return t.currentBiller.canExpeditePayments&&t.currentBiller.paymentMethod===t.paymentMethods.CHECK};var p=function(e){return l.warnings=[],e.account||l.warnings.push({code:"ERROR_SELECT_ACCOUNT"}),e.scheduleDate||l.warnings.push({code:"ERROR_ENTER_PROCESSING_DATE"}),e.amount||l.warnings.push({code:"ERROR_ENTER_AMOUNT"}),e.isScheduledTransfer&&(e.scheduledTransfer.frequency||l.warnings.push({code:"ERROR_SELECT_FREQUENCY"}),"after"!==e.scheduledTransfer.endOn||e.scheduledTransfer.timesToRepeat||l.warnings.push({code:"ERROR_ENTER_TIMES_TO_REPEAT"})),l.warnings.length>0?!1:!0};this.pay=function(n){if(p(n)){var r={payeeId:t.currentBiller.payeeId,accountCode:s.payment.account.identifier,amount:s.payment.amount,memo:s.payment.memo};s.payment.isScheduledTransfer?(r.frequency=s.payment.scheduledTransfer.frequency||"OneTime",r.processingDate=a(s.payment.scheduledTransfer.startDate),s.payment.scheduledTransfer.endOn===l.endOptionsEnum.CANCEL?r.repeatUntilCanceled=!0:r.numberOfPayments=s.payment.scheduledTransfer.timesToRepeat):(r.frequency="OneTime",r.processingDate=a(s.payment.scheduleDate),r.repeatUntilCanceled=!1,r.numberOfPayments=1),e.makeAPayment({payment:r}).then(function(t){null===e.errors&&(n.sent=!0)})}},this.cancel=function(){r.goToStep(1)};var f=e.getAccounts(),h=e.getFrequencies(),m=e.fetchPayee(t.currentBiller);c.all([f,h,m]).then(function(e){l.accounts=e[0],l.frequencies=e[1],l.eBills=e[2].eBill,n.forEach(l.accounts,function(e,n){return e.isPrimaryAccount?void(s.payment.account=e):void 0})},function(e){})["finally"](function(){l.isConnecting=!1})},e.PayCtrl.$inject=["bpService","bpModel","calendarService","$filter","$scope","$q"],e.ConfigureCtrl=function(e){var n=this;n.fiModel=e.fiModel,n.goBack=r.previousStep},e.ConfigureCtrl.$inject=["fiService"]}.call(n,t,n,e),!(void 0!==r&&(e.exports=r))},function(e,n,t){var r;r=function(require,e,n){"use strict";var r=t(1).utils,i="";e.bpModel=function(){this.paymentMethods={CHECK:"CHECK",ELECTRONIC:"ELECTRONIC"},this.eBillSetupSteps={SELECT_SITE:0,PROVIDE_LOGIN:1,SELECT_ACCOUNT:2,COMPLETE:3,CHECK_STATUS:4},this.currentBiller={payeeId:null,ebillEligible:null,paymentMethod:null,ebills:null},this.payment=null,this.isCurrentBillerCheck=function(){return this.currentBiller.paymentMethod===this.paymentMethods.CHECK}},e.bpService=function(e,n,t,o){var s=this,c=o.resolvePortalPlaceholders(t.getPreference("billPaymentsDataSrc"));s.getTopVendors=function(){return s.isConnecting=!0,e.get(c+"/top-billers"+i).then(function(e){return s.isConnecting?(s.isConnecting=!1,s.billers=e&&e.data&&e.data.billerGroups||[],s.billers):null})},s.searchVendors=function(n){return s.isConnecting=!0,e.get(c+"/billers"+i,{params:n}).then(function(e){return s.isConnecting?(s.isConnecting=!1,s.billers=e&&e.data&&e.data.billers||[],s.billers):null})},s.cancelSearch=function(){s.isConnecting=!1},s.addPayee=function(n){s.isConnecting=!0,s.errors=null;var t={id:n.id,name:n.name,account:n.account,address:n.address,paymentMethod:n.paymentMethod};return e.post(c+"/payees"+i,t).then(function(e){return s.isConnecting=!1,e.data.errors.length>0?(s.errors=e.data.errors,n):(n=e.data,n.ebillEligible="ELIGIBLE"===e.data.eBillsStatus,n)},function(e){return s.isConnecting=!1,s.errors=e.data&&e.data.errors,e.data.addresses?(n.addresses=e.data.addresses,n):void 0})},s.getAccounts=function(){return s.isConnecting=!0,s.errors=null,e.get(c+"/accounts"+i).then(function(e){s.isConnecting=!1;var n=[];return r.forEach(e.data.accounts,function(e,t){var r={alias:e.nickName,identifier:e.accountCode,bookedBalance:e.totalAmountDue,availableBalance:e.balance,isPrimaryAccount:e.primaryBillPaymentAccount};n.push(r)}),n},function(e){s.isConnecting=!1,s.errors=e.data&&e.data.errors})},s.getFrequencies=function(){return s.isConnecting=!0,s.errors=null,e.get(c+"/frequencies"+i).then(function(e){s.isConnecting=!1;var t=[];return r.forEach(e.data.frequencies,function(e,r){t.push({id:e,value:n("translate")(e)})}),t})},s.makeAPayment=function(n){s.isConnecting=!0,s.errors=null;var t="/payments";return n.urgentTransfer&&(t="/expedited-payments"),e.post(c+t+i,n).then(function(e){return s.isConnecting=!1,e.data.errors.length>0&&(s.errors=e.data.errors),n},function(e){s.isConnecting=!1,s.errors=e.data&&e.data.errors})},s.fetchPayee=function(n){return e.get(c+"/payees/"+n.payeeId+i).then(function(e){return e.data})}},e.bpService.$inject=["$http","$filter","lpWidget","lpCoreUtils"],e.eBillsService=function(e,n,t,r){function o(e){var n={};return n.sessionId=e.sessionId,n.furtherActionNeeded=e.furtherActionNeeded,"false"===e.furtherActionNeeded?(n.step=t.eBillSetupSteps.COMPLETE,n):(e.nextAction?(n.url=e.nextAction.url,e.nextAction.credentialsParams&&(n.step=t.eBillSetupSteps.PROVIDE_LOGIN,n.credentialsParams=e.nextAction.credentialsParams,n.credentialsParams.forEach(function(e){e.inputFieldType=e.masked?"PASSWORD":"TEXT"})),e.nextAction.billerSite&&(n.step=t.eBillSetupSteps.SELECT_SITE,n.url=e.nextAction.url,n.sessionId=e.sessionId,n.sites=e.nextAction.billerSite),e.nextAction.accounts&&(n.step=t.eBillSetupSteps.SELECT_ACCOUNT,n.accounts=e.nextAction.accounts)):n.checkStatus=!0,n)}var s=this,c=r.resolvePortalPlaceholders(n.getPreference("billPaymentsDataSrc"));s.hasNoErrors=function(){return null===s.errors||void 0===s.errors||0===s.errors.length},s.fetchInfo=function(n){return s.isConnecting=!0,s.errors=null,e.post(c+"/e-bills"+i,n).then(function(e){return s.isConnecting=!1,o(e.data)},function(e){s.isConnecting=!1,s.errors=e.data.errors})},s.checkStatus=function(n){return s.isConnecting=!0,s.errors=null,e.get(c+"/e-bills/status"+i,{params:{sessionId:n.sessionId}}).then(function(e){return s.isConnecting=!1,o(e.data)},function(e){s.isConnecting=!1,s.errors=e.data.errors})},s.nextAction=function(n){return s.isConnecting=!0,s.errors=null,e.post(c+n.url+i,n).then(function(e){return s.isConnecting=!1,o(e.data)},function(e){s.isConnecting=!1,s.errors=e.data.errors})}},e.eBillsService.$inject=["$http","lpWidget","bpModel","lpCoreUtils"],e.calendarService=function(e,n,t){var r=this,o=t.resolvePortalPlaceholders(n.getPreference("calendarDataSrc"));r.getBusinessDay=function(n,t){return r.isConnecting=!0,r.errors=null,e.get(o+"/business-days-after"+i,{params:{date:n,offset:t}}).then(function(e){return r.isConnecting=!1,e.data.errors.length>0&&(r.errors=e.data.errors),e.data.businessDay},function(e){r.isConnecting=!1,r.errors=e.data&&e.data.errors})}},e.calendarService.$inject=["$http","lpWidget","lpCoreUtils"]}.call(n,t,n,e),!(void 0!==r&&(e.exports=r))},function(e,n,t){var r;r=function(require,e,n){"use strict";e.lpSelect=function(){function e(e,n){var t=function(n){("keyup"!==n.type||13===n.keyCode)&&e.$apply(function(){e.lpSelect.call(null,{$event:n})})};n.on("click",t),n.on("keyup",t),e.$on("$destroy",function(){n.off(t)})}return{restrict:"A",scope:{lpSelect:"&"},compile:function(n,t){return t.$set("tabindex",0),e},link:e}}}.call(n,t,n,e),!(void 0!==r&&(e.exports=r))},function(e,n,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children=[],e.webpackPolyfill=1),e}}])});