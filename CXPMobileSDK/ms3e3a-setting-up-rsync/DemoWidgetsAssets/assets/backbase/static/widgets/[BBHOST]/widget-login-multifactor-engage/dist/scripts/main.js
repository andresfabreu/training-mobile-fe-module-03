!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("base"),require("core"),require("ui"),require("module-users")):"function"==typeof define&&define.amd?define(["base","core","ui","module-users"],t):"object"==typeof exports?exports["widget-login-multifactor-engage"]=t(require("base"),require("core"),require("ui"),require("module-users")):e["widget-login-multifactor-engage"]=t(e.base,e.core,e.ui,e["module-users"])}(this,function(e,t,i,n){return function(e){function t(n){if(i[n])return i[n].exports;var o=i[n]={exports:{},id:n,loaded:!1};return e[n].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var i={};return t.m=e,t.c=i,t.p="",t(0)}([function(e,t,i){var n;(function(e){n=function(require,e,t){"use strict";function n(e,t,i,n,o,s){try{var r=n.resolvePortalPlaceholders(i.getPreference("prefixSessionUrl"));o.setConfig({initiateEndPoint:r+i.getPreference("initiateEndPoint"),otpEndPoint:r+i.getPreference("otpEndPoint"),serverRootPath:n.getPortalProperty("serverRoot"),portalName:n.getPortalProperty("portalName"),pageName:n.getPortalProperty("pageName"),reloadOnSuccess:n.parseBoolean(i.getPreference("reloadOnSuccess"))}),e.initialize()}catch(c){s.captureException(c)}t.publish("cxp.item.loaded",{id:i.model.name})}t.name="widget-login-multifactor-engage";var o=i(2),s=i(3),r=i(4),c=i(5),u=i(6),a=[s.name,c.name,r.name,u.name];n.$inject=["loginSteps","lpCoreBus","lpWidget","lpCoreUtils","lpUsersAuthentication","lpCoreError"],t.exports=o.createModule(t.name,a).constant(i(9)).provider("loginSteps",i(10)).config(i(11)).controller(i(12)).run(n)}.call(t,i,t,e),!(void 0!==n&&(e.exports=n))}).call(t,i(1)(e))},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children=[],e.webpackPolyfill=1),e}},function(t,i){t.exports=e},function(e,i){e.exports=t},function(e,t){e.exports=i},function(e,t){e.exports=n},function(e,t,i){var n;(function(e){n=function(require,e,t){"use strict";t.name="components.login-trusted-device";var n=i(2),o=i(3),s=i(4),r=[o.name,s.name];t.exports=n.createModule(t.name,r).factory(i(7)).directive(i(8))}.call(t,i,t,e),!(void 0!==n&&(e.exports=n))}).call(t,i(1)(e))},function(e,t,i){var n;n=function(require,e,t){"use strict";e.lpTrustedDevice=function(e,t,i,n){var o=n.defer(),s=n.defer();e.subscribe("widget-device-dna:data:ready",function(e){s.resolve(e)});var r={requestDevice:function(){return s.promise},setDeviceId:function(e){o.resolve(e||"")},getDeviceId:function(){return o.promise},storeDeviceId:function(t){e.publish("widget-device-dna:device:ready",t)}};return r},e.lpTrustedDevice.$inject=["lpCoreBus","lpCoreUtils","lpCoreError","$q"]}.call(t,i,t,e),!(void 0!==n&&(e.exports=n))},function(e,t,i){var n;n=function(require,e,t){"use strict";e.lpTrustedDeviceCheckbox=function(e,t,i,n,o){function s(t,i,n){var s,r={},c=t.hideDelay||500,u=function(){t.displayInfoMessage=!t.displayInfoMessage};t.displayInfoMessage=!1,t.disabled=!0,i.find("i").on("touchstart click",function(){t.$apply(function(){t.$eval(u)})}),t.showInfoMessage=function(){s&&(e.cancel(s),s=null),t.displayInfoMessage=!0},t.hideInfoMessage=function(){s=e(function(){t.displayInfoMessage=!1,s=null},c)},o.requestDevice().then(function(e){r.deviceId=e.deviceID||"",r.deviceSignature=e.deviceSignature,t.trusted=!!r.deviceId,t.disabled=!1}),o.getDeviceId().then(function(e){o.storeDeviceId(t.trusted?e:"")}),t.$watch("trusted",function(e,i){e?(t.model.deviceId=r.deviceId,t.model.deviceSignature=r.deviceSignature):(delete t.model.deviceId,delete t.model.deviceSignature)})}function r(){return s}var c=['<div class="lp-trusted-device">','<span lp-checkbox="lp-checkbox" ng-model="trusted" label="Trust this device" ng-disabled="disabled"></span> ','<i class="lp-icon lp-icon-info-sign"></i>','<div class="panel-body" ng-show="displayInfoMessage">','<small class="text-muted" lp-i18n="Please indicate whether you are using a personal device (PC, laptop, etc.) in a \'private\' environment, or whether you are in a public environment, like on a public wifi network"></small>',"</div>","</div>"].join("");return{scope:{trusted:"=",hideDelay:"=",model:"=ngModel"},restricted:"A",require:"?^ngModel",template:c,compile:r}},e.lpTrustedDeviceCheckbox.$inject=["$timeout","lpWidget","lpCoreUtils","lpCoreBus","lpTrustedDevice"]}.call(t,i,t,e),!(void 0!==n&&(e.exports=n))},function(e,t,i){var n;n=function(require,e,t){"use strict";e.STEPS={LOGIN:"LOGIN",OTP:"OTP",PRIVACY:"PRIVACY"},e.STORE_LOGIN_ID="login-multifactor-login"}.call(t,i,t,e),!(void 0!==n&&(e.exports=n))},function(e,t,i){var n;n=function(require,e,t){"use strict";t.exports=function(e){var t,i={},n={shown:!1,onShow:null,onHide:null,back:null,next:null};this.setInitialStep=function(e){t=e},this.setRoutes=function(t){e.extend(i,t)},this.$get=function(o){function s(t){!t.shown&&e.isFunction(t.onShow)&&t.onShow(),t.shown=!0}function r(t){t.shown&&e.isFunction(t.onHide)&&t.onHide(),t.shown=!1}var c={};return c.steps={},c.addStep=function(t,o){if(!t)throw new Error("You must provide an id for the step");this.steps[t]=e.extend({},n),i.hasOwnProperty(t)?e.extend(this.steps[t],i[t],o):e.extend(this.steps[t],o)},c.next=function(){var i=this.steps[t].next;return e.isFunction(i)?void i():void this.to(i)},c.back=function(){var i=this.steps[t].back;return e.isFunction(i)?void i():void this.to(i)},c.to=function(i){t=i,e.forEach(this.steps,r),s(this.steps[t])},c.getCurrent=function(){return t},c.setValues=function(t,i){e.extend(this.steps[t],i)},c.initialize=function(){o(function(){s(c.steps[t])}),c.initialize=e.noop},c},this.$get.$inject=["$timeout"]},t.exports.$inject=["lpCoreUtils"]}.call(t,i,t,e),!(void 0!==n&&(e.exports=n))},function(e,t,i){var n;n=function(require,e,t){"use strict";t.exports=function(e,t,i,n){var o={};o[n.LOGIN]={back:null,next:n.OTP},o[n.OTP]={back:n.LOGIN,next:n.PRIVACY},o[n.PRIVACY]={back:null,next:null},i.setInitialStep(n.LOGIN),i.setRoutes(o)},t.exports.$inject=["lpCoreUtils","lpCoreTemplateProvider","loginStepsProvider","STEPS"]}.call(t,i,t,e),!(void 0!==n&&(e.exports=n))},function(e,t,i){var n;n=function(require,e){"use strict";e.MainCtrl=function(e,t,i,n){var o=this;o.steps=n.steps,e.$on("start-loading",function(){o.loading=!0}),e.$on("stop-loading",function(){o.loading=!1}),e.$on("error",function(e,i){t(function(){o.errorMessage=i.message})}),e.$on("error-clean",function(e){t(function(){o.errorMessage=null})})},e.MainCtrl.$inject=["$scope","$timeout","lpCoreUtils","loginSteps"],e.LoginCtrl=i(13),e.OtpCtrl=i(14),e.PrivacyCtrl=i(15)}.call(t,i,t,e),!(void 0!==n&&(e.exports=n))},function(e,t,i){var n;n=function(require,e,t){"use strict";t.exports=function(e,t,i,n,o,s,r,c,u,a,l){var d=this;d.data={},d.locked=!1,l.requestDevice().then(function(){var t=e.$on("initiate-success",function(e,i){var n=i.session&&i.session.deviceId,s=function(){o.unsubscribe("widget-login-multifactor:status:security-check-success",s),l.setDeviceId(n)};o.subscribe("widget-login-multifactor:status:security-check-success",s),t()})}),r.addStep(u.LOGIN,{onShow:function(){n("username")},onHide:function(){d.hasFocus=!1,d.resetFields(),e.$emit("error-clean")}}),d.validate=function(e){},d.submit=function(){e.$emit("start-loading"),e.$emit("error-clean"),s.initiate(d.data).then(function(t){e.$emit("initiate-success",t),s.isInitiated()?(e.$emit("stop-loading"),o.publish("login-initial-success"),r.next()):s.isVerified()&&s.securityCheck().then(function(e){o.publish("widget-login-multifactor:status:security-check-success"),s.handleVerifiedResponse(e),o.publish("login-success")},function(t){e.$emit("stop-loading"),e.$emit("error",t)})},function(t){t.code===s.ERROR_CODE.MAX_ATTEMPTS_EXCEEDED&&d.showMaxAttemptsExceeded(),e.$emit("stop-loading"),e.$emit("error",t)})},d.showMaxAttemptsExceeded=function(){d.locked=!0},d.resetFields=function(){d.data.username="",d.data.password=null}},t.exports.$inject=["$scope","$timeout","$window","lpFocus","lpCoreBus","lpUsersAuthentication","loginSteps","lpCoreStore","STEPS","STORE_LOGIN_ID","lpTrustedDevice"]}.call(t,i,t,e),!(void 0!==n&&(e.exports=n))},function(e,t,i){var n;n=function(require,e,t){"use strict";t.exports=function(e,t,i,n,o,s,r,c,u){var a,l,d=this;d.data={};try{a=parseInt(u.getPreference("timerSeconds"),10)}catch(p){a=60}try{l=parseInt(u.getPreference("timerHideSeconds"),10)}catch(p){l=0}d.timerSeconds=1e3*a,d.timerHideSeconds=1e3*l,d.timerShown=d.timerSeconds&&!d.timerHideSeconds,d.countdownSeconds=d.timerSeconds-d.timerHideSeconds,s.addStep(r.OTP,{onShow:function(){o("otp"),d.timerSeconds&&e.$broadcast("timer-run")},onHide:function(){d.resetFields()}}),d.submit=function(){return e.$emit("error-clean"),/^\d+$/.test(d.data.otpcode)===!1?void e.$emit("error",{message:"Code must contain only digits"}):(d.timerSeconds&&e.$broadcast("timer-pause"),e.$emit("start-loading"),void n.verifyOTP({otpCode:d.data.otpcode}).then(function(t){n.isVerified()&&n.securityCheck().then(function(t){i.publish("widget-login-multifactor:status:security-check-success"),n.handleVerifiedResponse(t),i.publish("login-success"),e.$emit("stop-loading")},function(t){e.$emit("error",t),e.$emit("stop-loading")})},function(t){d.timerSeconds&&e.$broadcast("timer-resume"),e.$emit("error",t),e.$emit("stop-loading")}))},d.cancel=function(){s.back()},d.retry=function(){d.resetFields(),o("otp"),d.timerSeconds&&e.$broadcast("timer-run")},d.countdownStart=function(){d.timerShown=!0},d.finish=function(i){t(function(){d.timeExpired=!0,e.$emit("error",{message:"Time has expired"})},200)},d.resetFields=function(){d.data.otpcode=null,d.timerSeconds&&(d.timeExpired=!1,d.timerShown=!d.timerHideSeconds,e.$broadcast("timer-reset")),e.$emit("error-clean")},d.toggleInfoMessage=function(){d.displayInfoMessage=!d.displayInfoMessage}},t.exports.$inject=["$scope","$timeout","lpCoreBus","lpUsersAuthentication","lpFocus","loginSteps","STEPS","lpCoreI18n","lpWidget"]}.call(t,i,t,e),!(void 0!==n&&(e.exports=n))},function(e,t,i){var n;n=function(require,e,t){"use strict";t.exports=function(e,t,i,n){var o=this;i.addStep(n.PRIVACY,{next:function(){t.location.replace(t.location.href)}}),o.data={privacy:"public"},o.submit=function(){e.$emit("error-clean"),i.next()}},t.exports.$inject=["$scope","$window","loginSteps","STEPS"]}.call(t,i,t,e),!(void 0!==n&&(e.exports=n))}])});