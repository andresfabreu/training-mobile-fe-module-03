!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("base"),require("core"),require("ui"),require("module-accounts"),require("module-payments")):"function"==typeof define&&define.amd?define(["base","core","ui","module-accounts","module-payments"],t):"object"==typeof exports?exports["widget-review-transfers"]=t(require("base"),require("core"),require("ui"),require("module-accounts"),require("module-payments")):e["widget-review-transfers"]=t(e.base,e.core,e.ui,e["module-accounts"],e["module-payments"])}(this,function(e,t,r,n,i){return function(e){function t(n){if(r[n])return r[n].exports;var i=r[n]={exports:{},id:n,loaded:!1};return e[n].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var r={};return t.m=e,t.c=r,t.p="",t(0)}([function(e,t,r){var n;(function(e){n=function(require,e,t){"use strict";function n(e,t,r,n){r.setConfig({accountsEndpoint:t.getPreference("accountsDataSrc")}),n.setConfig({paymentsEndpoint:t.getPreference("pendingPaymentOrdersDataSrc")})}t.name="widget-review-transfers";var i=r(1),o=r(2),a=r(3),s=r(4),l=r(5),c=[o.name,a.name,s.name,l.name];n.$inject=["lpCoreUtils","lpWidget","lpAccounts","lpPayments"],t.exports=i.createModule(t.name,c).constant(r(6)).controller(r(7)).service(r(8)).run(n)}.call(t,r,t,e),!(void 0!==n&&(e.exports=n))}).call(t,r(9)(e))},function(t,r,n){t.exports=e},function(e,r,n){e.exports=t},function(e,t,n){e.exports=r},function(e,t,r){e.exports=n},function(e,t,r){e.exports=i},function(e,t,r){var n;n=function(require,e,t){"use strict";e.reviewTransfersConfig={statusSuccess:"PENDING",statusAuthorization:"AUTHORIZATION_NEEDED",statusAuthorizationError:"UNSUCCESSFUL_AUTHORIZATION"}}.call(t,r,t,e),!(void 0!==n&&(e.exports=n))},function(e,t,r){var n;n=function(require,e){"use strict";var t=r(1).utils,n=r(10);e.MainCtrl=function(e,r,i,o,a,s,l,c,u,d,p,m,f){var v=this,g=!1,y=!1;v.review={},l=l.api(),e.put("templates/verify-p2p-details.ng.html",'<div class="modal-header">    <h2><i class="lp-icon lp-icon-xxl lp-icon-info-sign"></i> <span lp-i18n="Verify your contact details"></span></h2></div><form role="form" ng-submit="handleP2PVerification()">    <div class="modal-body">       <p>           <span lp-i18n="We have sent a message containing a verification code to {{p2pUser.email}}."></span>           <br />           <span lp-i18n="Please check your email and enter the code"></span>       </p>       <p lp-i18n="The code will expire in 20 minutes"></p>       <div ng-class="{\'has-error\': verify.validationError && verify.verificationCode.length > 0, \'has-feedback\': true, \'form-group\': true}">           <label class="control-label"><strong lp-i18n="Verification Code:"></strong></label>           <input type="input" ng-model="verify.verificationCode" class="form-control" tabindex="0" aria-label="Verification code" maxlength="4" placeholder="enter the 4 digits" />       </div>    </div>    <div class="modal-footer text-right">       <button name="closeModal" class="btn btn-link" ng-click="cancel()" type="button" lp-i18n="Cancel"></button>       <button name="resendCode" class="btn btn-link" type="button" lp-i18n="Resend Code"></button>       <button type="submit" class="btn btn-primary" ng-disabled="!verify.verificationCode" lp-i18n="Submit"></button>    </div></form>'),e.put("templates/authorize.ng.html",'<div class="modal-header">    <h2>        <i class="lp-icon lp-icon-xxl lp-icon-info-sign"></i>        <span lp-i18n="Verify your payment(s)"></span>    </h2></div><form role="form" ng-submit="authorize()">    <div class="modal-body">        <div ng-show="err.modalError">            <div alert="alert" type="danger">{{ err.modalError | translate }}</div>        </div>        <p>Because your transaction to <b>{{currentOrder.counterpartyName}}</b> is over <span lp-amount="1000" lp-amount-currency="currentOrder.instructedCurrency" locale="locale"></span>(<i><span lp-amount="currentOrder.instructedAmount" lp-amount-currency="currentOrder.instructedCurrency" locale="locale"></span></i>), you need to verify it.</p>        <div class="form-group has-feedback">            <label class="control-label"><strong lp-i18n="Please enter authentication code:"></strong></label>            <input type="password" ng-model="review.auth_password" class="form-control " placeholder="Password" />        </div>    </div>    <div class="modal-footer text-right" >        <button name="closeModal" class="btn btn-link" ng-click="cancel()" type="button" lp-i18n="Cancel"></button>        <button type="submit" class="btn btn-primary" ng-disabled="!review.auth_password" lp-i18n="Verify"></button>    </div></form>'),e.put("templates/remove-confirmation.ng.html",'<div class="modal-header">    <h2><i class="lp-icon lp-icon-xxl lp-icon-info-sign"></i> <span lp-i18n="Please confirm"></span></h2></div><form role="form" ng-submit="remove()">    <div class="modal-body">        <div ng-show="review.modalError">        <div alert="alert" type="danger">{{ review.modalError | translate }}</div>        </div>        <p>            <b lp-i18n="Are you sure you want to remove this payment?"></b>        </p>        <div class="row">            <div class="col-xs-8">            <small class="text-muted" lp-i18n="messages.TRANSFER_TO"></small><span class="h4" itemprop="counterpartyName"> {{paymentOrder.counterpartyName}}</span>        </div>        <div class="col-xs-4 text-right">            <span class="h4" lp-amount="paymentOrder.instructedAmount" lp-amount-currency="paymentOrder.instructedCurrency" itemprop="instructedAmount"></span>        </div>    </div>    <div class="row">        <div class="col-xs-8">            <small class="text-muted">                {{ paymentOrder.accountDetails }}            </small>            </div>            <div class="col-xs-4 text-right">                <small class="text-muted" translate>{{ paymentOrder.onDate | date:\'longDate\' }}</small>            </div>        </div>    </div>    <div class="modal-footer text-right" >        <div ng-show="error.isError" class="bg-warning text-danger pull-left" lp-i18n="Server error!"></div>        <button name="closeModal" class="btn btn-link" ng-click="cancel()" type="button" lp-i18n="Cancel"></button>        <button type="submit" class="btn btn-danger" lp-i18n="Remove"></button>    </div></form>'),e.put("templates/currency.not.same.html",'<div class="modal-header">   <h2><i class="lp-icon lp-icon-xxl lp-icon-info-sign"></i> <span lp-i18n="Total amount"></span></h2></div><form role="form">    <div class="modal-body">       <p lp-i18n="Please note that in case of multi-currency usage the transfers cannot be calculated.       Total amount is shown only for the same currency."></p>   </div>   <div class="modal-footer text-right" >       <button class="btn btn-primary" ng-click="cancel()" type="button" lp-i18n="Ok"></button>   </div></form>'),v.decodePhotoUrl=function(e){return n.getDefaultProfileImage(e,50,50)};var b=function(){return v.loading=!0,c.load().then(function(e){var t=e.map(function(e){return e.id});return v.p2pPaymentOrders=v.p2pPaymentOrders||[],l.load(t).then(function(){return m.getUserEnrollmentDetails()}).then(function(e){v.p2pUser={accountNumber:e.accountNumber,email:e.email,emailVerified:e.emailVerified}})["catch"](function(){v.p2pUser={emailVerified:!1}})["finally"](function(){v.loading=!1})})},h=function(){v.alerts=r,v.accountsModel=c,v.ordersModel=l,v.ordersModel.pendingOrdersGroups=[],b()["finally"](function(){d.flush("launchpad-retail.paymentOrderInitiated"),d.subscribe("launchpad-retail.paymentOrderInitiated",b)})};v.pendingOrdersTotals=function(){var e,t=v.ordersModel.pendingOrdersGroups,r=0,n=0;if(!t||!t.length)return!1;e=t[0].paymentOrders[0].instructedCurrency;for(var i=0,o=t.length;o>i;i++)for(var a=0;a<t[i].paymentOrders.length;a++)r+=t[i].paymentOrders[a].instructedAmount,e&&e!==t[i].paymentOrders[a].instructedCurrency&&(e=!1),n++;return{count:n,amount:r,currency:e}},v.changeLanguage=function(e){i.use(e)},v.editOrder=function(e){v.makePayment(),d.publish("lpMoneyTransfer.update",v.ordersModel.makeFormObject(e))},v.makePayment=function(){v.alerts.close(),d.publish("launchpad-retail.requestMoneyTransfer")};var O=function(){y&&d.publish("launchpad-retail.transactions.newTransferSubmitted"),g&&d.publish("launchpad-retail.p2pTransactions.newTransferSubmitted"),y=!1,g=!1},A=function(){if(0===v.pendingOrders.length&&0===v.p2pPaymentOrders.length)return v.alerts.push("alerts.SUBMITTED","success"),v.loading=!1,void O();var e=v.pendingOrders.pop();e?(e.type===u.p2pEmail&&(e.verificationFailure=!1,v.p2pPaymentOrders.push(e)),v.submitPayment(e)):(v.p2pPaymentOrders=[],v.p2pVerificationFailed=!1)};v.submitPayments=function(e){v.loading=!0;var r=[];t.forEach(v.ordersModel.pendingOrdersGroups,function(e){r=r.concat(e.paymentOrders)}),v.pendingOrders=r,A()},v.authorizePayment=function(e,t){v.submitPayment(e,t)},v.submitPayment=function(e,t){if(a.info("Processing "+e.id+" payment order"),e.verificationFailure)return void A();if(e.type===u.p2pEmail&&!v.p2pUser.emailVerified)return void v.verifyP2PDetails(e);for(var r=v.ordersModel.pendingOrdersGroups,n=null,i=0,o=r.length;o>i;i++)if(r[i]["@id"]===e.accountId){n=r[i];break}return n?void e.send({paymentId:e.id},t).then(function(t){if(t.status===f.statusAuthorization)return void v.authorize(e);e.type===u.bank?y=!0:e.type===u.p2pEmail&&(g=!0);var i=n.paymentOrders;e.submitted=!0,s(function(){i.splice(i.indexOf(e),1),0===i.length&&r.splice(r.indexOf(n),1),v.p2pPaymentOrders.indexOf(e)>-1&&v.p2pPaymentOrders.splice(v.p2pPaymentOrders.indexOf(e),1),A()},1e3)},function(t){401===t.status?v.authorize(e):403===t.status?(v.authorize(e),v.review.modalError="Authorization error.",s(function(){v.review.modalError=""},7e3)):(a.error("Error: Order "+e.id+" didn't succeed."),v.alerts.push("alerts.FAILURE","danger"),v.loading=!1)}):void a.error("Error: Order "+e.id+" does not belong to any group.")},v.removeOrder=function(t,r){var n=o.open({template:e.get("templates/remove-confirmation.ng.html"),controller:"RemoveConfirmationCtrl",resolve:{paymentOrder:function(){return r}}});n.result.then(function(e){var n=t.paymentOrders.indexOf(r);if(t.paymentOrders.splice(n,1),0===t.paymentOrders.length){var i=v.ordersModel.pendingOrdersGroups.indexOf(t);v.ordersModel.pendingOrdersGroups.splice(i,1)}},function(e){console.log(e)})},v.authorize=function(t){var r=o.open({template:e.get("templates/authorize.ng.html"),controller:"AuthenticationCtrl",resolve:{currentOrder:function(){return t},modalError:function(){return v.review.modalError}}});r.result.then(function(e){v.loading=!1,v.authorizePayment(t,e)},function(){v.loading=!1})},v.verifyP2PDetails=function(t){var r=o.open({template:e.get("templates/verify-p2p-details.ng.html"),controller:"VerificationCtrl",resolve:{currentOrder:function(){return t},P2PUser:function(){return v.p2pUser}}});r.result.then(function(e){v.loading=!1,t.verificationFailure=!e,e===!0&&(v.p2pUser.emailVerified=!0,v.submitPayment(t))},function(e){v.loading=!1})},v.sameCurrency=function(){v.loading=!0;var t=o.open({template:e.get("templates/currency.not.same.html"),controller:"SameCurrencyCtrl"});t.result.then(function(){v.loading=!1},function(){v.loading=!1})},h()},e.MainCtrl.$inject=["$templateCache","lpAlerts","$translate","$modal","$log","$timeout","lpPayments","lpAccounts","transferTypes","lpCoreBus","lpCoreUpdate","P2PService","reviewTransfersConfig"],e.RemoveConfirmationCtrl=function(e,t,r,n,i){e.error={isError:!1,message:""},e.paymentOrder=n,i=i.api(),e.remove=function(){var n=i.remove(e.paymentOrder.id);n.then(function(e){r.close(e)},function(r){e.error.isError=!0,e.error.message=r.statusText,t(function(){e.error.isError=!1},4e3)})},e.cancel=function(){r.dismiss("cancel")}},e.RemoveConfirmationCtrl.$inject=["$scope","$timeout","$modalInstance","paymentOrder","lpPayments"],e.AuthenticationCtrl=function(e,t,r,n){e.err={modalError:n},e.review={auth_password:""},e.currentOrder=r,e.authorize=function(){t.close(e.review)},e.cancel=function(){t.dismiss("cancel")}},e.AuthenticationCtrl.$inject=["$scope","$modalInstance","currentOrder","modalError"],e.VerificationCtrl=function(e,t,r,n,i){e.verify={},e.currentOrder=r,e.p2pUser=n,e.handleP2PVerification=function(){i.verifyCode(e.p2pUser.email,e.verify.verificationCode).then(function(e){200===e.status&&t.close(!0)},function(e){400===e.status&&t.close(!1)})},e.cancel=function(){t.dismiss("cancel")}},e.VerificationCtrl.$inject=["$scope","$modalInstance","currentOrder","P2PUser","P2PService"],e.SameCurrencyCtrl=function(e,t){e.cancel=function(){t.dismiss("cancel")}},e.SameCurrencyCtrl.$inject=["$scope","$modalInstance"]}.call(t,r,t,e),!(void 0!==n&&(e.exports=n))},function(e,t,r){var n;n=function(require,e,t){"use strict";e.lpAlerts=function(e){var t=5e3,r=[];this.list=function(){return r},this.close=function(){r=[]},this.push=function(n,i,o){this.close();var a=this;r.push({type:i||"danger",msg:n}),o&&e(function(){a.close()},t)}},e.lpAlerts.$inject=["$timeout"]}.call(t,r,t,e),!(void 0!==n&&(e.exports=n))},function(e,t,r){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children=[],e.webpackPolyfill=1),e}},function(e,t,r){var n;n=function(require,e,t){"use strict";var n=r(1).utils,i="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFAAAABPCAIAAADz89W0AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyRpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoTWFjaW50b3NoKSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDo3MkVFRDI3OTJERUQxMUUzQkU4Qzk1MDlEQzAyMjFFNCIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDo3MkVFRDI3QTJERUQxMUUzQkU4Qzk1MDlEQzAyMjFFNCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOjcyRUVEMjc3MkRFRDExRTNCRThDOTUwOURDMDIyMUU0IiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjcyRUVEMjc4MkRFRDExRTNCRThDOTUwOURDMDIyMUU0Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+gildPAAABRdJREFUeNrsmstKI0EUhicmRmO8IoKIgigoCoovIOhOX8m38RncuHWjG0HFjeAl4GWhoAvvUZPMZ/6ZQ9OtmUBa04OnFk2luqo9X51LnVMzqZWVlV8/qbX8+mHNgR3YgR3YgR3YgR3YgR3YgR3YgR3YgR3YgR3YgR3YgR34O1umkcWVSiX4M5VK2Yj6PDUt9Co6GPxI6MvB+U0GDlL9MZiWluBe6KkJ9iqI8RmDjVeq7cO/1TQN8wTm9fX16ekpn88/Pj5ms1kky+VyLy8vdMrlMoOtra100um0MWgLghj0mfD29mav+JnJZJKiYWuA9fb2jo2NiRYwhL64uIBf0k9NTTFHWyMY5kRtVX0msIqfPK+vr0ulUnRrmgyMHF1dXQsLCz09PYChlpubm7W1tbu7O2SFbXx8fGZmxpiZDwzToobKTwhZgmKfn5/Pz883NjaKxaJMo3FR0/Pz841/Ba0iGSSDg4MPDw/Ih27b29uPj495hbUXCoWRkRGELlYb5MDAzCv6etJ4xaD2BWzGh4aGmHl5eVnD4b8PWPpBFbK6q6ur0dFRlCxzbWtrw6sZ7OjoQNXIPTs7y2ScOVttTGCVvFTN+lI7P/kyP9k4vhkLc6NBCwmQiT76RLdbW1vLy8tyP8inp6dPT09RFHi49Pb29sDAgMyVJ+N0YI6eW6yFljkMEvyYw19pftCSQ0osheWTk5OjoyNCFLolgGHGc3Nzm5ubnZ2dbMf6+jquzvj7H85kbLOCja+xO4uLi2wWO4I5yMJjceBGMy3bcsRCOBnhzs7O/f09CmcvwJ6cnAQbWgi7u7vhyVcbVIxg1cxkOX1G6LM1eDLBWX4hS47LgWMAthiLuKgCJEx3b2+PETk2KsV1IZS7QmgeyxL5M5y5apO1M5lpds4rqicrtUS94gESZoAnJib6+/sBYBcI3ZiojqtQvik1auNub2+xDu2j3CRGS47fhzVCrEJRGCR+u7S0pIAE5/DwsDpRYEuniOe7u7vsnbKO1N8WL3MMufT74VZNIVAvHY4f/JDgjEoVYC0g84x+oVRt5WpjrX3zizTcaHloSlBKaJkjZ698WOoy3do0dfTKEmw6+DNPTbCWFA2HVC0DVpOtKsYyfnBwsL+/T4gyk+aVlC8kebuKEL1VREhWPRws8aIVrD15RWp9dnYGQyhpEZvgdUQpb5MXVAItKUHLXM4MW/KZKeotZ4/O3mipYGvVOITxZKUllmNGLxuar+HQ1QT6URqsA5noRVIZugOIOoX8glWazEdk2DF6ciZ2J7E8RC4qbPItKkTxh6wjeDeiJcQ50hVLM1G4YkGC6uEQsIWcYMWD6HaVESo8dKppnBGcWaFLsZrz2WJbEjUsEqvvTWl20RHKW2zQtsBuCKiZqCsPDw/tbiiJGpboxFskNjyJa5VgjSs73RCpzKbuJ9ksFApkMhYLkwgMGInx6uoqRZKUo6u5f2rJ/FlVhOqwvr6+GAumr9Kwkko0U7+UZtLsi2KVQoDcwbKUJPqwLiikIrmxyil5bG0N6zKEQlpHsZRsdwzJ1TAiIqhiDzmj7qssONVYq9ybtVKsrUpWLh2NQBDKaaVnRFc9XOdyqVp3l1aZJNSkLdlUTLYiIXjY1nm1EDx77QxL6DkcyoHr+QexaGYe7SRUw9EEu55z5bOFH36qaRcA/11zYAd2YAd2YAd2YAd2YAd2YAd2YAd24B/QMrH/J4qkA8f7Pyhcw+7DzW6/BRgAykJQPtOgddIAAAAASUVORK5CYII=",o=function(e){var t="";e=e.split(" ");for(var r=0;r<e.length;r++)t+=e[r].substr(0,1);return t=t.toUpperCase()},a=function(e){var t=e.charCodeAt(0)-64,r=t+120,n=Math.floor((t-1)/25*4+1-1),i=[[r,210,210],[r,r,210],[210,r,r],[r,210,r],[210,r,210]];return i[n]};e.getDefaultProfileImage=function(e,t,r,s){var l=document.createElement("canvas");if(!e||!l.getContext||!l.getContext("2d"))return i;var c=o(e);s=s||a(c),l.setAttribute("width",t),l.setAttribute("height",r);var u=l.getContext("2d");u.fillStyle=n.isArray(s)?"rgb("+s.join(",")+")":s,u.fillRect(0,0,t,r),u.fillStyle="rgb(250,250,250)";var d;switch(c.length){case 1:d=.6;break;case 2:d=.5;break;case 3:d=.45;break;default:d=.3}var p=parseInt(d*r,10),m=Math.floor(.15*r);u.font=p+"px Proxima Regular, Helvetica Nueue, Helvetica, Arial, sans-serif",u.textAlign="right",u.fillText(c,t-3,r-m);var f=l.toDataURL("image/png");return f}}.call(t,r,t,e),!(void 0!==n&&(e.exports=n))}])});