<!DOCTYPE html>
<html>
<head>
	<title>CXP Webview page</title>

	<meta http-equiv="content-type" content="text/html; charset=UTF-8">
	<meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>

	<!--% custom styles %-->
	<!--% platform dependent %-->
	<!--% default dependencies %-->
	<!--% launchpad dependencies %-->
	<!--% extra libraries %-->
	<!--% custom scripts %-->
	<link href="static/theme/themes/default/base.css" rel="stylesheet" type="text/css">
	<link href="static/com.backbase.cxp-demo/theme/css/global.css" rel="stylesheet" type="text/css">

	<script src="cxp/js/ios/cxp-bridge.js"></script>
	<script src="cxp/js/ios/ios-specifics.js"></script>
	<script src="cxp/js/ios/ios-render.js"></script>
	<script src="cxp/js/shared/detect-resize.js"></script>
	<script src="cxp/js/shared/cxp-configuration.min.js"></script>
	<script src="cxp/js/shared/cxp-renderer.min.js"></script>


	<script src="cxp/js/shared/portal-client-shim.js"></script>

	<script>
		setupPortalShim(window,{contextRoot: ''});
	</script>

	<script src="cxp/js/shared/jquery.js"></script>
	<!--<script src="cxp/js/shared/fastclick.js"></script>-->
	<script src="cxp/js/shared/b-modules.js"></script>
	<script src="static/launchpad/launchpad-setup.js"></script>
	<script src="static/launchpad/modules/angular/angular.min.js"></script>
	<script src="static/launchpad/support/requirejs/require.js"></script>
	<script src="static/launchpad/modules/config/requirejs.conf.js"></script>
	<script src="static/launchpad/modules/base/scripts/require-widget.js"></script>

	<script>

		var config = cxpConfiguration({
			contextRoot: '',
			contextPath: '',
			remoteContextRoot: 'http://localhost:8889/portalserver'
		});

		function init(){
			var appModel,wModel;
			var root = 'widget-root';
			var pageIndex = window.location.hash ? window.location.hash.substr(1) : '0';

			$.getJSON('model.json',function(data){
				console.log(data);

				render(data.app);
				buildNav(appModel);
			});

			function render(model) {
				appModel = appModel || model;
				wModel = appModel.pages[pageIndex].children[0];
				//render using the ios renderer
				renderWidget(root, config.contextRoot, config.remoteContextRoot, wModel, [])
			}

			function buildNav(appModel){

				var items = [];
				appModel.pages.forEach(function(el,i){
					var name = el.name;
					var index = i;
					items.push(`<li><a href="#${index}">${name}</a></li>`);
				});

				items = `<ul class="debugNav">${items.join("")} </ul>`;

				document.body.insertAdjacentHTML('afterbegin',items);
			}

			window.addEventListener('hashchange', function() {
				pageIndex = window.location.hash ? window.location.hash.substr(1) : '0';
				render();
			});
		}

		document.addEventListener("DOMContentLoaded", function() {
			init();
		});

	</script>
	<style type="text/css" media="screen">
    .debugNav {
        width: 100%;
        background: rgba(0,0,0,.9);
        margin: 0;
        padding: 0;
        /* flexbox specific properties */
        
        display: -webkit-flex;
        display: flex;
        -webkit-flex-direction: row;
        flex-direction: row;
    }
    
    .debugNav li {
    	list-style: none;
         -webkit-flex: auto;
    	flex: auto;
    }
    
    .debugNav li a {
        color: rgb(255,255,255);
        padding: .3em;
  		display: block;
		text-align: center;
    }
     .debugNav li a:hover {
        background-color: rgb(255, 87, 0);
    }
    </style>


</head>
<body>
<!--% widget creation %-->
<div id="widget-root"></div>
</body>
</html>