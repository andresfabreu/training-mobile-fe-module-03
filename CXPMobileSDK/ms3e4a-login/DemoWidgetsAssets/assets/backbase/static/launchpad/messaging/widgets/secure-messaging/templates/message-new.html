<div ng-controller="CreateLetterController" id="message-review-container" class="no-padding col-xs-12 col-md-8">
    <div class="message-title-container panel-heading" >
        <span class="h4" style="vertical-align: middle;" lp-i18n="New message"></span>
    </div>
    <div class="new-message-content no-padding-top">
        <form id="newMessageForm" name="newMessageForm" ng-model="message" ng-submit="newMessageForm.$valid && send(letter, this);" novalidate>

            <div class="form-group" ng-class="{ 'has-error' : (newMessageForm.submitted ||  newMessageForm.recipient.$dirty) && newMessageForm.recipient.$error.required }">
                <label for="recipient" class="sr-only" lp-i18n="Recipient"></label>

                <div class="input-group">
                    <span class="input-group-btn">
                        <button name="important" type="button" tabindex="0"
                            class="btn btn-default dropdown-toggle" ng-class="{ 'btn-danger' : letter.important }"
                             ng-click="letter.important=!letter.important;"
                             role="checkbox" aria-label="Important message">
                            <i class="glyphicon glyphicon-exclamation-sign"></i>
                        </button>
                    </span>
                    <select class="form-control" name="recipient"
                        ng-model="letter.recipients" placeholder="Recipient" aria-label="Select recipient" aria-required="true"
                        ng-options="address.address as address.name for address in availableRecipients" required/>

                    <div class="input-group-btn" ng-show="categories.length > 0" dropdown>
                        <button ng-model="letter.category" ng-init="letter.category = categories[0]" type="button"
                            class="btn btn-default dropdown-toggle" ng-disabled="categories.length === 1" aria-label="Select category">
                            {{ letter.category }} <span class="caret"></span>
                        </button>
                        <ul class="dropdown-menu" role="menu">
                            <li ng-repeat="category in categories">
                                <a ng-click="letter.category = category">{{ category }}</a>
                            </li>
                        </ul>
                    </div>
                </div>
                <small class="text-danger" ng-show="(newMessageForm.submitted || newMessageForm.recipient.$dirty) && newMessageForm.recipient.$error.required" lp-i18n="Recipient is required">
                </small>
            </div>

            <div class="form-group" ng-class="{ 'has-error' : (newMessageForm.submitted ||  newMessageForm.subject.$dirty) && newMessageForm.subject.$error.required }">
                <label for="subject" class="sr-only" lp-i18n="Subject"></label>
                <input name="subject" type="text" ng-model="letter.subject" class="form-control" placeholder="Subject" aria-label="Enter subject" aria-required="true" required/>
                <small class="text-danger" ng-show="(newMessageForm.submitted || newMessageForm.subject.$dirty) && newMessageForm.subject.$error.required" lp-i18n="Subject is required"></small>
            </div>
            <div class="form-group" ng-class="{ 'has-error' : (newMessageForm.submitted || newMessageForm.body.$dirty) && newMessageForm.body.$error.required }">
                <label for="body" class="sr-only">Body</label>
                <textarea name="body" class="form-control" rows="6" ng-model="letter.body" style="resize: none;" placeholder="{{ 'Type your message here' | translate }}" aria-label="Enter message text" aria-required="true" required></textarea>
                <small class="text-danger" ng-show="(newMessageForm.submitted || newMessageForm.body.$dirty) && newMessageForm.body.$error.required" lp-i18n="Message is required"></small>
            </div>
            <div>
                <button name="cancel" class="btn btn-sm btn-link" style="float: left;" ng-click="close(this)" aria-label="Cancel message creation" lp-i18n="Cancel"></button>
                <button name="save" class="btn btn-sm btn-link" style="float: left;" ng-click="save(letter, this)" aria-label="Save and exit message creation" lp-i18n="Save as draft"></button>
                <button name="send" class="btn btn-sm btn-primary" style="float: right;" ng-click="newMessageForm.submitted=true" type="submit" aria-label="Send message" lp-i18n="Send"></button>
            </div>
        </form>
    </div>
</div>
