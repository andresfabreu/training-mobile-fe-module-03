!function(e,o){"object"==typeof exports&&"object"==typeof module?module.exports=o(require("base"),require("core"),require("ui"),require("module-accounts")):"function"==typeof define&&define.amd?define(["base","core","ui","module-accounts"],o):"object"==typeof exports?exports["widget-p2p-enrollment"]=o(require("base"),require("core"),require("ui"),require("module-accounts")):e["widget-p2p-enrollment"]=o(e.base,e.core,e.ui,e["module-accounts"])}(this,function(e,o,t,r){return function(e){function o(r){if(t[r])return t[r].exports;var n=t[r]={exports:{},id:r,loaded:!1};return e[r].call(n.exports,n,n.exports,o),n.loaded=!0,n.exports}var t={};return o.m=e,o.c=t,o.p="",o(0)}([function(e,o,t){var r;(function(e){r=function(require,e,o){"use strict";function r(){}o.name="widget-p2p-enrollment";var n=t(1),i=t(2),c=t(3),u=t(4),l=[i.name,c.name,u.name];o.exports=n.createModule(o.name,l).controller(t(5)).directive(t(6)).run(r)}.call(o,t,o,e),!(void 0!==r&&(e.exports=r))}).call(o,t(7)(e))},function(o,t,r){o.exports=e},function(e,t,r){e.exports=o},function(e,o,r){e.exports=t},function(e,o,t){e.exports=r},function(e,o,t){var r;r=function(require,e,o){"use strict";e.P2PEnrollmentController=function(e,o,t,r,n,i,c){function u(){return e.options.email.valid&&e.terms.doesAgreeWithTerms?void e.p2pService.enrollUserForP2P({email:e.options.email.value,accountNumber:e.accountsModel.findById(e.options.depositAccount.value).identifier}).then(function(o){201===o.status&&(e.wizardNextStep(),i.publish("launchpad-retail.userP2PEnrolled",{enrolled:!0,enrollment:{account:e.accountsModel.findById(e.options.depositAccount.value),email:e.options.email}}))},function(){e.errorOccurred=!0,e.enrollmentError=!0}):void(e.errorOccurred=!0)}function l(){e.p2pService.error=!1,e.p2pService.verifyCode(e.options.email.value,e.verification.code).then(function(o){200===o.status&&(e.wizardNextStep(),i.publish("launchpad-retail.userP2PVerified",{verified:!0}))},function(o){409===o.status?(e.errorOccurred=!0,e.verification.error=!0):e.p2pService.error=!0})}var s=function(){r.getUserEnrollmentDetails().then(function(o){e.userEnrolled=!0},function(o){e.userEnrolled=!1,404!==o.status&&(e.errorOccurred=!1)}),e.p2pService=r,e.errorOccurred=!1,e.options={email:{value:"",valid:!1},depositAccount:{value:"",options:[]}},n.read().success(function(o){e.options.email.value=o.emailAddress===[]?"":o.emailAddress,e.validateEmail(e.options.email.value)}),e.accountsModel=t,e.accountsModel.setConfig({accountsEndpoint:o.getPreference("accountsDataSrc")}),e.accountsModel.load().then(function(){e.options.depositAccount.options=e.accountsModel.accounts,e.options.depositAccount.value=e.accountsModel.accounts[0].id}),e.verification={code:"",error:!1},e.terms={doesAgreeWithTerms:!1}};e.validateEmail=function(o){e.errorOccurred=!1,e.options.email.valid=c.isValidEmail(o)},e.toNextStep=function(o){o.preventDefault(),o.stopPropagation(),e.errorOccurred=!1,1===e.getActiveWizardStep()?u():2===e.getActiveWizardStep()?l():3===e.getActiveWizardStep()&&e.openP2PTransfers()},e.openP2PTransfers=function(){i.publish("launchpad-retail.p2pEnrollmentComplete",{verified:!0}),i.publish("launchpad-retail.openP2PTransactions")},e.$watch("terms.doesAgreeWithTerms",function(o,t){o&&e.options.email.valid&&(e.errorOccurred=!1)}),s()},e.P2PEnrollmentController.$inject=["$scope","lpWidget","AccountsModel","P2PService","ProfileContactService","lpCoreBus","lpCoreUtils"]}.call(o,t,o,e),!(void 0!==r&&(e.exports=r))},function(e,o,t){var r;r=function(require,e){"use strict";e.stepFocus=function(){return{scope:{step:"=stepFocus"},link:function(e,o){e.$watch("step",function(e){2===e&&o.focus()})}}}}.call(o,t,o,e),!(void 0!==r&&(e.exports=r))},function(e,o,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children=[],e.webpackPolyfill=1),e}}])});