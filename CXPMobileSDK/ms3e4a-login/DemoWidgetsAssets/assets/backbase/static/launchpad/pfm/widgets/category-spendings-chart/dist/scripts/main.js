!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("base"),require("core"),require("ui"),require("d3")):"function"==typeof define&&define.amd?define(["base","core","ui","d3"],e):"object"==typeof exports?exports["widget-category-spendings-chart"]=e(require("base"),require("core"),require("ui"),require("d3")):t["widget-category-spendings-chart"]=e(t.base,t.core,t.ui,t.d3)}(this,function(t,e,a,r){return function(t){function e(r){if(a[r])return a[r].exports;var n=a[r]={exports:{},id:r,loaded:!1};return t[r].call(n.exports,n,n.exports,e),n.loaded=!0,n.exports}var a={};return e.m=t,e.c=a,e.p="",e(0)}([function(t,e,a){var r;(function(t){r=function(require,t,e){"use strict";e.name="widget-category-spendings-chart";var r=a(1),n=a(2),o=a(3),i=[n.name,o.name];e.exports=r.createModule(e.name,i).config(a(4)).factory(a(5)).controller(a(6)).directive(a(7))}.call(e,a,e,t),!(void 0!==r&&(t.exports=r))}).call(e,a(9)(t))},function(e,a,r){e.exports=t},function(t,a,r){t.exports=e},function(t,e,r){t.exports=a},function(t,e,a){var r;r=function(require,t,e){"use strict";e.exports=function(t,e){e.useWidgetInstance(t)},e.exports.$inject=["widget","lpCoreConfigurationProvider"]}.call(e,a,e,t),!(void 0!==r&&(t.exports=r))},function(t,e,a){var r;r=function(require,t){"use strict";t.CategorySpendingsResource=function(t,e,a){var r=a.resolvePortalPlaceholders(e.getPreference("categorySpendingDataSrc"));return t(r,null,{get:{method:"GET"}})},t.CategorySpendingsResource.$inject=["$resource","widget","lpCoreUtils"],t.CategoriesResource=function(t,e,a){var r=a.resolvePortalPlaceholders(e.getPreference("categoriesDataSrc"));return t(r,null,{get:{method:"GET",isArray:!0}})},t.CategoriesResource.$inject=["$resource","widget","lpCoreUtils"]}.call(e,a,e,t),!(void 0!==r&&(t.exports=r))},function(t,e,a){var r;r=function(require,t){"use strict";t.CategorySpendingsChartCtrl=function(t,e,a,r,n,o,i){var c=o,s=i;t.accountId=null,t.fromDate=null,t.toDate=null,t.viewLoading=!0,t.missingData=!1,t.showChart=!1,t.$watchCollection("[viewLoading,missingData]",function(e,a){var r=e[0],n=e[1];t.showChart=!r&&!n}),t.updateData=function(){e.all({spendings:a.get({accountIds:t.accountId,start:t.fromDate,end:t.toDate}).$promise,categories:r.get().$promise}).then(function(e){return 0===e.spendings.categoriesSpendings.length?(t.missingData=!0,void(t.viewLoading=!1)):(t.viewLoading=!1,t.missingData=!1,void c.publish("launchpad-retail.spendingDataUpdated",{spendings:e.spendings,categories:e.categories}))},function(e){t.viewLoading=!1,t.missingData=!0})},c.subscribe("launchpad-retail.accountSelected",function(e){t.accountId=e.accountId,t.updateData()}),c.subscribe("launchpad-retail.accountsLoaded",function(e){var a=[];s.forEach(e,function(t){a.push(t.id)}),t.accountId=a.join(","),t.updateData()}),c.subscribe("launchpad-retail.transactionsDateSearch",function(e){t.fromDate=e.fromDate,t.toDate=e.toDate,t.updateData()})},t.CategorySpendingsChartCtrl.$inject=["$scope","$q","CategorySpendingsResource","CategoriesResource","widget","lpCoreBus","lpCoreUtils"]}.call(e,a,e,t),!(void 0!==r&&(t.exports=r))},function(t,e,a){var r;r=function(require,t){"use strict";var e=a(8),r=window.jQuery;t.categorySpendingsChart=function(t){var a=t;return{restrict:"EA",replace:!0,template:'<svg class="category-spendings-chart" width="350" height="350"></svg>',link:function(t,n){function o(t,e){t.selectAll("tspan").remove();var a=t.attr("width"),r=1,n=t.append("tspan"),o=e.split(/\s+/),i=20;if(1===o.length&&e.length>15)return n.text(e.slice(0,12)+"..."),t;for(var c=0;c<o.length;c++){if(n.node().getComputedTextLength()>a){if(r++,r>=3){n.text(n.text()+"...");break}n=t.append("tspan").attr({x:0,dy:i})}n.text(n.text()+" "+o[c])}return t}function i(t){return t*(180/Math.PI)}function c(t){var e=f.selectAll(".arc").filter(function(e){return e.data.categoryId===t.categoryId});if(e[0].length>0){var a=e.datum();f.select(".arrow-group").append("path").attr({"class":"arrow",transform:["translate(0,"+-1*y*.9+")","rotate(180)"].join(" "),d:"M 0 0 l 15.5 27.5 l -30 0",fill:t.color});var r=(a.endAngle-a.startAngle)/2+a.startAngle;f.selectAll(".arrow-group").attr({transform:"rotate("+i(r)+")",fill:t.color})}}function s(){f.selectAll(".arrow").remove(),f.selectAll(".historical-change-arrow").remove(),f.selectAll(".inner-labels text").text("")}function l(t){if(t){s(),c(t),o(f.select(".name"),t.name);var e=t.historicalChangeFactor||1;f.select(".amount").text("$"+parseFloat(t.amount).toFixed(2)),f.select(".historical-change-factor").text(parseFloat(Math.abs(100*e)).toFixed(2)+"%"),f.select(".historical-change-group").classed({up:e>0,down:0>=e});var a=f.select(".historical-change-group").append("g").attr("class","historical-change-arrow");a.append("svg:defs").append("marker").attr({id:"arrow-head",refX:0,refY:2,markerWidth:2,markerHeight:4,orient:"auto"}).append("svg:path").attr("d","M0,0 V4 L2,2 Z"),a.append("path").attr({id:"arrow-line","marker-end":"url(#arrow-head)",fill:"none",d:"M0,0 L0,-18"});var r=["translate(6,"+.31*y+")","rotate(180)"].join(" "),n=["translate(6,"+.54*y+")","rotate(0)"].join(" "),i=f.select(".historical-change-group").classed("down")?r:n;f.select(".historical-change-arrow").attr("transform",i),f.select(".total-fraction").text(parseFloat(100*t.totalFraction).toFixed(2)+"%")}}function u(){var t=e.select(n[0]).append("g").attr({"class":"donut",transform:"translate("+v/2+","+m/2+")"});t.append("circle").attr({"class":"inner-circle",cx:0,cy:0,r:y}),t.append("g").attr("class","arcs");var a=t.append("g").attr("class","inner-labels");a.append("text").attr({"class":"name",x:0,y:-(.34*y),width:y}),a.append("text").attr({"class":"amount",x:0,dy:.15*y}),a.append("text").attr({"class":"total-fraction",x:-(.4*y),dy:.5*y});var r=a.append("g").attr("class","historical-change-group");return r.append("text").attr({"class":"historical-change-factor",x:.45*y,dy:.5*y}),t.append("g").attr("class","arrow-group"),t}function d(t){l(t.data),a.publish("launchpad-retail.donutCategoryChartSelection",t.data)}function p(t,a){s();var n=a,o={amount:t.amount,historicalChangeFactor:t.historicalChangeFactor,name:"All Categories",totalFraction:1};l(o);var i=t.categoriesSpendings;i.sort(function(t,e){return t.amount>e.amount?1:t.amount<e.amount?-1:0}),r.each(i,function(t,e){var a=r.grep(n,function(t){return t.id===e.categoryId})[0];e.name=a.name,e.color=a.color});var c=function(t){return t.amount},u=e.scale.linear().domain([e.min(i,c),e.max(i,c)]).range([100,360]),p=e.layout.pie().sort(null).value(function(t){return u(Math.abs(t.amount))}),g=f.select(".arcs").selectAll(".arc").data(p(i));g.classed("update",!0),g.enter().append("path").classed("arc",!0).attr("d",C).style("fill",function(t){return t.data.color}).on("click",d),g.attr("d",C).style("fill",function(t){return t.data.color}),g.exit().remove()}var g,f,h=null,v=350,m=350,x=Math.min(v,m/2),y=.55*x,w=x,C=e.svg.arc().outerRadius(w).innerRadius(y);f=u(),a.subscribe("launchpad-retail.spendingDataUpdated",function(t){g=t.spendings,h=t.categories,p(g,h)}),a.subscribe("launchpad-retail.transactionsCategorySearch",function(t){if(1===t.length){var e=g.categoriesSpendings,a=e.filter(function(e){return e.categoryId===t[0].id})[0];l(a)}})}}},t.categorySpendingsChart.$inject=["lpCoreBus"]}.call(e,a,e,t),!(void 0!==r&&(t.exports=r))},function(t,e,a){t.exports=r},function(t,e,a){t.exports=function(t){return t.webpackPolyfill||(t.deprecate=function(){},t.paths=[],t.children=[],t.webpackPolyfill=1),t}}])});