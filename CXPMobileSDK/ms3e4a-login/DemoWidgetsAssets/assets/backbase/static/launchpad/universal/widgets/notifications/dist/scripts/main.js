!function(i,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("base"),require("core"),require("ui")):"function"==typeof define&&define.amd?define(["base","core","ui"],t):"object"==typeof exports?exports["widget-notifications"]=t(require("base"),require("core"),require("ui")):i["widget-notifications"]=t(i.base,i.core,i.ui)}(this,function(i,t,o){return function(i){function t(n){if(o[n])return o[n].exports;var e=o[n]={exports:{},id:n,loaded:!1};return i[n].call(e.exports,e,e.exports,t),e.loaded=!0,e.exports}var o={};return t.m=i,t.c=o,t.p="",t(0)}([function(i,t,o){var n;(function(i){n=function(require,i,t){"use strict";function n(i){}t.name="widget-notifications";var e=o(1),r=o(2),c=o(3),s=[r.name,c.name];n.$inject=["lpWidget"],t.exports=e.createModule(t.name,s).constant(o(4)).controller(o(5)).factory(o(6)).directive(o(7)).run(n)}.call(t,o,t,i),!(void 0!==n&&(i.exports=n))}).call(t,o(8)(i))},function(t,o,n){t.exports=i},function(i,o,n){i.exports=t},function(i,t,n){i.exports=o},function(i,t,o){var n;n=function(require,i,t){"use strict";i.widgetPrefs={NOTIFICATIONS_ENDPOINT:"notificationsEndpoint",CLOSE_NOTIFICATION_ENDPOINT:"closeNotificationEndpoint",POLL_INTERVAL:"pollInterval",ALLOW_PUBSUB:"allowPubsub"}}.call(t,o,t,i),!(void 0!==n&&(i.exports=n))},function(i,t,o){var n;n=function(require,i,t){"use strict";var o=window.lp&&window.lp.util,n=function(i){i.$$phase||i.$apply()};i.NotificationsController=function(i,t,e,r,c,s,a,l){var f=a;i.locale="en-US",i.offsetTopCorrection={},i.offsetMarginCorrection={},i.fixedBar=l.parseBoolean(r.getPreference("fixedBar"));var u=r.getPreference(t.NOTIFICATIONS_ENDPOINT),d=r.getPreference(t.CLOSE_NOTIFICATION_ENDPOINT),p=l.parseBoolean(r.getPreference(t.ALLOW_PUBSUB)),g=parseInt(r.getPreference(t.POLL_INTERVAL),10),N=c.getInstance({notificationsEndpoint:u,closeNotificationEndpoint:d,onNotificationAdded:function(i){r.model.fireEvent("notification-added",!0,!0,{notification:i})}});i.model=N,"null"!==window.b$.portal.loggedInUserId&&(N.loadNotifications(),!isNaN(g)&&g>999&&u&&N.startPolling(g)),p&&(f.subscribe("launchpad.add-notification",function(t){t.notification&&(t.notification.message=l.escape(t.notification.message),N.addNotification(t.notification),n(i))}),f.subscribe("launchpad.remove-notification",function(t){t.notification&&t.notification.id&&(N.removeNotification(t.notification.id),n(i))}),f.subscribe("launchpad-retail.offsetTopCorrection",function(t){t.offsetTopCorrection>=0&&(i.offsetTopCorrection={top:t.offsetTopCorrection},i.offsetMarginCorrection=i.fixedBar?{}:{top:t.offsetTopCorrection},n(i))})),i.getAlertClass=function(i){var t,o="alert-info";return i.level&&(t=i.level.toLowerCase(),"severe"===t?o="alert-danger":"warning"===t?o="alert-warning":"success"===t&&(o="alert-success")),o},i.isValidLink=function(i){return i.rel&&i.uri},i.isDesignMode=function(){return o.isDesignMode()},i.closeNotification=function(t){i.model.closeNotification(t),i.model.notifications.length>0&&i.$broadcast("lp.notifications.focus")}},i.NotificationsController.$inject=["$scope","widgetPrefs","$rootElement","lpWidget","NotificationsModel","i18nUtils","lpCoreBus","lpCoreUtils"]}.call(t,o,t,i),!(void 0!==n&&(i.exports=n))},function(i,t,o){var n;n=function(require,i,t){"use strict";i.NotificationsModel=function(i,t,o){var n=function(i){i=i||{},this.notifications=[],this.notificationsEndpoint=i.notificationsEndpoint,this.closeNotificationEndpoint=i.closeNotificationEndpoint,this.updateReceivedEndpoint=i.updateReceivedEndpoint,this.polling=!1,this.onNotificationAdded=i.onNotificationAdded,this.loading=!1};return n.prototype.startPolling=function(i){var o=this;if(!this.polling){this.polling=!0;var n=function(){var e=o.loadNotifications();e.success(function(){o.pollingTimeout=t(function(){n()},i)})};this.pollingTimeout=t(function(){n()},i)}},n.prototype.stopPolling=function(){this.pollingTimeout&&(t.cancel(this.pollingTimeout),this.polling=!1)},n.prototype.loadNotifications=function(){var i=this,t=o.getInstance({endpoint:this.notificationsEndpoint,cacheTimeout:0});this.loading=!0;var n=t.read();return n.success(function(t){t.messages&&t.messages.forEach(function(t){i.addNotification(t)})}),n.error(function(t){t.errors&&(i.errorCode=t.errors[0])}),n["finally"](function(){i.loading=!1}),n},n.prototype.addNotification=function(i){if("string"==typeof i.id||"number"==typeof i.id){for(var t=!1,o=0;o<this.notifications.length&&!t;o++)i.id&&this.notifications[o].id===i.id&&(this.notifications[o]=i,t=!0);t||(this.notifications.push(i),"function"==typeof this.onNotificationAdded&&this.onNotificationAdded.call(null,i))}},n.prototype.removeNotification=function(i){this.notifications.splice(this.notifications.indexOf(i),1)},n.prototype.closeNotification=function(i){var n=this,e=function(){n.removeNotification(i);var t=o.getInstance({endpoint:n.closeNotificationEndpoint,urlVars:{id:i.id}});t.update({contentType:"application/json"})},r=function(){t(function(){n.loading?r():e()},100)};r()},{getInstance:function(i){return new n(i)}}},i.NotificationsModel.$inject=["$rootScope","$timeout","httpService"]}.call(t,o,t,i),!(void 0!==n&&(i.exports=n))},function(i,t,o){var n;n=function(require,i,t){"use strict";i.lpAllowPubsubClick=function(i,t){return{restrict:"A",scope:{numberAllowed:"@lpAllowPubsubClick",invokerClassName:"@"},link:function(o,n,e){var r=i;o.numberAllowed=parseInt(o.numberAllowed,10)||0,o.invokerClassName=o.invokerClassName||"pubsub-invoker",o.numberAllowed>0&&o.invokerClassName&&(o.invokers=n[0].querySelectorAll("."+o.invokerClassName),t.forEach(o.invokers,function(i,t){t<o.numberAllowed&&i.addEventListener("click",function(i){var t,o;t=i.target.getAttribute("data-pubsub-name"),o=i.target.getAttribute("data-pubsub-arguments"),t&&r.publish(t,o)})}))}}},i.lpAllowPubsubClick.$inject=["lpCoreBus","lpCoreUtils"]}.call(t,o,t,i),!(void 0!==n&&(i.exports=n))},function(i,t,o){i.exports=function(i){return i.webpackPolyfill||(i.deprecate=function(){},i.paths=[],i.children=[],i.webpackPolyfill=1),i}}])});