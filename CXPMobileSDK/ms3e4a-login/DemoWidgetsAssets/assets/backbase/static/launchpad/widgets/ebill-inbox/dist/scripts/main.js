!function(e,n){"object"==typeof exports&&"object"==typeof module?module.exports=n(require("base"),require("core"),require("ui"),require("module-ebilling")):"function"==typeof define&&define.amd?define(["base","core","ui","module-ebilling"],n):"object"==typeof exports?exports["widget-ebill-inbox"]=n(require("base"),require("core"),require("ui"),require("module-ebilling")):e["widget-ebill-inbox"]=n(e.base,e.core,e.ui,e["module-ebilling"])}(this,function(e,n,t,i){return function(e){function n(i){if(t[i])return t[i].exports;var o=t[i]={exports:{},id:i,loaded:!1};return e[i].call(o.exports,o,o.exports,n),o.loaded=!0,o.exports}var t={};return n.m=e,n.c=t,n.p="",n(0)}([function(e,n,t){var i;(function(e){i=function(require,e,n){"use strict";n.name="widget-ebill-inbox";var i=t(1),o=t(2),l=t(3),c=t(4),s=[o.name,l.name,c.name],r=function(e,n,t){var i={debitOrdersSrc:e.getPreference("debitOrdersSrc"),mandatesSrc:e.getPreference("mandatesSrc"),accountsEndPoint:e.getPreference("accountsDataSrc"),baseUrl:t.getWidgetBaseUrl(e),templates:{"e-bill-list-details":"/templates/details.ng.html","e-bill-list-newbills-details":"/templates/newbills-details.ng.html","e-bill-list-payment":"/templates/payment.ng.html"}};n.setConfig(i)};r.$inject=["lpWidget","lpEbilling","lpCoreUtils"],n.exports=i.createModule(n.name,s).controller(t(5)).run(r)}.call(n,t,n,e),!(void 0!==i&&(e.exports=i))}).call(n,t(6)(e))},function(n,t,i){n.exports=e},function(e,t,i){e.exports=n},function(e,n,i){e.exports=t},function(e,n,t){e.exports=i},function(e,n,t){var i;i=function(require,e,n){"use strict";e.MainCtrl=function(e,n){var t=this,i=e.getConfig();t.isTouch=n.isTouch,t.baseUrl=i.baseUrl,t.getTemplate=function(n){return e.getTemplate(n)}},e.MainCtrl.$inject=["lpEbilling","lpEbillingUtils"],e.DetailsCtrl=function(e,n){var t=this;t.init=function(e){e.processing=!0,e.mandate.$get().then(function(e){t.mandate=e},function(e){t.response="Unable to fetch e-bill."})["finally"](function(){e.processing=!1})},n.$on("$destroy",function(){t.mandate=null})},e.DetailsCtrl.$inject=["lpEbilling","$scope"],e.PaymentCtrl=function(e,n,t){var i=this;i.paymentParams={},i.init=function(n){i.bill=n,i.minDate=new Date,i.setSpecificAmount(n.amount),i.paymentParams.scheduleDate=n.scheduleDate&&new Date(n.scheduleDate),e.getAccounts().then(function(e){i.accounts=e,i.paymentParams.account=e.filter(function(e){return e.identifier===n.mandate.debtor.account})[0]})},i.setSpecificAmount=function(e){e?(i.specific=!1,i.paymentParams.amount=e):(i.specific=!0,i.paymentParams.amount=i.specificAmount||0)},t.$watch(function(){return i.specificAmount},function(e){i.specific&&(i.paymentParams.amount=e)}),t.$on("$destroy",function(){})},e.PaymentCtrl.$inject=["lpEbilling","lpEbillingUtils","$scope"],e.BillsListCtrl=function(e,n,t,i,o,l,c,s){var r=i,a=this,u={f:0,l:4,sort:"+paymentDueDate"};a.hasMore=!1;var f=function(e){"number"==typeof e&&(a.hasMore=e>=u.l)},p=function(n){var i=c.defer();return n.scheduledDate=t.isUndefined(n.scheduledDate)?null:n.scheduledDate instanceof Date?new Date(n.scheduledDate).getTime():null,t.isObject(n.accountId)?(n.accountId=n.accountId.id,i.resolve(n)):e.getAccounts().then(function(e){n.accountId=e.filter(function(e){return e.identifier===n.accountId})[0].id||null,i.resolve(n)}),i.promise};a.init=function(){a.fetch()},a.sync=function(){a.fetch(),r.publish("lp.widget.e-bill-inbox:sync",{},!0)},a.loadMore=function(){u.f=a.bills.length,n.getAll(u).then(function(e){f(e.length),e.length>0&&(a.bills=a.bills.concat(e),a.groups=t.groupBy(a.bills,"dueDate","Due","overdue"))})},a.fetch=function(){a.loading=!0,a.bills=[];var e=n.getAll(u),i=n.getAllNew();c.all([e,i]).then(function(e){var n=e[0],i=e[1];f(n.length),n.length||i.length?(a.bills=a.bills.concat(n),a.newBills=i,a.groups=t.groupBy(a.bills,"dueDate","Due","overdue")):a.response="No results"},function(e){a.response="Unable to fetch data"})["finally"](function(){a.loading=!1})},a.confirm=function(e){},a.decline=function(e,n){e.opened=!1,e.processing=!0,e.actions.decline({id:e.id},null).$promise.then(function(n){e.response={},e.response.message="Bill declined",l(function(){a.sync()},1e3)},function(e){t.error(e)})["finally"](function(){t.info("Done"),e.processing=!1})},a.accept=function(e,n){e.opened=!1,e.processing=!0,e.actions.accept({id:e.id},null).$promise.then(function(n){e.response={},e.response.action="success",e.response.message="Bill accepted",l(function(){a.sync()},1e3)},function(e){t.error(e)})["finally"](function(){t.info("Done"),e.processing=!1})},a.pay=function(e,n,i,o){n={accountId:n.account||e.mandate.debtor.account,amount:n.amount||e.amount,scheduledDate:n.scheduleDate||e.scheduleDate},e.opened=!1,e.processing=!0,p(n).then(function(n){e.actions.pay({id:e.id},n).$promise.then(function(n){e.response={},e.response.action="success",e.response.message="Payment succesfull",l(function(){a.sync()},8e3)},function(e){t.error(e)})["finally"](function(){t.info("Done"),e.processing=!1})})},a.reject=function(e,n,i){e.opened=!1,e.processing=!0,e.actions.reject({id:e.id},null).$promise.then(function(n){e.response={},e.response.message="Bill declined",l(function(){a.sync()},1e3)},function(e){t.error(e)})["finally"](function(){e.processing=!1})}},e.BillsListCtrl.$inject=["lpEbilling","lpEbillingDebitOrdersModel","lpEbillingUtils","lpEbillingBus","$scope","$timeout","$q","$cacheFactory"]}.call(n,t,n,e),!(void 0!==i&&(e.exports=i))},function(e,n,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children=[],e.webpackPolyfill=1),e}}])});