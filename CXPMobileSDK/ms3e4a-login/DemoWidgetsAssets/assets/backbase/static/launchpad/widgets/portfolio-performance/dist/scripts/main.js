!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("base"),require("core"),require("module-wealth"),require("d3")):"function"==typeof define&&define.amd?define(["base","core","module-wealth","d3"],e):"object"==typeof exports?exports["widget-portfolio-performance"]=e(require("base"),require("core"),require("module-wealth"),require("d3")):t["widget-portfolio-performance"]=e(t.base,t.core,t["module-wealth"],t.d3)}(this,function(t,e,r,n){return function(t){function e(n){if(r[n])return r[n].exports;var a=r[n]={exports:{},id:n,loaded:!1};return t[n].call(a.exports,a,a.exports,e),a.loaded=!0,a.exports}var r={};return e.m=t,e.c=r,e.p="",e(0)}([function(t,e,r){var n;(function(t){n=function(require,t,e){"use strict";function n(t,e){e.setConfig({portfolioEndPoint:t.getPreference("dataSrc")})}e.name="widget-portfolio-performance";var a=r(1),o=r(2),i=r(3),c=[o.name,i.name];n.$inject=["lpWidget","lpWealth"],e.exports=a.createModule(e.name,c).controller(r(4)).directive(r(5)).run(n)}.call(e,r,e,t),!(void 0!==n&&(t.exports=n))}).call(e,r(7)(t))},function(e,r,n){e.exports=t},function(t,r,n){t.exports=e},function(t,e,n){t.exports=r},function(t,e,r){var n;n=function(require,t,e){"use strict";t.MainCtrl=function(t,e,r,n){function a(t){i.loading=!1,i.data=t}function o(){i.title=i.modeAvail&&c.mode?"Performance":"Valuation"}var i=this,c=i.config={frequency:n.getConfig("frequency"),mode:!0};i.modeAvail=i.modeAvail||!1,i.toggleMode=function(){c.mode=!c.mode,o()},i.onSwitch=function(t){e(function(){i.modeAvail=t,o()})},r.subscribe("launchpad-retail.portfolioSelected",function(e){i.loading=!0,t.getData(e.id).then(a)}),r.subscribe("portfolio-frequency",function(t){e(function(){c.frequency=t})})},t.MainCtrl.$inject=["ptfModel","$timeout","lpCoreBus","lpWealth"]}.call(e,r,e,t),!(void 0!==n&&(t.exports=n))},function(t,e,r){var n;n=function(require,t,e){"use strict";var n=r(6),a=r(1).ng,o={top:10,bottom:20},i={top:-5,left:-25},c={monthly:n.time.format.multi([["%b %Y",function(t){return 0===t.getMonth()}],["%b",function(t){return 1===t.getDate()}],["",function(){return!0}]]),yearly:n.time.format.multi([["%Y",function(t){return 0===t.getMonth()}],["",function(){return!0}]])},l="translate("+i.left+","+i.top+")";t.lpWealthPerformance=function(t,e,r,i,u){function s(t){var e=g(t),r=t[e];return 0===e&&v(r)?-1:p(r)}function f(u,f){function v(t){return t.datapoint.totalPortfolioValue}function g(t){return $?t.datapoint.valueChangeRate:t.datapoint.totalPortfolioValue}function h(t,e){return[Math.min(n.min(t),n.min(e)),Math.max(n.max(t),n.max(e))]}function x(t){return g(t)<0?"negative":""}function b(t){return $?Math.min(V(0),D(t)):D(t)}function y(t,e,r){var n=0,a=e.length-1;if(t<=e[n].date)return n;if(t>=e[a].date)return a;for(;a-n>1;){var o=n+a>>1;e[o].date<=t?n=o:a=o}return r?n:a}function w(t,e,r){for(var n,a,o,i,c,l=[],u=t;e>=u;u++)c=u-t,n=1+g(r[u])/100,o=0===c?n:n*(1===c?a:i),a=n,i=o,l.push({date:r[u].date,data:100*(o-1)});return l}function q(){var t=u.range;if(t&&u.data){U.domain(t);var e=u.data[R.frequency];W!==t[0]>C&&(W=t[0]>C,$=W&&F,u.onSwitch({modeIsAvailable:W})),$?(S=w(y(t[0],e),y(t[1],e),e),V.domain(h(S.map(m),e.map(g)))):(S=[],V.domain(n.extent(e,g))),J.select(".line").datum(S).attr("d",N);var r=J.select(".dots").selectAll(".dot").data(S);r.enter().append("circle").attr("class","dot").attr("r",4),r.exit().remove(),r.call(O),J.select(".grid").call(L).selectAll("text").attr("transform",l),J.select(".x.axis").call(I),J.select(".x.zero").attr("transform","translate(0,"+V(0)+")"),J.select(".bars").selectAll("rect").call(X),J.select(".tip-helpers").selectAll("rect").call(_)}}function A(){var t=k;return k=f.innerWidth(),P=f.innerHeight()-o.top-o.bottom,0>=k||0>=P?void(k=t):(z*=k/t,Y.width(k),U.range([0,k]),V.range([P,0]),L.tickSize(k,0,0),G.attr("width",k).attr("height",P+o.top+o.bottom),J.select(".x.axis").attr("transform","translate(0,"+P+")"),J.select(".x.zero line").attr("x2",k),void q())}function M(){var t=u.data;if(t){t=t[R.frequency],C=s(t),U.domain(n.extent(t,p)),z=k/t.length*r.getDomainSize(U),I.tickFormat(c[R.frequency]);var e=J.select(".bars").selectAll("rect").data(t);e.enter().append("rect"),e.exit().remove();var a=J.select(".tip-helpers").selectAll("rect").data(t);a.enter().append("rect").attr({y:0,height:P}).on("mouseover",tt.show).on("click",tt.show).on("mouseout",tt.hide),a.exit().remove(),q()}}var S,k,P,z,C,$,W,j,E,D,R=u.config,U=n.time.scale(),V=n.scale.linear(),Y=r.ticks(),F=!0,B=f.find("svg")[0];j=e.compose(U,p),E=e.compose(V,m),D=e.compose(V,g);var I=n.svg.axis().scale(U).orient("bottom").tickSize(0).ticks(Y),H=n.format(".2s"),L=n.svg.axis().scale(V).orient("right").ticks(5).tickFormat(function(t){return $?t+"%":H(t)}),N=n.svg.line().x(j).y(E),O=function(t){t.attr({cx:j,cy:E})},X=function(t){var e=z/r.getDomainSize(U)*.75;t.attr({width:e,y:b,"class":x,height:function(t){return $?Math.abs(V(0)-D(t)):P-D(t)},transform:function(t){return"translate("+(j(t)-e/2)+",0)"}})},_=function(t){var e=z/r.getDomainSize(U);t.attr({width:e,transform:function(t){return"translate("+(j(t)-e/2)+",0)"}})},G=n.select(B),J=G.append("g").attr("transform","translate(0,"+o.top+")");J.append("g").attr("class","bars"),J.append("g").attr("class","grid").call(L),J.append("g").attr("class","x axis"),J.append("g").attr("class","x axis zero").append("line"),J.append("path").attr("class","line"),J.append("g").attr("class","dots"),J.append("g").attr("class","tip-helpers");var K={monthly:n.time.format("%b %Y"),yearly:n.time.format("%Y")},Q=n.format(",.2f"),T=function(t){return Q(t).replace(/,/g,"~").replace(/\./g,",").replace(/~/g,".")},Z=n.format("+,.2f"),tt=i().attr("class","d3-tip").offset([-7,0]).y(b).html(function(t){return"<div>"+K[R.frequency](p(t))+"</div><div>"+T(v(t))+" EUR</div>"+($?"<div>"+Z(g(t))+"%</div>":"")+"<div> &rarr; "+T(t.datapoint.cashIn)+" EUR</div><div> &larr; "+T(t.datapoint.cashOut)+" EUR</div>"+($?"<div>Cumul: "+m(S[y(p(t),S,!0)]).toFixed(2)+"%</div>":"")});J.call(tt),A();var et=e.compose(q,function(t){u.range=t});d.subscribe("portfolio-rangeSelected",et),d.subscribe("portfolio-rangeSelected-live",et),u.$watch("data",M),u.$watch("config.frequency",M),u.$watch("config.mode",function(t){F=t,$=W&&F,q()}),a.element(t).on("resize",e.debounce(A,250))}var d=u,p=e.property("date"),m=e.property("data"),v=function(t,e){return null===t.datapoint.valueChangeRate?0:1},g=n.bisector(v).right;return{restrict:"EA",require:"?ngModel",priority:Number.MAX_VALUE,link:f,template:"<svg/>",scope:{config:"=lpWealthPerformance",data:"=ngModel",onSwitch:"&"}}},t.lpWealthPerformance.$inject=["$window","utils","wealthUtils","d3tip","lpCoreBus"]}.call(e,r,e,t),!(void 0!==n&&(t.exports=n))},function(t,e,r){t.exports=n},function(t,e,r){t.exports=function(t){return t.webpackPolyfill||(t.deprecate=function(){},t.paths=[],t.children=[],t.webpackPolyfill=1),t}}])});