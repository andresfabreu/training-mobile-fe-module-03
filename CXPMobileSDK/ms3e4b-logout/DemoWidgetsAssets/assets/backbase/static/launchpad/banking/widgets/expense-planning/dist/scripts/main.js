!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("base"),require("ui"),require("core"),require("module-expenses")):"function"==typeof define&&define.amd?define(["base","ui","core","module-expenses"],t):"object"==typeof exports?exports["widget-expense-planning"]=t(require("base"),require("ui"),require("core"),require("module-expenses")):e["widget-expense-planning"]=t(e.base,e.ui,e.core,e["module-expenses"])}(this,function(e,t,n,a){return function(e){function t(a){if(n[a])return n[a].exports;var r=n[a]={exports:{},id:a,loaded:!1};return e[a].call(r.exports,r,r.exports,t),r.loaded=!0,r.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){var a;(function(e){a=function(require,e,t){"use strict";function a(){}t.name="widget-expense-planning";var r=n(1),o=n(2),s=n(3),l=n(4),i=[s.name,o.name,l.name];t.exports=r.createModule(t.name,i).directive(n(5)).controller(n(6)).run(a)}.call(t,n,t,e),!(void 0!==a&&(e.exports=a))}).call(t,n(7)(e))},function(t,n,a){t.exports=e},function(e,n,a){e.exports=t},function(e,t,a){e.exports=n},function(e,t,n){e.exports=a},function(e,t,n){var a;a=function(require,e,t){"use strict";e.lpCalendar=function(e){return{restrict:"AE",scope:{content:"=content",list:"=list",view:"=view",config:"=config"},replace:!0,controller:"calendarCtrl",link:function(e,t,n,a){a.init()},templateUrl:e.resolveTemplateSrc("templates/calendar.html")}},e.lpCalendar.$inject=["lpCoreTemplate"]}.call(t,n,t,e),!(void 0!==a&&(e.exports=a))},function(e,t,n){var a;a=function(require,e,t){"use strict";var n=window.lp&&window.lp.util,a=window.jQuery,r={month:{"long":["January","February","March","April","May","June","July","August","September","October","November","December"],"short":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]},week:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]};e.ExpensePlanningController=function(e,t,a,r,o,s,l,i){var c=i,u=r,d=function(){var t=n.widgetBaseUrl(u)+"/partials/";e.locale=u.getPreference("locale"),e.title=u.getPreference("title"),s.loadMessages(u,e.locale).success(function(t){e.messages=t.messages}),e.templates={list:t+"list.html"},e.expensesModel=l.getInstance({expensesEndpoint:u.getPreference("expensesDataSrc"),expensesDetailsEndpoint:u.getPreference("expensesDetailsDataSrc")}),e.today=new Date,e.lastDay=new Date(e.today.getFullYear(),12,0,23,59,59);var a=e.expensesModel.loadExpenses(e.today,e.lastDay);a.then(function(){e.calendarPayments=e.filterPayments(e.expensesModel.expenses),e.paymentListOnDates=e.filterPayments(e.expensesModel.findByDate(e.today))})};e.filterPayments=function(e){var t={},a=function(e){return"RECEIVED"===e.status?!1:!0};for(var r in e)if(e.hasOwnProperty(r)){var o=e[r].payments.filter(a);o.length>0&&(e[r].payments=o,t[r]=e[r])}return n.isEmptyObject(t)?null:t},e.showList=function(t){e.paymentListOnDates=e.filterPayments(e.expensesModel.findByDate(t))},e.showDetail=function(t){e.expensesModel.loadExpensesDetails(t)},e.refreshContent=function(t){if(e.lastDay<t){var n=new Date(e.lastDay.getFullYear()+1,12,0,23,59,59);e.expensesModel.loadExpenses(e.lastDay,n),e.lastDay=n}},u.addEventListener("preferencesSaved",function(){u.refreshHTML(),e.$apply(function(){d()})}),c.enable(t).rule({"max-width":200,then:function(){e.responsiveClass="lp-tile-size",e.handleLargeScreen=!1,n.applyScope(e)}}).rule({"min-width":201,"max-width":400,then:function(){e.responsiveClass="lp-small-size",e.handleLargeScreen=!1,n.applyScope(e)}}).rule({"min-width":401,"max-width":624,then:function(){e.responsiveClass="lp-medium-size",e.handleLargeScreen=!1,n.applyScope(e)}}).rule({"min-width":625,"max-width":915,then:function(){e.responsiveClass="lp-large-size",e.handleLargeScreen=!1,n.applyScope(e)}}).rule({"min-width":915,then:function(){e.responsiveClass="lp-large-size",e.handleLargeScreen=!0,n.applyScope(e)}}),d()},e.ExpensePlanningController.$inject=["$scope","$rootElement","$timeout","lpWidget","$log","i18nUtils","ExpensesModel","lpUIResponsive"],e.calendarCtrl=function(e,t){var n=this,o=-1,s=-1;e.navigate={};var l=function(){return e.currentDate.getMonth()===e.today.getMonth()&&e.currentDate.getFullYear()===e.today.getFullYear()},i=function(t,n){var r=function(e,t){var n=a(e).clone();n.css({position:"absolute",background:"#FFFFFF",zIndex:"99999",left:a(e).position().left}),a(e).parent().append(n),n.css({left:0,top:0,width:"100%",height:"100%"}),t()};"year"===e.view&&r(t,n)},c=function(e){var t=new Date(e.getFullYear(),e.getMonth(),1).getDay();return Math.ceil((e.getDate()+t)/7)},u=function(t,n,a){a||(a=0);var r=new Date(t,n-1,a,23,59,59);return r<e.today},d=function(t,n,a){var r=e.content,o=""+t+"-"+("0"+n).slice(-2)+"-"+("0"+a).slice(-2),s=null;return r&&r[o]&&r[o].payments&&(s={},s.paymentCount=r[o].payments.length,s.paymentTotal=r[o].total,s.currency=r[o].currency),s},p=function(e,t,n,a,r){for(var o=[],s=0;7>s;s++){var l,i=t,c=e,p=!1,h="";0>n+s?(l=r+n+s+1,p=!0,1===t?(i=12,c-=1):i-=1):n+s+1>a?(l=n+s-a+1,p=!0,12===t?(i=1,c+=1):i+=1):l=n+s+1,h=d(c,i,l),o.push({outmonth:p,day:s,month:i,year:c,content:h,date:l,isPast:u(c,i,l),dateObj:new Date(c,i-1,l,0,0,0)})}return o},h=function(e,t){return new Date(t,e,0).getDate()},f=function(t,n){var a=[],r=new Date(n,t-1,1,0,0,0,0),s=r.getDay(),i=h(t,n),u=h(t-1,n),d=0;for(a.push(p(n,t,d-s,i,u)),d=7-s;i>d;){var f=p(n,t,d,i);a.push(f);for(var y in f)f[y].month===t&&(d+=1)}if(l()){o=c(e.today)-1;var D=e.today.getDay();a[o][D].isToday=!0,-1===e.selectedDay&&(e.selectedDay=a[o][D])}else o=-1,-1===e.selectedDay&&(e.selectedDay=a[0][s]);return a},y=function(){var t=function(){if(l()&&s===o)return!0;for(var t=e.week.length-1;t>=0;t--)if(e.week[t].isPast)return!0;return!1};t()||(s-=1,0>s&&(e.currentDate.setMonth(e.currentDate.getMonth()-1),e.month=f(e.currentDate.getMonth()+1,e.currentDate.getFullYear()),s=e.month.length-1,e.month[s][6].outmonth&&(s-=1)),e.week=e.month[s])},D=function(){s+=1,e.month[s]||(e.currentDate.setMonth(e.currentDate.getMonth()+1),e.month=f(e.currentDate.getMonth()+1,e.currentDate.getFullYear()),s=0,e.month[s][0].outmonth&&(s+=1)),e.week=e.month[s]},g=function(){var t=e.content,n={};for(var a in t)if(t.hasOwnProperty(a)){var r=a.slice(0,7);n[r]||(n[r]={paymentCount:0,paymentTotal:0,currency:""}),n[r].paymentCount+=t[a].payments.length,n[r].paymentTotal+=t[a].total}return n},m=function(){e.month=f(e.currentDate.getMonth()+1,e.currentDate.getFullYear())},w=function(){if(e.month)if(e.selectedDay&&e.selectedDay.month===e.currentDate.getMonth()+1){var t=new Date(e.selectedDay.year,e.selectedDay.month-1,e.selectedDay.date);s=c(t)-1,e.selectedDay.outmonth&&(e.month=f(e.currentDate.getMonth()+1,e.currentDate.getFullYear()))}else s=0,e.month[0][6].month===e.today.getMonth()+1&&(s=o);else e.month=f(e.currentDate.getMonth()+1,e.currentDate.getFullYear()),s=o;e.week=e.month[s]},v=function(){var t,n=[];e.monthList=[];for(var a=g(),o=0;12>=o;o++)t={numb:o,year:e.currentDate.getFullYear(),longName:r.month["long"][o],shortName:r.month["short"][o],content:a[e.currentDate.getFullYear()+"-"+("0"+(o+1)).slice(-2)],isPast:u(e.currentDate.getFullYear(),o+2)},n.push(t),o>0&&(o+1)%3===0&&(e.monthList.push(n),n=[])};this.init=function(){e.$parent.calendarView||(e.view="agenda"),e.templates=e.$parent.templates,e.today=new Date,e.calendar=r,e.agendaView=!1,e.handleLargeScreen=!1,e.widgetSize=e.$parent.responsiveClass,e.selectedDay=-1,"lp-small-size"===e.widgetSize&&(e.view="year");var t=parseInt(e.assignedMonth,10),n=parseInt(e.assignedyear,10);e.currentDate=!isNaN(t)&&!isNaN(n)&&t>0&&12>t?new Date(n,t,0):new Date,"agenda"===e.view&&(e.view="month",e.agendaView=!0)},this.refreshCalendar=function(){switch(e.dateHeader="year"!==e.view&&"agenda"!==e.view,e.view){case"month":m();break;case"week":w();break;case"year":v()}},e.$watch("view",function(){n.refreshCalendar()}),e.$watch("$parent.handleLargeScreen",function(t){e.handleLargeScreen=t}),e.$watch("content",function(){n.refreshCalendar()},!0),e.$watch("week",function(){e.week&&e.$parent.showList(e.week)}),e.$watch("currentDate",function(){e.$parent.showList(e.currentDate)},!0),e.changeView=function(t){e.agendaView=!1,"agenda"===t&&(t="month",e.agendaView=!0,e.$parent.showList(e.currentDate)),e.$parent.calendarView=t},e.navigate.prev=function(){if("month"===e.view){if(l())return;e.currentDate=new Date(e.currentDate.getFullYear(),e.currentDate.getMonth()-1,1),e.selectedDay=-1,s=-1,n.refreshCalendar()}else if("week"===e.view)y();else if("year"===e.view){if(e.currentDate.getFullYear()===e.today.getFullYear())return;var t=e.currentDate.getFullYear()-1;e.currentDate=t===e.today.getFullYear()?e.today:new Date(t,0,1),e.selectedDay=-1,s=-1,n.refreshCalendar()}},e.navigate.next=function(){switch(e.view){case"month":e.currentDate=new Date(e.currentDate.getFullYear(),e.currentDate.getMonth()+1,1),s=-1,e.selectedDay=-1,n.refreshCalendar();break;case"week":D();break;case"year":e.currentDate=new Date(e.currentDate.getFullYear()+1,0,1),s=-1,e.selectedDay=-1,n.refreshCalendar()}e.$parent.refreshContent(e.currentDate)},e.navigate.today=function(){e.currentDate=new Date,e.month=null,n.refreshCalendar()},e.clickOnDate=function(t){t.isPast||(e.currentDate=new Date(t.year,t.month-1,t.date),e.selectedDay=t,n.refreshCalendar(),e.agendaView||e.changeView("agenda"))},e.clickOnMonth=function(t,n){t.isPast||i(n.currentTarget.parentNode,function(){e.currentDate.setMonth(t.numb),e.currentDate.setYear(t.year),e.changeView("month"),e.$parent.refreshContent(e.currentDate)})},e.isSelected=function(t){return e.selectedDay&&t.date===e.selectedDay.date&&t.month===e.selectedDay.month&&t.year===e.selectedDay.year},e.loadDetails=function(t){e.$parent.showDetail(t)}},e.calendarCtrl.$inject=["$scope","$element"]}.call(t,n,t,e),!(void 0!==a&&(e.exports=a))},function(e,t,n){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children=[],e.webpackPolyfill=1),e}}])});