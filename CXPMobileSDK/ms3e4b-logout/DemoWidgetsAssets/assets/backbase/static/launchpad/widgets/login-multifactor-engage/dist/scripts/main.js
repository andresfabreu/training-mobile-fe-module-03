!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("base"),require("core"),require("ui"),require("module-users")):"function"==typeof define&&define.amd?define(["base","core","ui","module-users"],t):"object"==typeof exports?exports["widget-login-multifactor-engage"]=t(require("base"),require("core"),require("ui"),require("module-users")):e["widget-login-multifactor-engage"]=t(e.base,e.core,e.ui,e["module-users"])}(this,function(e,t,i,n){return function(e){function t(n){if(i[n])return i[n].exports;var o=i[n]={exports:{},id:n,loaded:!1};return e[n].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var i={};return t.m=e,t.c=i,t.p="",t(0)}([function(e,t,i){var n;(function(e){n=function(require,e,t){"use strict";function n(e,t,i,n,o){try{var r=i.resolvePortalPlaceholders(t.getPreference("prefixSessionUrl"));n.setConfig({initiateEndPoint:r+t.getPreference("initiateEndPoint"),otpEndPoint:r+t.getPreference("otpEndPoint"),serverRootPath:i.getPortalProperty("serverRoot"),portalName:i.getPortalProperty("portalName"),pageName:i.getPortalProperty("pageName")}),e.initialize()}catch(s){o.captureException(s)}}t.name="widget-login-multifactor-engage";var o=i(1),r=i(2),s=i(3),c=i(4),a=i(9),u=[r.name,c.name,s.name,a.name];n.$inject=["loginSteps","lpWidget","lpCoreUtils","lpUsersAuthentication","lpCoreError"],t.exports=o.createModule(t.name,u).constant(i(5)).provider("loginSteps",i(6)).config(i(7)).controller(i(8)).run(n)}.call(t,i,t,e),!(void 0!==n&&(e.exports=n))}).call(t,i(10)(e))},function(t,i,n){t.exports=e},function(e,i,n){e.exports=t},function(e,t,n){e.exports=i},function(e,t,i){e.exports=n},function(e,t,i){var n;n=function(require,e,t){"use strict";e.STEPS={LOGIN:"LOGIN",OTP:"OTP",PRIVACY:"PRIVACY"},e.STORE_LOGIN_ID="login-multifactor-login"}.call(t,i,t,e),!(void 0!==n&&(e.exports=n))},function(e,t,i){var n;n=function(require,e,t){"use strict";t.exports=function(e){var t,i={},n={shown:!1,onShow:null,onHide:null,back:null,next:null};this.setInitialStep=function(e){t=e},this.setRoutes=function(t){e.extend(i,t)},this.$get=function(o){function r(t){!t.shown&&e.isFunction(t.onShow)&&t.onShow(),t.shown=!0}function s(t){t.shown&&e.isFunction(t.onHide)&&t.onHide(),t.shown=!1}var c={};return c.steps={},c.addStep=function(t,o){if(!t)throw new Error("You must provide an id for the step");this.steps[t]=e.extend({},n),i.hasOwnProperty(t)?e.extend(this.steps[t],i[t],o):e.extend(this.steps[t],o)},c.next=function(){var i=this.steps[t].next;return e.isFunction(i)?void i():void this.to(i)},c.back=function(){var i=this.steps[t].back;return e.isFunction(i)?void i():void this.to(i)},c.to=function(i){t=i,e.forEach(this.steps,s),r(this.steps[t])},c.getCurrent=function(){return t},c.setValues=function(t,i){e.extend(this.steps[t],i)},c.initialize=function(){o(function(){r(c.steps[t])}),c.initialize=e.noop},c},this.$get.$inject=["$timeout"]},t.exports.$inject=["lpCoreUtils"]}.call(t,i,t,e),!(void 0!==n&&(e.exports=n))},function(e,t,i){var n;n=function(require,e,t){"use strict";t.exports=function(e,t,i,n){var o={};o[n.LOGIN]={back:null,next:n.OTP},o[n.OTP]={back:n.LOGIN,next:n.PRIVACY},o[n.PRIVACY]={back:null,next:null},i.setInitialStep(n.LOGIN),i.setRoutes(o)},t.exports.$inject=["lpCoreUtils","lpCoreTemplateProvider","loginStepsProvider","STEPS"]}.call(t,i,t,e),!(void 0!==n&&(e.exports=n))},function(e,t,i){var n;n=function(require,e){"use strict";e.MainCtrl=function(e,t,i,n){var o=this;o.steps=n.steps,e.$on("start-loading",function(){o.loading=!0}),e.$on("stop-loading",function(){o.loading=!1}),e.$on("error",function(e,i){t(function(){o.errorMessage=i.message})}),e.$on("error-clean",function(e){t(function(){o.errorMessage=null})})},e.MainCtrl.$inject=["$scope","$timeout","lpCoreUtils","loginSteps"],e.LoginCtrl=i(11),e.OtpCtrl=i(12),e.PrivacyCtrl=i(13)}.call(t,i,t,e),!(void 0!==n&&(e.exports=n))},function(e,t,i){var n;(function(e){n=function(require,e,t){"use strict";t.name="components.login-trusted-device";var n=i(1),o=i(2),r=i(3),s=[o.name,r.name];t.exports=n.createModule(t.name,s).factory(i(14)).directive(i(15))}.call(t,i,t,e),!(void 0!==n&&(e.exports=n))}).call(t,i(10)(e))},function(e,t,i){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children=[],e.webpackPolyfill=1),e}},function(e,t,i){var n;n=function(require,e,t){"use strict";t.exports=function(e,t,i,n,o,r,s,c,a,u,d){var l=this;l.data={},l.locked=!1,d.requestDevice().then(function(){var t=e.$on("initiate-success",function(e,i){var n=i.session&&i.session.deviceId,r=function(){o.unsubscribe("widget-login-multifactor:status:security-check-success",r),d.setDeviceId(n)};o.subscribe("widget-login-multifactor:status:security-check-success",r),t()})}),s.addStep(a.LOGIN,{onShow:function(){n("username")},onHide:function(){l.hasFocus=!1,l.resetFields(),e.$emit("error-clean")}}),l.validate=function(e){},l.submit=function(){e.$emit("start-loading"),e.$emit("error-clean"),r.initiate(l.data).then(function(t){e.$emit("initiate-success",t),r.isInitiated()?(e.$emit("stop-loading"),s.next()):r.isVerified()&&r.securityCheck().then(function(e){o.publish("widget-login-multifactor:status:security-check-success"),r.handleVerifiedResponse(e)},function(t){e.$emit("stop-loading"),e.$emit("error",t)})},function(t){t.code===r.ERROR_CODE.MAX_ATTEMPTS_EXCEEDED&&l.showMaxAttemptsExceeded(),e.$emit("stop-loading"),e.$emit("error",t)})},l.showMaxAttemptsExceeded=function(){l.locked=!0},l.resetFields=function(){l.data.username="",l.data.password=null}},t.exports.$inject=["$scope","$timeout","$window","lpFocus","lpCoreBus","lpUsersAuthentication","loginSteps","lpCoreStore","STEPS","STORE_LOGIN_ID","lpTrustedDevice"]}.call(t,i,t,e),!(void 0!==n&&(e.exports=n))},function(e,t,i){var n;n=function(require,e,t){"use strict";t.exports=function(e,t,i,n,o,r,s,c,a){var u,d,l=this;l.data={};try{u=parseInt(a.getPreference("timerSeconds"),10)}catch(p){u=60}try{d=parseInt(a.getPreference("timerHideSeconds"),10)}catch(p){d=0}l.timerSeconds=1e3*u,l.timerHideSeconds=1e3*d,l.timerShown=l.timerSeconds&&!l.timerHideSeconds,l.countdownSeconds=l.timerSeconds-l.timerHideSeconds,r.addStep(s.OTP,{onShow:function(){o("otp"),l.timerSeconds&&e.$broadcast("timer-run")},onHide:function(){l.resetFields()}}),l.submit=function(){return e.$emit("error-clean"),/^\d+$/.test(l.data.otpcode)===!1?void e.$emit("error",{message:"Code must contain only digits"}):(l.timerSeconds&&e.$broadcast("timer-pause"),e.$emit("start-loading"),void n.verifyOTP({otpCode:l.data.otpcode}).then(function(t){n.isVerified()&&n.securityCheck().then(function(t){i.publish("widget-login-multifactor:status:security-check-success"),n.handleVerifiedResponse(t),e.$emit("stop-loading")},function(t){e.$emit("error",t),e.$emit("stop-loading")})},function(t){l.timerSeconds&&e.$broadcast("timer-resume"),e.$emit("error",t),e.$emit("stop-loading")}))},l.cancel=function(){r.back()},l.retry=function(){l.resetFields(),o("otp"),l.timerSeconds&&e.$broadcast("timer-run")},l.countdownStart=function(){l.timerShown=!0},l.finish=function(i){t(function(){l.timeExpired=!0,e.$emit("error",{message:"Time has expired"})},200)},l.resetFields=function(){l.data.otpcode=null,l.timerSeconds&&(l.timeExpired=!1,l.timerShown=!l.timerHideSeconds,e.$broadcast("timer-reset")),e.$emit("error-clean")},l.toggleInfoMessage=function(){l.displayInfoMessage=!l.displayInfoMessage}},t.exports.$inject=["$scope","$timeout","lpCoreBus","lpUsersAuthentication","lpFocus","loginSteps","STEPS","lpCoreI18n","lpWidget"]}.call(t,i,t,e),!(void 0!==n&&(e.exports=n))},function(e,t,i){var n;n=function(require,e,t){"use strict";t.exports=function(e,t,i,n){var o=this;i.addStep(n.PRIVACY,{next:function(){t.location.replace(t.location.href)}}),o.data={privacy:"public"},o.submit=function(){e.$emit("error-clean"),i.next()}},t.exports.$inject=["$scope","$window","loginSteps","STEPS"]}.call(t,i,t,e),!(void 0!==n&&(e.exports=n))},function(e,t,i){var n;n=function(require,e,t){"use strict";e.lpTrustedDevice=function(e,t,i,n){var o=n.defer(),r=n.defer();e.subscribe("widget-device-dna:data:ready",function(e){r.resolve(e)});var s={requestDevice:function(){return r.promise},setDeviceId:function(e){o.resolve(e||"")},getDeviceId:function(){return o.promise},storeDeviceId:function(t){e.publish("widget-device-dna:device:ready",t)}};return s},e.lpTrustedDevice.$inject=["lpCoreBus","lpCoreUtils","lpCoreError","$q"]}.call(t,i,t,e),!(void 0!==n&&(e.exports=n))},function(e,t,i){var n;n=function(require,e,t){"use strict";e.lpTrustedDeviceCheckbox=function(e,t,i,n){function o(t,i,o){var r,s={},c=t.hideDelay||500,a=function(){t.displayInfoMessage=!t.displayInfoMessage};t.displayInfoMessage=!1,t.disabled=!0,i.find("i").on("touchstart click",function(){t.$apply(function(){t.$eval(a)})}),t.showInfoMessage=function(){r&&(e.cancel(r),r=null),t.displayInfoMessage=!0},t.hideInfoMessage=function(){r=e(function(){t.displayInfoMessage=!1,r=null},c)},n.requestDevice().then(function(e){s.deviceId=e.deviceID||"",s.deviceSignature=e.deviceSignature,t.trusted=!!s.deviceId,t.disabled=!1}),n.getDeviceId().then(function(e){n.storeDeviceId(t.trusted?e:"")}),t.$watch("trusted",function(e,i){e?(t.model.deviceId=s.deviceId,t.model.deviceSignature=s.deviceSignature):(delete t.model.deviceId,delete t.model.deviceSignature)})}function r(){return o}var s=['<div class="lp-trusted-device">','<span lp-checkbox="lp-checkbox" ng-model="trusted" label="Trust this device" ng-disabled="disabled"></span> ','<i class="lp-icon lp-icon-info-sign"></i>','<div class="panel-body" ng-show="displayInfoMessage">','<small class="text-muted" lp-i18n="Please indicate whether you are using a personal device (PC, laptop, etc.) in a \'private\' environment, or whether you are in a public environment, like on a public wifi network"></small>',"</div>","</div>"].join("");return{scope:{trusted:"=",hideDelay:"=",model:"=ngModel"},restricted:"A",require:"?^ngModel",template:s,compile:r}},e.lpTrustedDeviceCheckbox.$inject=["$timeout","lpCoreUtils","lpCoreBus","lpTrustedDevice"]}.call(t,i,t,e),!(void 0!==n&&(e.exports=n))}])});